<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Test các chức năng Mail và các API bên ngoài bằng Codeception | GMO-Z.com Vietnam Lab Center</title>
    <meta name="description" content="Lần này mình sẽ giới thiệu về test tự động các chức năng lên kết với các service bên ngoài hoặc liên quan tới mail bằng cách sử dụng Coceception/PhantomJS" />
    <meta property="fb:app_id" content="703042457154743" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google-site-verification" content="duCCqsDAWLg3POOfPMr6JiS4R0g0CjouGGM3fhsG0-0" />
    <link rel="shortcut icon" href="../favicon.ico">

    <!-- Stylesheet -->
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.min.css?v=52156bd6b0" />
    <link rel="stylesheet" type="text/css" href="../assets/css/font-awesome.min.css?v=52156bd6b0" />
    <link rel="stylesheet" type="text/css" href="../assets/css/atom-one-dark.min.css?v=52156bd6b0" />
    <link rel="stylesheet" type="text/css" href="../assets/css/screen.css?v=52156bd6b0" />

    <script type="text/javascript" src="../assets/js/libs/jquery.min.js?v=52156bd6b0"></script>

    <meta name="description" content="Lần này mình sẽ giới thiệu về test tự động các chức năng lên kết với các service bên ngoài hoặc liên quan tới mail bằng cách sử dụng Coceception/PhantomJS" />
    <link rel="canonical" href="index.html" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="amp/index.html" />
    
    <meta property="og:site_name" content="GMO-Z.com Vietnam Lab Center Technology Blog" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Test các chức năng Mail và các API bên ngoài bằng Codeception" />
    <meta property="og:description" content="Lần này mình sẽ giới thiệu về test tự động các chức năng lên kết với các service bên ngoài hoặc liên quan tới mail bằng cách sử dụng Coceception/PhantomJS" />
    <meta property="og:url" content="https://blog.vietnamlab.vn/test-tu-dong-cac-chuc-nang-lien-quan-toi-mail-va-cac-api-ben-ngoai-bang-codeception/" />
    <meta property="og:image" content="https://drive.google.com/uc?id&#x3D;0B05rqFCwNCjkbnY2TjBoU3o3Wkk&amp;export&#x3D;download" />
    <meta property="article:published_time" content="2017-09-05T10:47:00.000Z" />
    <meta property="article:modified_time" content="2017-09-06T00:44:15.000Z" />
    <meta property="article:tag" content="automation testing" />
    <meta property="article:tag" content="codeception" />
    
    <meta property="article:publisher" content="https://www.facebook.com/vietnamlab.vn" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Test các chức năng Mail và các API bên ngoài bằng Codeception" />
    <meta name="twitter:description" content="Lần này mình sẽ giới thiệu về test tự động các chức năng lên kết với các service bên ngoài hoặc liên quan tới mail bằng cách sử dụng Coceception/PhantomJS" />
    <meta name="twitter:url" content="https://blog.vietnamlab.vn/test-tu-dong-cac-chuc-nang-lien-quan-toi-mail-va-cac-api-ben-ngoai-bang-codeception/" />
    <meta name="twitter:image" content="https://drive.google.com/uc?id&#x3D;0B05rqFCwNCjkbnY2TjBoU3o3Wkk&amp;export&#x3D;download" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="P.T.G" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="automation testing, codeception" />
    <meta property="og:image:width" content="764" />
    <meta property="og:image:height" content="280" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "GMO-Z.com Vietnam Lab Center Technology Blog",
        "url": "https://blog.vietnamlab.vn/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://blog.vietnamlab.vn/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "P.T.G",
        "url": "https://blog.vietnamlab.vn/author/giangpt/",
        "sameAs": []
    },
    "headline": "Test các chức năng Mail và các API bên ngoài bằng Codeception",
    "url": "https://blog.vietnamlab.vn/test-tu-dong-cac-chuc-nang-lien-quan-toi-mail-va-cac-api-ben-ngoai-bang-codeception/",
    "datePublished": "2017-09-05T10:47:00.000Z",
    "dateModified": "2017-09-06T00:44:15.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://drive.google.com/uc?id=0B05rqFCwNCjkbnY2TjBoU3o3Wkk&export=download",
        "width": 764,
        "height": 280
    },
    "keywords": "automation testing, codeception",
    "description": "Ở bài trước mình đã giới thiệu qua về Codeception để viết test tự động , bạn nào\nchưa xem thì có thể tham khảo ở link bên dưới .\n\n  \nhttps://vietnamlab.vn/blog/2016/12/21/gioi-thieu-ve-codeception-framework-testing/\n[https://vietnamlab.vn/blog/2016/12/21/gioi-thieu-ve-codeception-framework-testing/]\n\nLần này mình sẽ giới thiệu về test tự động các chức năng lên kết với các service\nbên ngoài hoặc liên quan tới mail bằng cách sử dụng Codeception/PhantomJS . Với\nPhantomJS thì ta có thể test được các",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://blog.vietnamlab.vn/"
    }
}
    </script>

    <meta name="generator" content="Ghost 3.36" />
    <link rel="alternate" type="application/rss+xml" title="GMO-Z.com Vietnam Lab Center Technology Blog" href="../rss/index.html" />
</head>

<body class="post-template tag-automation-testing tag-codeception nav-closed">
    <script type="text/javascript" src="../assets/js/app/social.js?v=52156bd6b0"></script>
    <div id="fb-root"></div>

    <div id="header">
        <div id="blog-banner">
    <div class="row">
        <div class="col-md-offset-1 col-md-5">
            <img src="../assets/img/vnlab_logo.jpg?v=52156bd6b0" alt="VNLab Logo">
        </div>
        <div class="col-md-5 text-right coworker">
            <img src="../assets/img/vnlab_coworker.jpg?v=52156bd6b0" alt="VNLab coworker">
        </div>
        <div class="col-md-offset-1"></div>
    </div>
</div>

<nav class="navbar navbar-default">
    <div class="row">
        <div class="col-md-offset-1 col-md-10">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                        <li class="">
                            <a class="https://vietnamlab.vn" href="https://vietnamlab.vn">GMO-Z.com Vietnam Lab Center</a>
                        </li>
                        <li class="">
                            <a class="/tag/news/" href="../tag/news/index.html">Tin tức</a>
                        </li>
                        <li class="">
                            <a class="/" href="../index.html">Blog</a>
                        </li>
                        <li class="">
                            <a class="/tuyen-dung/" href="../tuyen-dung/index.html">★ Tuyển dụng ★</a>
                        </li>
                </ul>

                <ul class="nav navbar-nav navbar-right">
                        <li><a class="subscribe-button icon-feed" href="../rss/index.html">Đăng ký</a></li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <div class="col-md-offset-1"></div>
        <!-- /.container-fluid -->
    </div>
</nav>

    </div>

    <div id="body" class="row">
        
<div class="col-lg-offset-1 col-lg-7">
        <article class="post tag-automation-testing tag-codeception js-toc-content">
            <div class="post-header">
                <h2 class="post-title"><a href="index.html">Test tự động các chức năng liên quan tới Mail và các API bên ngoài bằng Codeception</a></h2>
            </div>

            <div class="post-meta">
                <div class="post-date" datetime="2017-09-05">
                    <i class="fa fa-clock-o" aria-hidden="true"></i> 05 September 2017
                </div>
                <div class="post-tag">
                    <i class="fa fa-tags" aria-hidden="true"></i> <a href="../tag/automation-testing/index.html">automation testing</a>, <a href="../tag/codeception/index.html">codeception</a>
                </div>
            </div>

            <div class="post-featured post-featured-single">
                <div class="post-featured-img">
                        <img src="https://drive.google.com/uc?id&#x3D;0B05rqFCwNCjkbnY2TjBoU3o3Wkk&amp;export&#x3D;download" alt="Test tự động các chức năng liên quan tới Mail và các API bên ngoài bằng Codeception">
                </div>

                <div class="post-author">
                </div>

                <div class="post-share">
                    <div class="share-button">
                        <div class="fb-share-button" data-href="/test-tu-dong-cac-chuc-nang-lien-quan-toi-mail-va-cac-api-ben-ngoai-bang-codeception/" data-layout="button" data-size="large" data-mobile-iframe="true">
                        </div>
                    </div>

                    <div class="share-button">
                        <a class="twitter-share-button" data-size="large" href="https://twitter.com/intent/tweet?text=Test%20t%E1%BB%B1%20%C4%91%E1%BB%99ng%20c%C3%A1c%20ch%E1%BB%A9c%20n%C4%83ng%20li%C3%AAn%20quan%20t%E1%BB%9Bi%20Mail%20v%C3%A0%20c%C3%A1c%20API%20b%C3%AAn%20ngo%C3%A0i%20b%E1%BA%B1ng%20Codeception">
                            Tweet
                        </a>
                    </div>
                </div>
            </div>

            <section class="post-content">
                <!--kg-card-begin: markdown--><p>Ở b&agrave;i trước m&igrave;nh đ&atilde; giới thiệu qua về Codeception để viết test tự động , bạn n&agrave;o chưa xem th&igrave; c&oacute; thể tham khảo ở link b&ecirc;n dưới .</p>
<p><a href="https://vietnamlab.vn/blog/2016/12/21/gioi-thieu-ve-codeception-framework-testing/"> https://vietnamlab.vn/blog/2016/12/21/gioi-thieu-ve-codeception-framework-testing/ </a></p>
<p>Lần n&agrave;y m&igrave;nh sẽ giới thiệu về test tự động c&aacute;c chức năng l&ecirc;n kết với c&aacute;c service b&ecirc;n ngo&agrave;i hoặc li&ecirc;n quan tới mail bằng c&aacute;ch sử dụng Codeception/PhantomJS . Với PhantomJS th&igrave; ta c&oacute; thể test được c&aacute;c những trang c&oacute; Javascript.(PhpBrowser th&igrave; kh&ocirc;ng thể)</p>
<h3><strong>X&acirc;y dựng Codeception dựa tr&ecirc;n nền Yii2 </strong></h3>
<h4><strong>Cấu h&igrave;nh của Yii2 </strong></h4>
<p>Project lấy Yii2 Advanced Framework l&agrave;m cơ sở , bao gồm c&aacute;c module ti&ecirc;u chuẩn frontend, backend, console, common. Lần n&agrave;y ta sẽ lấy frontend l&agrave;m đối tượng để viết test, trong thư mục gốc của Project ta thiết lập 1 file codeception.yml như b&ecirc;n dưới. Trong mục include ta thiết lập module frontend, sau n&agrave;y nếu viết test cho c&aacute;c module kh&aacute;c th&igrave; ta c&oacute; thể th&ecirc;m v&agrave;o tiếp theo.</p>
<p><em>codeception.yml</em></p>
<pre class="language-php"><code># global codeception file to run tests from all apps
include:
    - frontend
paths:
    log: logs
settings:
    colors: true</code></pre>
<p>Để sinh ra c&aacute;c test template ta chạy command ph&iacute;a dưới trong c&aacute;c thư mục của từng&nbsp;module.</p>
<pre class="language-php"><code>$ ../vendor/bin/codecept bootstrap</code></pre>
<p>Lần n&agrave;y để c&oacute; thể&nbsp;test kiểm tra c&aacute;c response khi request tới c&aacute;c URL, ta chuẩn bị c&aacute;c file config ở trong c&aacute;c module (codeception.yml) v&agrave; ở acceptance(acceptance.suite.yml). Thiết lập sao cho c&oacute; thể sử dụng được thư viện HTTP client của Yii2 như &nbsp;ph&iacute;a dưới .</p>
<p><em>frontend/codeception.yml</em></p>
<pre class="language-php"><code>namespace: frontend\tests  
actor: AcceptanceTester  
paths:  
    tests: tests
    log: tests/_output
    data: tests/_data
    helpers: tests/_support
settings:  
    bootstrap: _bootstrap.php
    colors: true
    memory_limit: 1024M
modules:  
    enabled:
        - Yii2:
            part: [httpclient]
            configFile: 'config/test.php'</code></pre>
<p>Frontend th&igrave; được test dựa tr&ecirc;n browser n&ecirc;n ta sử dụng WebDriver để test . C&aacute;c m&ocirc;i trường Staging v&agrave; Product c&oacute; URL kh&aacute;c nhau ch&iacute;nh v&igrave; vậy ta ph&acirc;n t&aacute;ch từng m&ocirc;i trường ri&ecirc;ng biệt ra . Ngo&agrave;i ra ta cũng c&oacute; thể th&ecirc;m nhiều module kh&aacute;c nhau, v&iacute; dụ như th&ecirc;m REST module sẽ cho ph&eacute;p bạn c&oacute; thể test dựa tr&ecirc;n HTTP.</p>
<p><em>frontend/tests/acceptance.suite.yml</em></p>
<pre class="language-php"><code>class_name: AcceptanceTester  
modules:  
    enabled:
        - WebDriver:
    config:
        WebDriver:
           browser: phantomjs
           host: '192.168.33.20'
           clear_cookies: true
           capabilities:
               phantomjs.page.settings.userAgent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36
<p>env:<br>
staging:<br>
modules:<br>
config:<br>
WebDriver:<br>
url: <a href="https://stg-gmo.example.com">https://stg-gmo.example.com</a></p>
<pre><code>prod:
    modules:
        config:
            WebDriver:
                url: https://gmo.example.com &lt;/code&gt;&lt;/pre&gt;
</code></pre>
<h4><strong>Chuyển đổi qua lại c&aacute;c m&ocirc;i trường test </strong></h4>
<p>Ta c&oacute; thể chuyển đổi m&ocirc;i trường test khi chạy th&ocirc;ng qua option --env , th&ocirc;ng tin về c&aacute;c m&ocirc;i trường được thiết lập trong file frontend/tests/acceptance.suite.yml ph&iacute;a tr&ecirc;n.</p>
<pre class="language-php"><code>vendor/bin/codecept run --env staging</code></pre>
<h4><strong>Chuẩn bị data&nbsp;test </strong></h4>
<p>Trong Codeception ta tạo ra c&aacute;c file dự liệu test v&agrave; cung cấp cho từng test case , v&agrave; cũng c&oacute; thể tạo dữ liệu test t&ugrave;y theo từng m&ocirc;i trường kh&aacute;c nhau.</p>
<p><em> frontend/tests/acceptance/data/common.yml</em></p>
<pre class="language-php"><code>staging:  
    user:
        user_id: 1000
        password: stagingpass
<p>prod:<br>
user:<br>
user_id: 2000<br>
password: prodpass</code></pre></p>
<p>V&iacute; dụ về sử dụng dữ liệu test trong Codeception.</p>
<p><em>frontend/tests/acceptance/DataProviderExampleCest.php</em></p>
<pre class="language-php"><code>&lt;?php
<p>namespace frontend\tests\acceptance;</p>
<p>use Codeception\Example;<br>
use frontend\tests\AcceptanceTester;<br>
use Symfony\Component\Yaml\Yaml;</p>
<p>class DataProviderExampleCest<br>
{<br>
/**<br>
* @dataprovider _provider<br>
*/<br>
public function checkDataProviderExample(AcceptanceTester $I, Example $example)<br>
{<br>
$example['user']['user_id'];<br>
$example['user']['password'];<br>
}</p>
<pre><code>public function _provider()
{
    $common_data = Yaml::parse(file_get_contents(getcwd() . &quot;/frontend/tests/acceptance/data/common.yml&quot;));
    $env = getenv('env');

    return [$common_data[$env]];
}
</code></pre>
<p>}</code></pre></p>
<p>Chạy test theo từng m&ocirc;i trường.(staging)</p>
<pre class="language-php"><code>export env=staging;vendor/bin/codecept run --env $env</code></pre>
<h4><strong>Gmail API v&agrave; c&aacute;ch sử dụng </strong></h4>
<p><a href="https://vietnamlab.vn/blog/2017/05/31/su-dung-google-gmail-api-de-thao-tac-voi-mail/">https://vietnamlab.vn/blog/2017/05/31/su-dung-google-gmail-api-de-thao-tac-voi-mail/ </a></p>
<p>M&igrave;nh c&oacute; viết 1 b&agrave;i chi tiết về c&aacute;ch sử dụng Gmail API bạn n&agrave;o chưa r&otilde; th&igrave; c&oacute; thể tham khảo.</p>
<p>C&aacute;c bước cần chuẩn bị để sử dụng Gmail API</p>
<ul>
<li>Tạo Project từ Google API Console.</li>
<li>Chọn Project vừa được tạo.</li>
<li>Tạo OAuth Client ID từ trang API Manager.</li>
<li>Lấy Client ID v&agrave; Client Secret.</li>
</ul>
<h3><strong>Test c&aacute;c chức nằng li&ecirc;n kết với c&aacute;c service b&ecirc;n ngo&agrave;i. </strong></h3>
<p>T&ocirc;i sẽ giới thiệu về việc l&agrave;m sao để test c&aacute;c chức năng m&agrave; c&oacute; sử dụng c&aacute;c API b&ecirc;n ngo&agrave;i. V&iacute; dụ như viết test case cho chức năng li&ecirc;n quan tới Gmail Khi đăng k&yacute; 1 t&agrave;i khoản mới . Thường ta phải v&ocirc; mail để x&aacute;c nhận việc&nbsp;đăng k&yacute; , với những chức năng như vậy để test được ta phải sử dụng Gmail API. </p>
<p><strong>Test case cho chức năng&nbsp;đăng k&yacute; th&agrave;nh vi&ecirc;n mới c&oacute; sử dụng Gmail API</strong></p>
<p><em>frontend\tests\RegistrationCest.php</em></p>
<pre class="language-php"><code>&lt;?php
<p>namespace frontend\tests\acceptance;</p>
<p>use Codeception\Example;<br>
use frontend\tests\AcceptanceTester;<br>
use frontend\tests\helpers\GmailAPIHelper;</p>
<p>class RegistrationCest extends BaseRegistrationCest<br>
{<br>
const WAIT_TIME_GMO_MAIL_SEND = 3;<br>
const REGEX_DETECT_REGISTRATION_URL = '#(<a href="https://w+">https://w+</a>)#';</p>
<pre><code>/**
 * @dataprovider _provider
 */
public function checkRegistration(AcceptanceTester $I, Example $example)
{
    $gmail = $example['gmail'];
    $member = $example['member'];

    $I-&amp;gt;wantTo('新規登録する');
    $I-&amp;gt;amOnPage('/');
    $I-&amp;gt;click('新規登録');

    $I-&amp;gt;fillField('email', $member['email']);
    $I-&amp;gt;click('次へ');
    // メールが受信されるまで待つ
    $I-&amp;gt;wait(self::WAIT_TIME_GMO_MAIL_SEND);

    $access_token = GmailAPIHelper::getAccessToken($gmail['client_id'], $gmail['client_secret'], $gmail['refresh_token']);
    $message_id = GmailAPIHelper::getLatestMessageId($access_token);
    $content = GmailAPIHelper::getMessageContent($message_id, $access_token);
    // メールの本文から登録URLを抽出する
    $registration_url = self::detectRegistrationUrl($content);

    $I-&amp;gt;amOnPage($registration_url);
    $I-&amp;gt;see('新規登録');
    $I-&amp;gt;fillField('password', $member['password']);
    $I-&amp;gt;fillField('password_confirm', $member['password']);
    $I-&amp;gt;click('同意して登録する');
}

private static function detectRegistrationUrl($content)
{
    preg_match(self::REGEX_DETECT_REGISTRATION_URL, $content, $m);

    return $m[1];
}
</code></pre>
<p>}</code></pre></p>
<p>Để c&oacute; thể sử dụng được Gmail API ta phải lấy đươc access token , từ c&aacute;i mail ID mới nhất ta lấy được nội dung mail. Tham khảo ở link ph&iacute;a tr&ecirc;n để hiểu r&otilde; hơn về Gmail API.</p>
<p><em>frontend\tests\helpers\GmailAPIHelper.php</em></p>
<pre class="language-php"><code>&lt;?php
<p>namespace frontend\tests\helpers;</p>
<p>use yii\httpclient\Client;</p>
<p>class GmailAPIHelper<br>
{<br>
const HTTP_HEADER_OAUTH2_AUTH_ACCESS_TOKEN = 'Authorization';</p>
<pre><code>const GOOGLE_API_URL_OAUTH2 = 'https://accounts.google.com/o/oauth2';
const GOOGLE_API_URL_OAUTH2_ISSUE_TOKEN = self::GOOGLE_API_URL_OAUTH2 . '/token';

const GOOGLE_API_SCOPE_GMAIL_READONLY = 'https://www.googleapis.com/auth/gmail.readonly';

const GOOGLE_API_OAUTH2_GRANT_TYPE_AUTHORIZATION_CODE = 'authorization_code';
const GOOGLE_API_OAUTH2_GRANT_TYPE_REFRESH_TOKEN = 'refresh_token';

const GMAIL_API_MESSAGES_URL = 'https://www.googleapis.com/gmail/v1/users/%s/messages/';
const GMAIL_API_MESSAGE_URL = 'https://www.googleapis.com/gmail/v1/users/%s/messages/%s';
const GMAIL_API_REDIRECT_URI = 'urn:ietf:wg:oauth:2.0:oob';

const GMAIL_TARGET_USER = 'me';
const GMAIL_MESSAGES_MAX_RESULTS = 1;

public static function getAccessToken($client_id, $client_secret, $refresh_token)
{
    $url = self::GOOGLE_API_URL_OAUTH2_ISSUE_TOKEN;
    $grant_type = self::GOOGLE_API_OAUTH2_GRANT_TYPE_REFRESH_TOKEN;
    $params = compact('client_id', 'client_secret', 'grant_type', 'refresh_token');
    $content = json_decode((new Client())-&amp;gt;post($url, $params)-&amp;gt;send()-&amp;gt;content, true);

    return $content['access_token'];
}

public static function getLatestMessageId($access_token)
{
    $url = sprintf(self::GMAIL_API_MESSAGES_URL, self::GMAIL_TARGET_USER);
    $maxResults = self::GMAIL_MESSAGES_MAX_RESULTS;
    $params = compact('maxResults');
    $headers = [self::HTTP_HEADER_OAUTH2_AUTH_ACCESS_TOKEN =&amp;gt; &quot;Bearer {$access_token}&quot;];

    $content = json_decode((new Client())-&amp;gt;get($url, $params, $headers)-&amp;gt;send()-&amp;gt;content, true);

    return $content['messages'][0]['id'];
}

public static function getMessageContent($message_id, $access_token)
{
    $url = sprintf(self::GMAIL_API_MESSAGE_URL, self::GMAIL_TARGET_USER, $message_id);
    $params = [];
    $headers = [self::HTTP_HEADER_OAUTH2_AUTH_ACCESS_TOKEN =&amp;gt; &quot;Bearer {$access_token}&quot;];

    $content = json_decode((new Client())-&amp;gt;get($url, $params, $headers)-&amp;gt;send()-&amp;gt;content, true);

    return base64_decode($content['payload']['body']['data']);
}
</code></pre>
<p>}</code></pre></p>
<p><strong>Test chức năng đăng nhập th&ocirc;ng qua t&agrave;i khoản Google account.</strong></p>
<p><em>frontend\tests\acceptance\social\google\LoginCest.php</em></p>
<pre class="language-php"><code>&lt;?php
<p>namespace frontend\tests\acceptance\social\google;</p>
<p>use Codeception\Example;<br>
use frontend\tests\AcceptanceTester;<br>
use frontend\tests\helpers\CleanUpHelper;<br>
use Symfony\Component\Yaml\Yaml;<br>
/**</p>
<ul>
<li>
<p>Googleログイン用のベースクラス<br>
*/<br>
abstract class LoginCest<br>
{<br>
const FIELD_NAME_GOOGLE_LOGIN_FORM= 'identifier';<br>
const FIELD_NAME_GOOGLE_PASSWORD_FORM = 'password';<br>
const FIELD_ID_GOOGLE_LOGIN_NEXT_BUTTON = 'identifierNext';<br>
const FIELD_ID_GOOGLE_PASSWORD_NEXT_BUTTON = 'passwordNext';</p>
<p>const WAIT_TIME_EMULATE_HUMAN_OPERATION = 1;</p>
<p>public function checkLogin(AcceptanceTester $I, Example $example)<br>
{<br>
$I-&gt;wantTo('Googleアカウントを使ってログインする');<br>
$I-&gt;amOnUrl(&quot;https://{$example['hosts']['gmo_id']}&quot;);<br>
$I-&gt;amOnPage('/');<br>
$I-&gt;click('ログイン');<br>
$I-&gt;click('Googleでログイン');<br>
$I-&gt;wait(self::WAIT_TIME_EMULATE_HUMAN_OPERATION);</p>
<pre><code> $I-&amp;gt;fillField(self::FIELD_NAME_GOOGLE_LOGIN_FORM, $example['member']['login']);
 $I-&amp;gt;wait(self::WAIT_TIME_EMULATE_HUMAN_OPERATION);

 $I-&amp;gt;click('#'.self::FIELD_ID_GOOGLE_LOGIN_NEXT_BUTTON);
 $I-&amp;gt;wait(5);

 $I-&amp;gt;waitForElement('#passwordNext', 5);
 $I-&amp;gt;fillField(self::FIELD_NAME_GOOGLE_PASSWORD_FORM, $example['member']['g-password']);
 $I-&amp;gt;wait(self::WAIT_TIME_EMULATE_HUMAN_OPERATION);

 $I-&amp;gt;click('#'.self::FIELD_ID_GOOGLE_PASSWORD_NEXT_BUTTON);
 $I-&amp;gt;wait(5);

 $I-&amp;gt;see('現在のポイント');
</code></pre>
<p>}</p>
<p>public function _provider()<br>
{<br>
$common_data = Yaml::parse(file_get_contents(getcwd() . &quot;/frontend/tests/acceptance/data/common.yml&quot;));<br>
$google_common_data = Yaml::parse(file_get_contents(getcwd() . &quot;/frontend/tests/acceptance/data/social/google/common.yml&quot;));<br>
$env = explode('-', getenv('env'))[0];</p>
<pre><code> return [array_merge($common_data[$env], $google_common_data[$env])];
</code></pre>
<p>}<br>
}<br>
</code></pre></p>
</li>
</ul>
<h3><strong>Kết &nbsp;luận</strong></h3>
<p>Việc c&agrave;i&nbsp;đặt th&ecirc;m module PhantomJS gi&uacute;p ta viết test&nbsp;được dễ d&agrave;ng hơn rất nhiều với những trang c&oacute; Javascript , tuy&nbsp;vẫn c&oacute; những&nbsp;trường hợp kh&ocirc;ng viết test&nbsp;được , nhưng phần lớn n&oacute;&nbsp;đ&atilde; gi&uacute;p ta tiết kiệm&nbsp;được kh&aacute; nhiều thời gian trong việc test c&aacute;c&nbsp;ứng dụng.</p><!--kg-card-end: markdown-->
            </section>

            <div class="post-footer">
                <div class="share-button">
                    <div class="fb-share-button" data-href="/test-tu-dong-cac-chuc-nang-lien-quan-toi-mail-va-cac-api-ben-ngoai-bang-codeception/" data-layout="button_count" data-size="large" data-mobile-iframe="true">
                    </div>
                </div>

                <div class="share-button">
                    <a class="twitter-share-button" data-size="large" href="https://twitter.com/intent/tweet?text=Test%20t%E1%BB%B1%20%C4%91%E1%BB%99ng%20c%C3%A1c%20ch%E1%BB%A9c%20n%C4%83ng%20li%C3%AAn%20quan%20t%E1%BB%9Bi%20Mail%20v%C3%A0%20c%C3%A1c%20API%20b%C3%AAn%20ngo%C3%A0i%20b%E1%BA%B1ng%20Codeception">
                        Tweet
                    </a>
                </div>

                <div class="share-button">
                    <div class="g-plusone" data-href="/test-tu-dong-cac-chuc-nang-lien-quan-toi-mail-va-cac-api-ben-ngoai-bang-codeception/"></div>
                </div>
            </div>
            <div id="widget-for-reem-10-1"></div><script src="https://reem.vn/reem.js?m=10"></script>
        </article>


        <div class="post-comments">
            <div class="fb-comments" data-href="https://blog.vietnamlab.vn/test-tu-dong-cac-chuc-nang-lien-quan-toi-mail-va-cac-api-ben-ngoai-bang-codeception/" data-numposts="10" data-order-by="reverse_time" data-width="100%"></div>
        </div>
</div>
<div class="col-lg-3">
    <div id="sidebar">

    <gcse:search></gcse:search>

    <div class='sidebar-box'>
        <div id="widget-for-reem-4-1"></div><script src="https://163.44.192.76/rem.js?m=4"></script>
    </div>
    <div class="sidebar-box">
        <div class="sidebar-title h2">Tuyển dụng</div>
        <div class="sidebar-content">
          <a class="title" href="https://blog.vietnamlab.vn/tuyen-dung">
            <img
              style="max-width: 100%"
              src="https://drive.google.com/uc?id=1aYKdTvr-4CYterc6pPPBYoFezghrkGZf"
              alt="Tuyển dụng">
          </a>
        </div>
    </div>

    <div class="sidebar-box">
        <div class="sidebar-title h2">Facebook</div>
        <div class="sidebar-content">
            <div class="fb-page" data-href="https://www.facebook.com/vietnamlab.vn" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-width="500" data-show-facepile="true">
                <blockquote cite="https://www.facebook.com/vietnamlab.vn" class="fb-xfbml-parse-ignore">
                    <a href="https://www.facebook.com/vietnamlab.vn">GMO-Z.com Vietnam Lab Center</a>
                </blockquote>
            </div>
        </div>
    </div>

    <div class="sidebar-box">
        <div class="sidebar-title h2">Mục lục</div>
        <div class="sidebar-content js-toc"></div>
    </div>

    
    <div class="sidebar-box">
        <div class="sidebar-title h2">Tin tức</div>
        <div class="sidebar-content">
                    <div class="media">
                        <div class="media-left">
                            <a href="../bao-cao-nghien-cuu-quy-3/index.html">
                                    <img style="object-fit: cover" class="media-object" src="../content/images/1CSKMZA-hwBOtsfRK0JjjcNZUrF80lGLt.PNG" width="50" height="50" alt="Báo cáo nghiên cứu quý 3 năm 2020">
                            </a>
                        </div>
                        <div class="media-body">
                            <a class="title" href="../bao-cao-nghien-cuu-quy-3/index.html">Báo cáo nghiên cứu quý 3 năm 2020</a>
                            <span>, 30 October 2020</span>
                        </div>
                    </div>
                    <div class="media">
                        <div class="media-left">
                            <a href="../untitled-9/index.html">
                                    <img style="object-fit: cover" class="media-object" src="https://drive.google.com/uc?id&#x3D;19caFAeGojP08PERt9NhyH-tZln5o1dyt&amp;export&#x3D;download" width="50" height="50" alt="Rộn ràng đón tết trung thu 2020">
                            </a>
                        </div>
                        <div class="media-body">
                            <a class="title" href="../untitled-9/index.html">Rộn ràng đón tết trung thu 2020</a>
                            <span>, 25 September 2020</span>
                        </div>
                    </div>
                    <div class="media">
                        <div class="media-left">
                            <a href="../truyen-thong-hoc-tieng-nhat/index.html">
                                    <img style="object-fit: cover" class="media-object" src="https://drive.google.com/uc?id&#x3D;19mB9PZcsjUoxU5mbNYE49Ai0dMUlOPt8&amp;export&#x3D;download" width="50" height="50" alt="Truyền Thống học tiếng Nhật tại VNLAB.">
                            </a>
                        </div>
                        <div class="media-body">
                            <a class="title" href="../truyen-thong-hoc-tieng-nhat/index.html">Truyền Thống học tiếng Nhật tại VNLAB.</a>
                            <span>, 14 August 2020</span>
                        </div>
                    </div>
                    <div class="media">
                        <div class="media-left">
                            <a href="../team-building-vuon-quoc-gia-ba-vi-2020/index.html">
                                    <img style="object-fit: cover" class="media-object" src="https://drive.google.com/uc?id&#x3D;1vCDL4ACVJLRYbc_bMUF-XtOkBYCmlvFL&amp;export&#x3D;download" width="50" height="50" alt="Team Building Vườn Quốc Gia Ba Vì 2020">
                            </a>
                        </div>
                        <div class="media-body">
                            <a class="title" href="../team-building-vuon-quoc-gia-ba-vi-2020/index.html">Team Building Vườn Quốc Gia Ba Vì 2020</a>
                            <span>, 30 June 2020</span>
                        </div>
                    </div>
                    <div class="media">
                        <div class="media-left">
                            <a href="../bao-cao-nghien-cuu-quy-1-nam-2020/index.html">
                                    <img style="object-fit: cover" class="media-object" src="https://drive.google.com/uc?id&#x3D;13zVnT-6TUc6EkCcZox_nn2PHeBSxihYm&amp;export&#x3D;download" width="50" height="50" alt="Báo cáo nghiên cứu Quý 1 năm 2020">
                            </a>
                        </div>
                        <div class="media-body">
                            <a class="title" href="../bao-cao-nghien-cuu-quy-1-nam-2020/index.html">Báo cáo nghiên cứu Quý 1 năm 2020</a>
                            <span>, 20 April 2020</span>
                        </div>
                    </div>
        </div>
    </div>

    <div class="sidebar-box">
        <div class="sidebar-title h2">Key words</div>
        <div class="sidebar-content">
                    <span class="label label-default text-justify tag">
                        <a href="../tag/%2508google-apps-script/index.html" title="google apps script" class="tag tag-5c2c443cc00d970001d28829 google-apps-script">google apps script</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="https://blog.vietnamlab.vn/404/" title="#api" class="tag tag-5e813cddf7370d0001b812c4 hash-api">#api</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="https://blog.vietnamlab.vn/404/" title="#drakov" class="tag tag-5ad30b8d83719800014583ed drakov">#drakov</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="https://blog.vietnamlab.vn/404/" title="#mock" class="tag tag-5e798cb6f7370d0001b812ae hash-mock">#mock</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="https://blog.vietnamlab.vn/404/" title="#test" class="tag tag-5e798cb6f7370d0001b812af hash-test">#test</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="https://blog.vietnamlab.vn/404/" title="#web" class="tag tag-5e813cddf7370d0001b812c5 hash-web">#web</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/10-meo-2/index.html" title="10 mẹo" class="tag tag-5ad30b8d837198000145843b 10-meo-2">10 mẹo</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/10-tips/index.html" title="10 tips" class="tag tag-5ad30b8d8371980001458432 10-tips">10 tips</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/2017/index.html" title="2017" class="tag tag-5ad30b8d8371980001458463 2017">2017</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/2018/index.html" title="2018" class="tag tag-5ad30b8d8371980001458464 2018">2018</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/2020/index.html" title="2020" class="tag tag-5e05cac4bf919d0001802e79 2020">2020</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/adaptive-threshold/index.html" title="adaptive threshold" class="tag tag-5ad30b8d8371980001458462 adaptive-threshold">adaptive threshold</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/adb/index.html" title="adb" class="tag tag-5d479f1fbf919d00018028c9 adb">adb</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/adsense/index.html" title="adsense" class="tag tag-5ad30b8d83719800014583a8 adsense">adsense</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/aff/index.html" title="aff" class="tag tag-5b6119898371980001458b0d aff">aff</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/agile/index.html" title="agile" class="tag tag-5ad30b8d837198000145834b agile">agile</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/ai/index.html" title="AI" class="tag tag-5ad30b8d8371980001458441 ai">AI</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/alert/index.html" title="alert" class="tag tag-5c2c443cc00d970001d2882a alert">alert</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/algorithm/index.html" title="Algorithm" class="tag tag-5e3bb937f7370d0001b8122e algorithm">Algorithm</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/android/index.html" title="android" class="tag tag-5ad30b8d837198000145834c android">android</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/android-studio/index.html" title="android studio" class="tag tag-5ad30b8d83719800014583ce android-studio">android studio</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/anguar-cli/index.html" title="anguar cli" class="tag tag-5ad30b8d837198000145834d anguar-cli">anguar cli</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/angular2/index.html" title="angular2" class="tag tag-5ad30b8d837198000145834e angular2">angular2</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/angular9/index.html" title="angular9" class="tag tag-5ea7b0b5f7370d0001b8132d angular9">angular9</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/ansible/index.html" title="Ansible" class="tag tag-5ad30b8d8371980001458450 ansible">Ansible</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/ant/index.html" title="ant" class="tag tag-5ad30b8d8371980001458398 ant">ant</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/apache/index.html" title="apache" class="tag tag-5ad30b8d837198000145834f apache">apache</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/apache-hive/index.html" title="Apache Hive" class="tag tag-5ad30b8d8371980001458351 apache-hive">Apache Hive</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/apache-knox/index.html" title="Apache Knox" class="tag tag-5ad30b8d8371980001458352 apache-knox">Apache Knox</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/apache-knox-gateway/index.html" title="Apache Knox Gateway" class="tag tag-5ad30b8d8371980001458353 apache-knox-gateway">Apache Knox Gateway</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/apache-poi/index.html" title="Apache POI" class="tag tag-5ad30b8d83719800014583d4 apache-poi">Apache POI</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/api/index.html" title="api" class="tag tag-5ad30b8d83719800014583c1 api">api</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/apiary-editor/index.html" title="apiary editor" class="tag tag-5ad30b8d83719800014583bf apiary-editor">apiary editor</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/application/index.html" title="application" class="tag tag-5bc99b038f5b6d0001832bfa application">application</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/ar/index.html" title="ar" class="tag tag-5ad30b8d8371980001458404 ar">ar</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/artoolkit/index.html" title="artoolkit" class="tag tag-5ad30b8d8371980001458405 artoolkit">artoolkit</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/aso/index.html" title="aso" class="tag tag-5b6119898371980001458b08 aso">aso</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/association-rules/index.html" title="Association Rules" class="tag tag-5ad30b8d83719800014583c5 association-rules">Association Rules</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/asynchronous/index.html" title="asynchronous" class="tag tag-5ad30b8d8371980001458355 asynchronous">asynchronous</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/atom/index.html" title="atom" class="tag tag-5ad30b8d83719800014583fd atom">atom</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/autoencoder/index.html" title="autoencoder" class="tag tag-5bfa780f165b57000125175c autoencoder">autoencoder</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/automation-testing/index.html" title="automation testing" class="tag tag-5ad30b8d83719800014583fe automation-testing">automation testing</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/awk/index.html" title="awk" class="tag tag-5ad30b8d8371980001458356 awk">awk</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/aws/index.html" title="AWS" class="tag tag-5ee65390f7370d0001b813e7 aws">AWS</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/aws-certified/index.html" title="AWS Certified" class="tag tag-5f262d1bf7370d0001b8146b aws-certified">AWS Certified</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/backend/index.html" title="backend" class="tag tag-5b30687483719800014589a0 backend">backend</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/backend2018/index.html" title="backend2018" class="tag tag-5b30687483719800014589a1 backend2018">backend2018</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/bao-cao/index.html" title="báo cáo" class="tag tag-5f9a48c4128d0900010f5c3f bao-cao">báo cáo</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/basictype/index.html" title="BasicType" class="tag tag-5ad30b8d83719800014583d9 basictype">BasicType</a>
                    </span>
                    <span class="label label-default text-justify tag">
                        <a href="../tag/bcrypt/index.html" title="bcrypt" class="tag tag-5d96a6f2bf919d0001802d24 bcrypt">bcrypt</a>
                    </span>
        </div>
    </div>
</div>
</div>
<div class="col-lg-offset-1"></div>


    </div>

    <div id="footer">
        <div class="row">
            <div class="col-lg-offset-1 col-lg-10 copyright">
                <a href="../index.html">GMO-Z.com Vietnam Lab Center Technology Blog</a> &copy; 2020
            </div>
            <div class="col-lg-offset-1"></div>
        </div>
    </div>

    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-166653304-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-166653304-2');
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59342535-1', 'auto');
  ga('send', 'pageview');
</script>

<script>
MathJax = {
  tex: {
    inlineMath: [['\\(', '\\)']]
  },
  svg: {
    fontCache: 'global'
  }
};
</script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Libraries -->
    <script type="text/javascript" src="../assets/js/libs/jquery.fitvids.min.js?v=52156bd6b0"></script>
    <script type="text/javascript" src="../assets/js/libs/tocbot.min.js?v=52156bd6b0"></script>
    <script type="text/javascript" src="../assets/js/libs/bootstrap.min.js?v=52156bd6b0"></script>
    <script type="text/javascript" src="../assets/js/libs/highlight.pack.js?v=52156bd6b0"></script>

    <!-- Custom JS -->
    <script type="text/javascript" src="../assets/js/app/index.js?v=52156bd6b0"></script>

    <!-- App Services -->
    <script type="text/javascript" charset="UTF-8" src="https://cache.img.gmo.jp/common_header/script.js" async></script>
    <script src="https://apis.google.com/js/platform.js" async defer>{ lang: 'vi' }</script>

</body>

</html>