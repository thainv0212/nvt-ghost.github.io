<!DOCTYPE html>
<html ⚡>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

    <title>Nhập môn docker - Dockerizing a Node.js web app and Mysql</title>

    <meta name="description" content="Tại sao nên dùng Docker
Cài đặt Docker
Các thành phần cơ bản của Docker
Cài đặt và cấu hình Docker-compose
Demo ứng dụng chat with Nodejs and mysql Kết luận" />
    <link rel="canonical" href="../index.html" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    
    <meta property="og:site_name" content="GMO-Z.com Vietnam Lab Center Technology Blog" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Nhập môn docker - Dockerizing a Node.js web app and Mysql" />
    <meta property="og:description" content="Tại sao nên dùng Docker
Cài đặt Docker
Các thành phần cơ bản của Docker
Cài đặt và cấu hình Docker-compose
Demo ứng dụng chat with Nodejs and mysql Kết luận" />
    <meta property="og:url" content="https://blog.vietnamlab.vn/nhap-mon-docker-dockerizing-a-node-js-web-app-and-mysql/" />
    <meta property="og:image" content="https://drive.google.com/uc?id&#x3D;0B05rqFCwNCjkMGpKdXdoWjFqbGM&amp;export&#x3D;download" />
    <meta property="article:published_time" content="2017-10-24T01:11:00.000Z" />
    <meta property="article:modified_time" content="2018-08-26T03:34:36.000Z" />
    <meta property="article:tag" content="docker with nodejs" />
    <meta property="article:tag" content="nhập môn docker" />
    <meta property="article:tag" content="docker cho người bắt đầu" />
    
    <meta property="article:publisher" content="https://www.facebook.com/vietnamlab.vn" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Nhập môn docker - Dockerizing a Node.js web app and Mysql" />
    <meta name="twitter:description" content="Tại sao nên dùng Docker
Cài đặt Docker
Các thành phần cơ bản của Docker
Cài đặt và cấu hình Docker-compose
Demo ứng dụng chat with Nodejs and mysql Kết luận" />
    <meta name="twitter:url" content="https://blog.vietnamlab.vn/nhap-mon-docker-dockerizing-a-node-js-web-app-and-mysql/" />
    <meta name="twitter:image" content="https://drive.google.com/uc?id&#x3D;0B05rqFCwNCjkMGpKdXdoWjFqbGM&amp;export&#x3D;download" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="N.X.P" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="docker with nodejs, nhập môn docker, docker cho người bắt đầu" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "GMO-Z.com Vietnam Lab Center Technology Blog",
        "url": "https://blog.vietnamlab.vn/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://blog.vietnamlab.vn/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "N.X.P",
        "image": {
            "@type": "ImageObject",
            "url": "https://drive.google.com/uc?id=1ey3d-hkzyw7sUxoxSNSNVlTPDeoVuhCq&export=download",
            "width": 1738,
            "height": 1412
        },
        "url": "https://blog.vietnamlab.vn/author/phongnx/",
        "sameAs": []
    },
    "headline": "Nhập môn docker - Dockerizing a Node.js web app and Mysql",
    "url": "https://blog.vietnamlab.vn/nhap-mon-docker-dockerizing-a-node-js-web-app-and-mysql/",
    "datePublished": "2017-10-24T01:11:00.000Z",
    "dateModified": "2018-08-26T03:34:36.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://drive.google.com/uc?id=0B05rqFCwNCjkMGpKdXdoWjFqbGM&export=download"
    },
    "keywords": "docker with nodejs, nhập môn docker, docker cho người bắt đầu",
    "description": "Nội dung:\n * Mở đầu\n * Tại sao nên dùng Docker\n * Cài đặt Docker\n * Các thành phần cơ bản của Docker\n * Cài đặt và cấu hình Docker-compose\n * Demo ứng dụng chat with Nodejs and mysql\n * Kết luận\n * Tài liệu tham khảo\n\nMở đầu\nKhi bắt đầu tìm hiểu về docker, mình đã đọc nhiều bài blog và đều có một hoang\nmang là docker thật sự ghê gớm cùng với nhiều khái niệm khó nuốt. Với người có\nít kinh nghiệm làm việc với máy ảo, ít kinh nghiệm về công nghệ ảo hóa thì thật\nsự đọc qua mấy bài blog vẫn chưa hiểu",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://blog.vietnamlab.vn/"
    }
}
    </script>

    <meta name="generator" content="Ghost 3.36" />
    <link rel="alternate" type="application/rss+xml" title="GMO-Z.com Vietnam Lab Center Technology Blog" href="../../rss/index.html" />

    <style amp-custom>
    *,
    *::before,
    *::after {
        box-sizing: border-box;
    }

    html {
        overflow-x: hidden;
        overflow-y: scroll;
        font-size: 62.5%;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    }

    body {
        min-height: 100vh;
        margin: 0;
        padding: 0;
        color: #3a4145;
        font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;
        font-size: 1.7rem;
        line-height: 1.55em;
        font-weight: 400;
        font-style: normal;
        background: #fff;
        scroll-behavior: smooth;
        overflow-x: hidden;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    p,
    ul,
    ol,
    li,
    dl,
    dd,
    hr,
    pre,
    form,
    table,
    video,
    figure,
    figcaption,
    blockquote {
        margin: 0;
        padding: 0;
    }

    ul[class],
    ol[class] {
        padding: 0;
        list-style: none;
    }

    img {
        display: block;
        max-width: 100%;
    }

    input,
    button,
    select,
    textarea {
        font: inherit;
        -webkit-appearance: none;
    }

    fieldset {
        margin: 0;
        padding: 0;
        border: 0;
    }

    label {
        display: block;
        font-size: 0.9em;
        font-weight: 700;
    }

    hr {
        position: relative;
        display: block;
        width: 100%;
        height: 1px;
        border: 0;
        border-top: 1px solid currentcolor;
        opacity: 0.1;
    }

    ::selection {
        text-shadow: none;
        background: #cbeafb;
    }

    mark {
        background-color: #fdffb6;
    }

    small {
        font-size: 80%;
    }

    sub,
    sup {
        position: relative;
        font-size: 75%;
        line-height: 0;
        vertical-align: baseline;
    }
    sup {
        top: -0.5em;
    }
    sub {
        bottom: -0.25em;
    }

    ul li + li {
        margin-top: 0.6em;
    }

    a {
        color: #1292EE;
        text-decoration-skip-ink: auto;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        margin: 0;
        font-weight: 700;
        color: #121212;
        line-height: 1.4em;
    }

    h1 {
        font-size: 3.4rem;
        line-height: 1.1em;
    }

    h2 {
        font-size: 2.4rem;
        line-height: 1.2em;
    }

    h3 {
        font-size: 1.8rem;
    }

    h4 {
        font-size: 1.7rem;
    }

    h5 {
        font-size: 1.6rem;
    }

    h6 {
        font-size: 1.6rem;
    }

    amp-img {
        height: 100%;
        width: 100%;
        max-width: 100%;
        max-height: 100%;
    }

    amp-img img {
        object-fit: cover;
    }

    .page-header {
        padding: 50px 5vmin 30px;
        text-align: center;
        font-size: 2rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .page-header a {
        color: #121212;
        font-weight: 700;
        text-decoration: none;
        font-size: 1.6rem;
        letter-spacing: -0.1px;
    }

    .post {
        max-width: 680px;
        margin: 0 auto;
    }

    .post-header {
        margin: 0 5vmin 5vmin;
        text-align: center;
    }

    .post-meta {
        margin: 1rem 0 0 0;
        text-transform: uppercase;
        color: #738a94;
        font-weight: 500;
        font-size: 1.3rem;
    }

    .post-image {
        margin: 0 0 5vmin;
    }

    .post-image img {
        display: block;
        width: 100%;
        height: auto;
    }

    .post-content {
        padding: 0 5vmin;
    }

    .post-content > * + * {
        margin-top: 1.5em;
    }

    .post-content [id]:not(:first-child) {
        margin: 2em 0 0;
    }

    .post-content > [id] + * {
        margin-top: 1rem;
    }

    .post-content [id] + .kg-card,
    .post-content blockquote + .kg-card {
        margin-top: 40px;
    }

    .post-content > ul,
    .post-content > ol,
    .post-content > dl {
        padding-left: 1.9em;
    }

    .post-content hr {
        margin-top: 40px;
    }

    .post .post-content hr + * {
        margin-top: 40px;
    }

    .post-content amp-img {
        background-color: #f8f8f8;
    }

    .post-content blockquote {
        position: relative;
        font-style: italic;
    }

    .post-content blockquote::before {
        content: "";
        position: absolute;
        left: -1.5em;
        top: 0;
        bottom: 0;
        width: 0.3rem;
        background: #000;
    }

    .post-content :not(.kg-card):not([id]) + .kg-card {
        margin-top: 40px;
    }

    .post-content .kg-card + :not(.kg-card) {
        margin-top: 40px;
    }

    .kg-card figcaption {
        padding: 1.5rem 1.5rem 0;
        text-align: center;
        font-weight: 500;
        font-size: 1.3rem;
        line-height: 1.4em;
        opacity: 0.6;
    }

    .kg-card figcaption strong {
        color: rgba(0,0,0,0.8);
    }

    .post-content :not(pre) code {
        vertical-align: middle;
        padding: 0.15em 0.4em 0.15em;
        border: #e1eaef 1px solid;
        font-weight: 400;
        font-size: 0.9em;
        line-height: 1em;
        color: #dc0050;
        background: #f0f6f9;
        border-radius: 0.25em;
    }

    .post-content > pre {
        overflow: scroll;
        padding: 16px 20px;
        color: #fff;
        background: #1F2428;
        border-radius: 5px;
        box-shadow: 0 2px 6px -2px rgba(0,0,0,.1), 0 0 1px rgba(0,0,0,.4);
    }

    .kg-embed-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
    }

    .kg-image-card img {
        margin: auto;
    }

    .kg-gallery-card + .kg-gallery-card {
        margin-top: 0.75em;
    }

    .kg-gallery-container {
        position: relative;
    }

    .kg-gallery-row {
        display: flex;
        flex-direction: row;
        justify-content: center;
    }

    .kg-gallery-image {
        width: 100%;
        height: 100%;
    }

    .kg-gallery-row:not(:first-of-type) {
        margin: 0.75em 0 0 0;
    }

    .kg-gallery-image:not(:first-of-type) {
        margin: 0 0 0 0.75em;
    }

    .kg-bookmark-card,
    .kg-bookmark-publisher {
        position: relative;
    }

    .kg-bookmark-container,
    .kg-bookmark-container:hover {
        display: flex;
        flex-wrap: wrap;
        flex-direction: row-reverse;
        color: currentColor;
        background: rgba(255,255,255,0.6);
        font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;
        text-decoration: none;
        border-radius: 5px;
        box-shadow: 0 2px 6px -2px rgba(0, 0, 0, 0.1), 0 0 1px rgba(0, 0, 0, 0.4);
        overflow: hidden;
    }

    .kg-bookmark-content {
        flex-basis: 0;
        flex-grow: 999;
        padding: 20px;
        order: 1;
    }

    .kg-bookmark-title {
        font-weight: 600;
        font-size: 1.5rem;
        line-height: 1.3em;
    }

    .kg-bookmark-description {
        display: -webkit-box;
        max-height: 45px;
        margin: 0.5em 0 0 0;
        font-size: 1.4rem;
        line-height: 1.55em;
        overflow: hidden;
        opacity: 0.8;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }

    .kg-bookmark-metadata {
        margin-top: 20px;
    }

    .kg-bookmark-metadata {
        display: flex;
        align-items: center;
        font-weight: 500;
        font-size: 1.3rem;
        line-height: 1.3em;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .kg-bookmark-description {
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
        overflow: hidden;
    }

    .kg-bookmark-metadata amp-img {
        width: 18px;
        height: 18px;
        max-width: 18px;
        max-height: 18px;
        margin-right: 10px;
    }

    .kg-bookmark-thumbnail {
        display: flex;
        flex-basis: 20rem;
        flex-grow: 1;
        justify-content: flex-end;
    }

    .kg-bookmark-thumbnail amp-img {
        max-height: 200px;
    }

    .kg-bookmark-author {
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
    }

    .kg-bookmark-publisher::before {
        content: "•";
        margin: 0 .5em;
    }

    .kg-width-full.kg-card-hascaption {
        display: grid;
        grid-template-columns: inherit;
    }

    .post-content table {
        border-collapse: collapse;
        width: 100%;
    }

    .post-content th {
        padding: 0.5em 0.8em;
        text-align: left;
        font-size: .75em;
        text-transform: uppercase;
    }

    .post-content td {
        padding: 0.4em 0.7em;
    }

    .post-content tbody tr:nth-child(2n + 1) {
        background-color: rgba(0,0,0,0.1);
        padding: 1px;
    }

    .post-content tbody tr:nth-child(2n + 2) td:last-child {
        box-shadow:
            inset 1px 0 rgba(0,0,0,0.1),
            inset -1px 0 rgba(0,0,0,0.1);
    }

    .post-content tbody tr:nth-child(2n + 2) td {
        box-shadow: inset 1px 0 rgba(0,0,0,0.1);
    }

    .post-content tbody tr:last-child {
        border-bottom: 1px solid rgba(0,0,0,.1);
    }

    .page-footer {
        padding: 60px 5vmin;
        margin: 60px auto 0;
        text-align: center;
        background-color: #f8f8f8;
    }

    .page-footer h3 {
        margin: 0.5rem 0 0 0;
    }

    .page-footer p {
        max-width: 500px;
        margin: 1rem auto 1.5rem;
        font-size: 1.7rem;
        line-height: 1.5em;
        color: rgba(0,0,0,0.6)
    }

    .powered {
        display: inline-flex;
        align-items: center;
        margin: 30px 0 0;
        padding: 6px 9px 6px 6px;
        border: rgba(0,0,0,0.1) 1px solid;
        font-size: 12px;
        line-height: 12px;
        letter-spacing: -0.2px;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
        font-weight: 500;
        color: #222;
        text-decoration: none;
        background: #fff;
        border-radius: 6px;
    }

    .powered svg {
        height: 16px;
        width: 16px;
        margin: 0 6px 0 0;
    }

    @media (max-width: 600px) {
        body {
            font-size: 1.6rem;
        }
        h1 {
            font-size: 3rem;
        }

        h2 {
            font-size: 2.2rem;
        }
    }

    @media (max-width: 400px) {
        h1 {
            font-size: 2.6rem;
            line-height: 1.15em;
        }
        h2 {
            font-size: 2rem;
            line-height: 1.2em;
        }
        h3 {
            font-size: 1.7rem;
        }
    }
    </style>

    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>

    

</head>

<body class="amp-template">
    <header class="page-header">
        <a href="../../index.html">
                GMO-Z.com Vietnam Lab Center Technology Blog
        </a>
    </header>

    <main class="content" role="main">
        <article class="post">

            <header class="post-header">
                <h1 class="post-title">Nhập môn docker - Dockerizing a Node.js web app and Mysql</h1>
                <section class="post-meta">
                    N.X.P -
                    <time class="post-date" datetime="2017-10-24">24 Oct 2017</time>
                </section>
            </header>
            <figure class="post-image">
                <amp-img src="https://drive.google.com/uc?id&#x3D;0B05rqFCwNCjkMGpKdXdoWjFqbGM&amp;export&#x3D;download" width="600" height="340" layout="responsive"></amp-img>
            </figure>
            <section class="post-content">

                <h3>Nội dung:</h3>
<ul>
<li><em>Mở đầu</em></li>
<li><em>Tại sao nên dùng Docker</em></li>
<li><em>Cài đặt Docker</em></li>
<li><em>Các thành phần cơ bản của Docker</em></li>
<li><em>Cài đặt và cấu hình Docker-compose</em></li>
<li><em>Demo ứng dụng chat with Nodejs and mysql</em></li>
<li><em>Kết luận</em></li>
<li><em>Tài liệu tham khảo</em></li>
</ul>
<h3>Mở đầu</h3>
<p>Khi bắt đầu tìm hiểu về docker, mình đã đọc nhiều bài blog và đều có một hoang mang là docker thật sự ghê gớm cùng với nhiều khái niệm khó nuốt. Với người có ít kinh nghiệm làm việc với máy ảo, ít kinh nghiệm về công nghệ ảo hóa thì thật sự đọc qua mấy bài blog vẫn chưa hiểu docker giúp ích gì cho đời.</p>
<p>Đến đây nếu có bạn nào cũng có tình trạng như mình, hay mới bắt đầu tìm hiểu về docker thì cũng đừng hoang mang nhé. Mình sẽ chia sẻ lại một cách chi tiết nhất những gì đã tìm hiểu được, và vận dụng nó như thế nào qua một demo cụ thể. Tất nhiên là bài viết này chỉ mang lại kiến thức cơ bản thôi, để tìm hiểu sâu hơn thì sẽ có các bài viết khác. Bài viết này không trình bày cụ thể các khái niệm hay là cách cài đặt v.v, Nhưng mình sẽ hướng dẫn thông qua các blog mình đã tìm hiểu, Vì đơn giản mình có viết cũng chưa chắc đầy đủ bằng họ. Vậy nên các bạn cứ yên tâm, hy vọng blog này có ích cho bạn.</p>
<h3>I. Tại sao nên dùng Docker</h3>
<p>Đầu tiên xin trích dẫn 2 blog mình đã đọc qua và cho là nó rất hữu ích cho newbie như mình.</p>
<ol>
<li>
<p><a href="https://kipalog.com/posts/Toi-da-dung-Docker-nhu-the-nao" target="_blank">Tôi đã dùng Docker như thế nào? </a></p>
</li>
<li>
<p><a href="http://blog.appconus.com/2016/04/15/docker-cho-nguoi-moi-bat-dau-p1/" target="_blank">Docker cho người mới bắt đầu (P1) </a></p>
</li>
</ol>
<p>Mình tóm tắt lại một chút:</p>
<p>Giả sử bạn search trên mạng có một project viết bằng scala và bạn muốn chạy thử nó. Cách thông thường là cài môi trường phục vụ cho việc chạy project scala rồi get code về rồi chạy. Ngoài cách đó ra thì có cách gì hay hơn không? với lại chỉ muốn chạy nó lên xem như thế nào thôi mà phải cài đặt nhiều thứ trên máy thì mất công quá.<br />
Docker sẽ giúp bạn chỉ với vài dòng lệnh, quá tuyệt vời phải không.</p>
<p><strong>Docker làm được gì</strong></p>
<ul>
<li>Giả lập môi trường trên server ở dưới máy local</li>
<li>Dùng thử một hệ điều hành mới</li>
<li>Chia sẻ môi trường lập trình cho nhóm làm việc</li>
<li>Test song song</li>
<li>Test app trên một hệ điều hành khác</li>
<li>Thử cấu hình cân bằng tải</li>
<li>Thử các tool auto deployment</li>
<li>v.v</li>
</ul>
<p>Sau khi đọc xong 2 bài blog thì các bạn đã có hứng thú tìm hiểu docker chưa. Chúng ta bắt đầu chiến thôi.</p>
<h3>II. Cài đặt docker</h3>
<p>Các bạn có thể tìm cách cài đặt docker tại trang chủ. hoặc tham khảo bài viết bên dưới. Trường hợp của mình cài trên máy ảo Centos: <a href="https://docs.docker.com/engine/installation/linux/docker-ce/centos/">https://docs.docker.com/engine/installation/linux/docker-ce/centos/</a></p>
<p><a href="http://blog.appconus.com/2016/04/17/docker-cho-nguoi-moi-bat-dau-p2/#Cac_thanh_phan_co_ban_cua_Docker" target="_blank">Docker cho người mới bắt đầu (P2) </a></p>
<h3>III. Các thành phần cơ bản của Docker</h3>
<p>Cũng thông qua bài viết Docker cho người mới bắt đầu (P2), đến đây có lẽ các bạn đã phần nào hình dung các thành phần cơ bản của docker như Docker images, container, Docker engine, Docker hub (nhớ tạo cho mình 1 account docker hub nhé).</p>
<h3>IV. Cài đặt và cấu hình Docker-compose</h3>
<p>Bây giờ bạn đã nắm được nhưng kiến thức và thao tác cơ bản với docker rồi chứ. Trước khi trình bày về phần kiến thức hơi nâng cao chút ( Docker-compose) cùng ôn lại một số lệnh docker chút nhé:</p>
<p><a href="https://kipalog.com/posts/Cac-lenh-co-ban-voi-docker">https://kipalog.com/posts/Cac-lenh-co-ban-voi-docker</a></p>
<p>Các bạn đã biết cách pull một images có sẵn từ docker hub về, có thể build một image do mình tự tạo. Các bạn build image bằng cách nào? Đã sử dụng Dockerfile chưa? nếu chưa thì các bạn cần xem qua cách build một image sử dụng Dockerfile: mời bạn tham khảo bài viết dưới đây:</p>
<p><a href="https://viblo.asia/p/huong-dan-build-mot-image-don-gian-tu-dockerfile-gVQvlQAVGZJ">https://viblo.asia/p/huong-dan-build-mot-image-don-gian-tu-dockerfile-gVQvlQAVGZJ</a></p>
<p><a href="https://viblo.asia/p/docker-tao-docker-images-tu-dockerfile-3P0lPORvZox">https://viblo.asia/p/docker-tao-docker-images-tu-dockerfile-3P0lPORvZox</a></p>
<p>file Dockerfile đơn giản hay phức tạp thì về cơ bản các bạn cũng đã biết nó là gì, dùng để làm gì và dùng như thế nào. Chúng ta bắt đầu tìm hiều về Docker composer.</p>
<p>Bài toán: Giả sử bạn muốn xây dựng môi web với nodejs và mysql. Bạn có thể cài đặt nodejs, mysql v.v và chạy trong một container duy nhất. Tuy nhiên đó có phải là cách tốt chưa? với ứng dụng nhỏ thì nó không phải là vấn đề gì lớn cả. Nhưng với ứng dụng lớn, sự tách biệt server là điều hết sức cần thiết.</p>
<p>Việc xây dựng toàn bộ môi trường chạy Web vào một container có thể chưa phải là điều bạn muốn. Bạn muốn chia môi trường này thành các module khác nhau để có thể tái sử dụng ở các dự án khác. Nhu cầu cơ bản nhất là tách biệt cơ sở dữ liệu và server Web để các dự án khác nhau có thể dùng chung một container cơ sở dữ liệu đó. Docker Compose có thể giúp bạn. Nó sẽ giúp chúng ta có thể cấu hình và chạy nhiều container cùng một lúc cho một dự án (hay bao nhiêu dự án thì tuỳ bạn).</p>
<p>Trước hết, cần phải cài đặt Docker Compose, Các bạn tham khảo ở đây:</p>
<p><a href="https://docs.docker.com/compose/install/">https://docs.docker.com/compose/install/</a></p>
<p>Thông tin về Docker Compose, bạn có thể tham khảo thêm <a href="https://docs.docker.com/compose/" target="_blank">ở đây </a>. Nói chung là tôi không muốn giới thiệu nhiều về nó, áp dụng nó vào thực tiễn sẽ là dễ hiểu nhất. Chúng ta sẽ đi qua một demo cụ thể.</p>
<h3>V. Demo ứng dụng chat with Nodejs and mysql</h3>
<p>Nói sơ qua về ứng dụng chat mình sắp docker hóa sau đây, Nó là web chat sử dụng nodejs, framework express, socket io và CSDL mysql. Bài bog trước mình có demo ứng dụng này, tất cả đều được cài đặt ở local. Bây giờ cũng là ứng dụng đó, sau khi bạn get code của mình về và chỉ một lệnh duy nhất: docker-compose up mọi thứ sẽ sẵn sàng cho bạn.</p>
<p>Bạn có thể xem qua phần demo của ứng dụng trước ở bài blog: <a href="https://vietnamlab.vn/blog/2017/05/09/chat-application-with-nodejs-socket-io-mysql-and-express-framework/">https://vietnamlab.vn/blog/2017/05/09/chat-application-with-nodejs-socket-io-mysql-and-express-framework/</a></p>
<h4>1. Get source code project chat app</h4>
<p><a href="https://github.com/phongnx1/docker">https://github.com/phongnx1/docker</a></p>
<p>Các file như:</p>
<ul>
<li><code>docker\NodeJS_ChatApp\Dockerfile</code></li>
<li><code>docker\docker-compose.yml</code></li>
<li><code>docker\NodeJS_ChatApp\startup.sh</code></li>
</ul>
<p>Data mình cũng chuẩn bị sẵn luôn: <code>docker\storage</code></p>
<p>Và bây giờ mình lần lượt gải thích nội dung từng file:</p>
<p>File <code>docker\NodeJS_ChatApp\Dockerfile</code></p>
<pre><code>FROM centos:6
RUN yum -y update
RUN yum -y groupinstall "Development Tools"
RUN yum -y install cronie
# gpg keys listed at https://github.com/nodejs/node
RUN set -ex \
  &amp;&amp; for key in \
    9554F04D7259F04124DE6B476D5A82AC7E37093B \
    94AE36675C464D64BAFA68DD7434390BDBE9B9C5 \
    0034A06D9D9B0064CE8ADF6BF1747F4AD2306D93 \
    FD3A5288F042B6850C66B31F09FE44734EB7990E \
    71DCFD284A79C3B38668286BC97EC7A07EDE3FC1 \
    DD8F2338BAE7501E3DD5AC78C273792F7D83545D \
    B9AE9905FFD7803F25714661B63B535A4C206CA9 \
    C4F0DFFF4E8C1A8236409D08E73BC641CC11F4C8 \
  ; do \
    gpg --keyserver ha.pool.sks-keyservers.net --recv-keys "$key"; \
  done

ENV NPM_CONFIG_LOGLEVEL info
ENV NODE_VERSION 4.4.5

RUN curl -SLO "https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-x64.tar.xz" \
  &amp;&amp; curl -SLO "https://nodejs.org/dist/v$NODE_VERSION/SHASUMS256.txt.asc" \
  &amp;&amp; gpg --batch --decrypt --output SHASUMS256.txt SHASUMS256.txt.asc \
  &amp;&amp; grep " node-v$NODE_VERSION-linux-x64.tar.xz\$" SHASUMS256.txt | sha256sum -c - \
  &amp;&amp; tar -xJf "node-v$NODE_VERSION-linux-x64.tar.xz" -C /usr/local --strip-components=1 \
  &amp;&amp; rm "node-v$NODE_VERSION-linux-x64.tar.xz" SHASUMS256.txt.asc SHASUMS256.txt

CMD [ "node" ]
RUN mkdir -p /usr/src/app
COPY ./NodeJS_ChatApp /usr/src/app
WORKDIR /usr/src/app
RUN chmod +x startup.sh
RUN npm install -g nodemon
</code></pre>
<p>Giải thích: Các câu lệnh trên sẽ lần lượt lấy image CentOS 6 làm gốc, cài các lib dev cần thiết, download và cài node phiên bản 4.4.5, sau đó copy thư mục <code>./NodeJS_ChatApp</code> vào thư mục <code>/usr/src/app</code> và set thư mục mặc định chạy là <code>usr/src/app</code>. Sau khi copy set quyền execute cho file startup.sh và cài đặt nodemon</p>
<p>Việc copy thư mục hiện hành và set thư mục mặc định sẽ giúp các bạn việc sau: code của các bạn ở trên thư mục chứa file Dockerfile sẽ được copy vào container trên Docker và có thể dùng để chạy Node server. 2 lệnh set chmod cho startup.sh và cài đặt nodemon là optional, cái này mình sẽ giải thích sau, đại khái là giúp bạn dev sướng hơn :D</p>
<p>Vậy là đã xong file Dockerfile. Tiếp đến sẽ là Docker-compose</p>
<h4>2. Cấu hình Docker-compose</h4>
<p>Sau khi có file Dockerfile, mình sẽ sử dụng file image này cho web server (NodeJS, Express), còn Database mình sẽ sử dụng image mysql có sẵn của Docker. Tuy nhiên việc cài đặt, rồi link giữa 2 container khá là lằng nhằng, mất thời gian, nên mình sẽ sử dụng tool có tên là Docker-compose để làm hộ mình.</p>
<p>Giá trị của Docker-compose sẽ là giúp các bạn khởi chạy nhiều container, liên kết chúng vào với nhau thông qua 1 file setting, giúp chúng ta không cần viết script mỗi lần khởi chạy nữa, chỉ cần một câu lệnh docker-compose up là môi trường của bạn sẽ sẵn sàng để làm việc.</p>
<p>Không nói nhiều nữa, dưới đây là nội dung file docker-compose.yml cần thiết cho việc chạy docker-compose:</p>
<pre><code>version: '2'
services:
  mysql:
    image: mysql
    container_name: test-mysql
    ports:
      - 6603:3306
    environment:
      MYSQL_ROOT_PASSWORD: "123456"
      MYSQL_DATABASE: "test"
      MYSQL_USER: "testuser1"
      MYSQL_PASSWORD: "123456"
    volumes:
      - ./storage/docker/mysql-data:/var/lib/mysql
  web:
    build:
      context: .
      dockerfile: NodeJS_ChatApp/Dockerfile
    container_name: test-app
    working_dir: /usr/src/app
    command: /bin/bash startup.sh
    volumes:
      - ./NodeJS_ChatApp:/usr/src/app
    ports:
      - "32768:3000"
    depends_on:
      - mysql
</code></pre>
<p>Chi tiết ý nghĩa của từng dòng lệnh các bạn có thể tìm hiểu trên google, ở đây ý nghĩa của chúng đại khái là:</p>
<ul>
<li>Tạo 2 service có tên là mysql và web</li>
<li>Service mysql sử dụng image có tên là mysql, container_name: test-mysql.</li>
<li>Port của mysql là 3306 ở trong container, ở ngoài hệ điều hành thật là 6603</li>
<li>Mình có thiết lập một số biến môi trường như: pass của root: 123456, tạo sẵn một database: test, tạo 1 account: testuser1, pass: 123456</li>
<li>data mình thực hiện link: <code>./storage/docker/mysql-data:/var/lib/mysql</code> tức là đồng bộ thư mục trên hệ điều hành hiện tại của mình <code>./storage/docker/mysql-data</code> với thư mục chứa data trong server mysql <code>/var/lib/mysql</code>. Khi get code về các bạn đã thấy thư mục này có rồi (mình đã tạo sẵn data cho bạn rồi, vậy nên khi up lên là nó link tới và có data luôn)</li>
<li>Service web sử dụng image build từ thư mục <code>NodeJS_ChatApp/</code> (là thư mục chứa file Dockerfile ở trên)</li>
<li>Service web có thư mục làm việc là <code>/usr/src/app</code>, có volumes là thư mục <code>./NodeJS_ChatApp</code> đến thư mục <code>/usr/src/app</code>, nhằm mục đích khi thay đổi nội dung trên thư mục hiện tại ( code ), thì dữ liệu sẽ lập tức được cập nhật trên thư mục <code>/usr/src/app</code></li>
<li>Service web có command khởi chạy là <code>/bin/bash startup.sh</code></li>
<li>Service web phụ thuộc vào service mysql, nếu service mysql không chạy thì service web sẽ không hoạt động.</li>
</ul>
<p>Vậy là xong, bạn đã tạo ra 2 service có thể dùng để chạy server NodeJS và server database (mysql), còn một bước cuối cùng sẽ là file startup.sh.<br />
File <code>docker\NodeJS_ChatApp\startup.sh</code></p>
<pre><code>if [ ! -d /usr/src/app/node_modules ]; then
  echo "Install dependencies..."
  cd /usr/src/app &amp;&amp; npm install --no-bin-links
fi
cd /usr/src/app &amp;&amp; nodemon -L index.js
</code></pre>
<p>File này sẽ là file khởi chạy của service web mỗi khi docker-compose up.<br />
Mục đích của file này là sẽ chạy lệnh npm install nếu như không tìm thấy thư mục node_modules trong thư mục hiện tại, với các đặc điểm sau:</p>
<ul>
<li>Cài đặt các node_modules cho việc phát triển một cách tự động</li>
<li>Tránh việc phải upload node_modules lên repo</li>
<li>Vì cài đặt bên trong container nên nếu muốn update node_modules, cần vào container -&gt; suy nghĩ kỹ trước khi update =))</li>
</ul>
<p>Sau khi xong xuôi các file trên, các bạn sẽ có một môi trường chạy ExpressJS cùng Mysql để phát triển.</p>
<p>Một lưu ý nữa là mình dùng nodemon để khởi động web server với câu lệnh : <code>nodemon -L index.js</code>. Trong trường hợp webservice của các bạn sử dụng file khởi chạy là file khác, mời đổi lại tên file.<br />
Đồng thời việc sử dụng nodemon sẽ giúp code của các bạn ngay khi có thay đổi sẽ được cập nhật lên web service bằng cách... khởi động lại web service :D<br />
Vì thời gian khởi động webservice của Express rất là không đáng kể, nên bạn có thể bật Sublime, bấm Ctrl + S liên tục để xem output thông báo server khởi động lại của ExpressJS :D</p>
<h4>3. Demo</h4>
<p>Mình thực hiện các thao tác trên hệ máy ảo CentOS, nếu bạn đang demo ứng dụng này ở một hệ điều hành khác cũng đừng lo lắng. chỉ cần đã cài đặt docker và docker-composer thì OK, bắt đầu nào!!!</p>
<p>di chuyển đến thư mục chưa file docker-compose.yml(thư mục bạn get code về: docker), chạy lệnh: docker-compose up</p>
<p>Bạn sẽ phải đợi một tý, vì nó phải tải máy ảo CentOS, mysql v.v nên sẽ hơi lâu một tý. Kết quả sau khi chạy xong, nó sẽ run file startup.sh như hình bên dưới:<br />
<amp-img src="https://drive.google.com/uc?id=0B05rqFCwNCjkUXUwT0tZenl1STQ&amp;export=download" alt width="1166" height="689" layout="responsive"></amp-img></p>
<p>Server đã start lên rồi. Vấn đề bây giờ là, chúng ta sẽ truy cập ứng dụng chứng ta ở ip nào, cổng nào, tương tự với mysql cũng vậy.</p>
<p>Tạm thời để server start như thế, chúng ta mở một cửa sổ docker mới và thực hiện kiểm tra các image nó tạo ra, các container dc tạo ra. (bạn cũng có thể stop các container bằng cách Ctr+C 2 lần rồi chạy lại lệnh up nhưng lần này chúng ta option -d để cho container chạy ở chế độ nền: docker-compose up -d).</p>
<p>Cùng thực hiện kiểm tra các images và comtainer nào!<br />
<amp-img src="https://drive.google.com/uc?id=0B05rqFCwNCjkZHkyRHd0dkdreEU&amp;export=download" alt width="1717" height="692" layout="responsive"></amp-img></p>
<p>Chúng ta có 3 images được tạo ra và 2 container đang ở trang thái up.</p>
<p>Kiểm tra ip của mysql nhé: gõ lệnh: docker inspect test-mysql<br />
<amp-img src="https://drive.google.com/uc?id=0B05rqFCwNCjkSzB4SzNMMjRUWFk&amp;export=download" alt width="1365" height="689" layout="responsive"></amp-img></p>
<p>Các bạn kiểm tra kết nối trong file NodeJS_ChatApp\index.js đã đúng chưa nhé, nếu chưa đúng thì sửa lại. Về vấn đề IP của các container khi tạo ra, mình vẫn đang trong quá trình tìm hiểu vì nó cũng khá lằng nhằng, tạm thời thế đã. file index.js</p>
<pre><code>// Tạo kết nối với Database
var pool = mysql.createPool({
host: '172.19.0.2',
user: 'testuser1',
password: '123456',
database: 'test'
});
</code></pre>
<p>Sau khia sửa xong thì bây giờ bạn đã biết app kết nối với mysql qua ip nào rồi. Giả sử bây giờ bạn muốn dùng để connect với mysql phục vụ cho việc thêm/sửa/xóa data v.v thì kết nối như thế nào?</p>
<p><amp-img src="https://drive.google.com/uc?id=0B05rqFCwNCjkbEVQaXJINVFQNjg&amp;export=download" alt width="618" height="696" layout="responsive"></amp-img><br />
Các bạn lưu ý phần IP Address mình bôi màu đỏ, đó là địa chỉ ip của máy ảo CentOS mình đang dùng (máy mà mình dùng để cài docker). Nếu bạn đang chạy docker ở local thì thay chổ đó là localhost hoặc là 127.0.0.1 nhé. Port: 6603, username: testuser1, pass: 123456 cái này mình đã setting ở file docker compose rồi.</p>
<p>Bây giờ thì xem kết quả nào: truy cập địa chỉ: <a href="http://192.168.33.56:32768/">http://192.168.33.56:32768/</a></p>
<ul>
<li>192.168.33.56 là địa chỉ máy ảo chạy docker của mình (máy ảo CentOS). nếu bạn chạy ở local thì thay bằng localhost hoặc là 127.0.0.1 nhé.</li>
<li>32768: là port được mapping với port 3000 trong container test-app(cái này cũng được setting ở file docker compose).</li>
</ul>
<p>Mình đã chuẩn bị sẵn data rồi, nếu bạn muốn thêm thì connect đến mysql như hướng dẫn trên hoặc vào trực tiếp:</p>
<pre><code>docker exec -it test-mysql mysql -u testuser1 -p
</code></pre>
<p>Nhập pass đã được setting: 123456</p>
<p>Chạy lệnh thêm data:</p>
<pre><code>INSERT INTO `member` (`account`, `password`) VALUES
('lan', '123456'),
('phong', '123456'),
('giang', '123456'),
('sang', '123456');
COMMIT;
</code></pre>
<p><amp-img src="https://drive.google.com/uc?id=0B05rqFCwNCjkWjFPX0RHV2lRVk0&amp;export=download" alt width="1004" height="668" layout="responsive"></amp-img></p>
<h4>4. Kết quả </h4>
<p><amp-img src="https://drive.google.com/uc?id=0B05rqFCwNCjkTnNJd2VoQnN6YUU&amp;export=download" alt width="1412" height="678" layout="responsive"></amp-img></p>
<h3>Kết luận</h3>
<ul>
<li>Mình xin phép được dừng bài tìm hiểu tại đây, có lẽ cũng có kha khá kiến thức cơ bản về docker để mình cùng các bạn có thể mày mò tiếp với nó rồi</li>
<li>Cảm ơn các bạn đã dành thời gian đọc bài viết của mình. Thời gian mình tìm hiểu về docker chưa được nhiều nên có thể có nhiều sai sót, rất mong nhận được sự góp ý từ mọi người để sửa đổi nội dung bài viết được tốt hơn.</li>
<li>Nếu các bạn đã từng biết qua về vagrant, ansible rồi thì sẽ tiếp cận nhanh hơn nữa. Dự án hiện tại của mình cũng đang sử dụng vagrant, ansible và mình cảm thấy nó thật tuyệt vời. Đến với docker còn cảm thấy nhiều thứ còn tuyệt vời hơn nữa.</li>
<li>Sắp tới mình cũng sẽ nghiên cứu sâu hơn về docker, và sẽ tiếp tục chia sẻ đến các bạn.</li>
</ul>
<h3>Tài liệu tham khảo</h3>
#### Link Nội bộ
<ol>
<li><a href="https://vietnamlab.vn/blog/2017/03/25/docker-co-gi-hay/" target="_blank">https://vietnamlab.vn/blog/2017/03/25/docker-co-gi-hay/</a></li>
<li><a href="https://vietnamlab.vn/blog/2017/05/31/docker-hoa-de-dang-voi-docker-compose/" target="_blank">https://vietnamlab.vn/blog/2017/05/31/docker-hoa-de-dang-voi-docker-compose/</a></li>
</ol>
<h4 id="linkthamkhobnngoi">Link Tham khảo bên ngoài</h4>
<ol start="3">
<li><a href="https://viblo.asia/p/docker-doi-voi-lap-trinh-vien-web-PDOkqLAKejx" target="_blank">https://viblo.asia/p/docker-doi-voi-lap-trinh-vien-web-PDOkqLAKejx</a></li>
<li><a href="http://blog.appconus.com/2016/04/17/docker-cho-nguoi-moi-bat-dau-p2/#Cac_thanh_phan_co_ban_cua_Docker" target="_blank">http://blog.appconus.com/2016/04/17/docker-cho-nguoi-moi-bat-dau-p2/#Cac_thanh_phan_co_ban_cua_Docker</a></li>
<li><a href="https://viblo.asia/p/tao-moi-truong-develop-nodejs-voi-docker-nwmGyMJgGoW" target="_blank">https://viblo.asia/p/tao-moi-truong-develop-nodejs-voi-docker-nwmGyMJgGoW</a></li>
<li><a href="http://blog.appconus.com/2016/04/15/docker-cho-nguoi-moi-bat-dau-p1/" target="_blank">http://blog.appconus.com/2016/04/15/docker-cho-nguoi-moi-bat-dau-p1/</a></li>
</ol>


            </section>

        </article>
    </main>
    <footer class="page-footer">
        <h3>GMO-Z.com Vietnam Lab Center Technology Blog</h3>
            <p>Blog chia sẻ kỹ thuật của thành viên công ty GMO-Z.com Vietnam Lab Center</p>
        <p><a href="../../index.html">Read more posts →</a></p>
        <a class="powered" href="https://ghost.org" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 156 156"><g fill="none" fill-rule="evenodd"><rect fill="#15212B" width="156" height="156" rx="27"/><g transform="translate(36 36)" fill="#F6F8FA"><path d="M0 71.007A4.004 4.004 0 014 67h26a4 4 0 014 4.007v8.986A4.004 4.004 0 0130 84H4a4 4 0 01-4-4.007v-8.986zM50 71.007A4.004 4.004 0 0154 67h26a4 4 0 014 4.007v8.986A4.004 4.004 0 0180 84H54a4 4 0 01-4-4.007v-8.986z"/><rect y="34" width="84" height="17" rx="4"/><path d="M0 4.007A4.007 4.007 0 014.007 0h41.986A4.003 4.003 0 0150 4.007v8.986A4.007 4.007 0 0145.993 17H4.007A4.003 4.003 0 010 12.993V4.007z"/><rect x="67" width="17" height="17" rx="4"/></g></g></svg> Published with Ghost</a>
    </footer>
    
</body>
</html>
