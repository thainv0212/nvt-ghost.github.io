<!DOCTYPE html>
<html ⚡>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

    <title>[Nhập môn Kubernetes P4] - Kubernetes resource và kubectl command</title>

    <link rel="canonical" href="../index.html" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    
    <meta property="og:site_name" content="GMO-Z.com Vietnam Lab Center Technology Blog" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="[Nhập môn Kubernetes P4] - Kubernetes resource và kubectl command" />
    <meta property="og:description" content="Serial blog Nhập môn Kubernetes  Nội dung Giới thiệu Kubernetes và Resource Kubectl và YAML Manifest Cách sử dụng kubectl Tổng kết Giới thiệu Trong phần 4 này, mình sẽ giới thiệu đến các bạn cơ bản về các thành phần của Kubernetes và kubectl command.  Trên thực tế, K8s" />
    <meta property="og:url" content="https://blog.vietnamlab.vn/nhap-mon-kubernetes-p4-nen-tang-kubernetes/" />
    <meta property="og:image" content="https://drive.google.com/uc?id&#x3D;16p7ipTKh766-UOhAGOJFfkX62PKQJNKh&amp;export&#x3D;download" />
    <meta property="article:published_time" content="2018-11-02T01:11:26.000Z" />
    <meta property="article:modified_time" content="2019-01-23T09:56:31.000Z" />
    <meta property="article:tag" content="kubernetes" />
    <meta property="article:tag" content="docker" />
    <meta property="article:tag" content="kubectl" />
    <meta property="article:tag" content="k8s" />
    <meta property="article:tag" content="kubernetes resource" />
    
    <meta property="article:publisher" content="https://www.facebook.com/vietnamlab.vn" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="[Nhập môn Kubernetes P4] - Kubernetes resource và kubectl command" />
    <meta name="twitter:description" content="Serial blog Nhập môn Kubernetes  Nội dung Giới thiệu Kubernetes và Resource Kubectl và YAML Manifest Cách sử dụng kubectl Tổng kết Giới thiệu Trong phần 4 này, mình sẽ giới thiệu đến các bạn cơ bản về các thành phần của Kubernetes và kubectl command.  Trên thực tế, K8s" />
    <meta name="twitter:url" content="https://blog.vietnamlab.vn/nhap-mon-kubernetes-p4-nen-tang-kubernetes/" />
    <meta name="twitter:image" content="https://drive.google.com/uc?id&#x3D;16p7ipTKh766-UOhAGOJFfkX62PKQJNKh&amp;export&#x3D;download" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="N.X.P" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="kubernetes, docker, kubectl, k8s, kubernetes resource" />
    <meta property="og:image:width" content="1208" />
    <meta property="og:image:height" content="388" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "GMO-Z.com Vietnam Lab Center Technology Blog",
        "url": "https://blog.vietnamlab.vn/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://blog.vietnamlab.vn/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "N.X.P",
        "image": {
            "@type": "ImageObject",
            "url": "https://drive.google.com/uc?id=1ey3d-hkzyw7sUxoxSNSNVlTPDeoVuhCq&export=download",
            "width": 1738,
            "height": 1412
        },
        "url": "https://blog.vietnamlab.vn/author/phongnx/",
        "sameAs": []
    },
    "headline": "[Nhập môn Kubernetes P4] - Kubernetes resource và kubectl command",
    "url": "https://blog.vietnamlab.vn/nhap-mon-kubernetes-p4-nen-tang-kubernetes/",
    "datePublished": "2018-11-02T01:11:26.000Z",
    "dateModified": "2019-01-23T09:56:31.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://drive.google.com/uc?id=16p7ipTKh766-UOhAGOJFfkX62PKQJNKh&export=download",
        "width": 1208,
        "height": 388
    },
    "keywords": "kubernetes, docker, kubectl, k8s, kubernetes resource",
    "description": "Serial blog Nhập môn Kubernetes\n[https://blog.vietnamlab.vn/2018/09/25/nhap-mon-kubernetes-gioi-thieu-rerial-kubernetes/]\n\nNội dung\n * Giới thiệu\n * Kubernetes và Resource\n * Kubectl và YAML Manifest\n * Cách sử dụng kubectl\n * Tổng kết\n\nGiới thiệu\nTrong phần 4 này, mình sẽ giới thiệu đến các bạn cơ bản về các thành phần của\nKubernetes và kubectl command.\nTrên thực tế, K8s được cấu thành từ Kubernetes Master và Kubernetes Node.\nKubernetes Master cung cấp API Endpoint, Đảm nhận vai trò Container S",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://blog.vietnamlab.vn/"
    }
}
    </script>

    <meta name="generator" content="Ghost 3.36" />
    <link rel="alternate" type="application/rss+xml" title="GMO-Z.com Vietnam Lab Center Technology Blog" href="../../rss/index.html" />

    <style amp-custom>
    *,
    *::before,
    *::after {
        box-sizing: border-box;
    }

    html {
        overflow-x: hidden;
        overflow-y: scroll;
        font-size: 62.5%;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    }

    body {
        min-height: 100vh;
        margin: 0;
        padding: 0;
        color: #3a4145;
        font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;
        font-size: 1.7rem;
        line-height: 1.55em;
        font-weight: 400;
        font-style: normal;
        background: #fff;
        scroll-behavior: smooth;
        overflow-x: hidden;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    p,
    ul,
    ol,
    li,
    dl,
    dd,
    hr,
    pre,
    form,
    table,
    video,
    figure,
    figcaption,
    blockquote {
        margin: 0;
        padding: 0;
    }

    ul[class],
    ol[class] {
        padding: 0;
        list-style: none;
    }

    img {
        display: block;
        max-width: 100%;
    }

    input,
    button,
    select,
    textarea {
        font: inherit;
        -webkit-appearance: none;
    }

    fieldset {
        margin: 0;
        padding: 0;
        border: 0;
    }

    label {
        display: block;
        font-size: 0.9em;
        font-weight: 700;
    }

    hr {
        position: relative;
        display: block;
        width: 100%;
        height: 1px;
        border: 0;
        border-top: 1px solid currentcolor;
        opacity: 0.1;
    }

    ::selection {
        text-shadow: none;
        background: #cbeafb;
    }

    mark {
        background-color: #fdffb6;
    }

    small {
        font-size: 80%;
    }

    sub,
    sup {
        position: relative;
        font-size: 75%;
        line-height: 0;
        vertical-align: baseline;
    }
    sup {
        top: -0.5em;
    }
    sub {
        bottom: -0.25em;
    }

    ul li + li {
        margin-top: 0.6em;
    }

    a {
        color: #1292EE;
        text-decoration-skip-ink: auto;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        margin: 0;
        font-weight: 700;
        color: #121212;
        line-height: 1.4em;
    }

    h1 {
        font-size: 3.4rem;
        line-height: 1.1em;
    }

    h2 {
        font-size: 2.4rem;
        line-height: 1.2em;
    }

    h3 {
        font-size: 1.8rem;
    }

    h4 {
        font-size: 1.7rem;
    }

    h5 {
        font-size: 1.6rem;
    }

    h6 {
        font-size: 1.6rem;
    }

    amp-img {
        height: 100%;
        width: 100%;
        max-width: 100%;
        max-height: 100%;
    }

    amp-img img {
        object-fit: cover;
    }

    .page-header {
        padding: 50px 5vmin 30px;
        text-align: center;
        font-size: 2rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .page-header a {
        color: #121212;
        font-weight: 700;
        text-decoration: none;
        font-size: 1.6rem;
        letter-spacing: -0.1px;
    }

    .post {
        max-width: 680px;
        margin: 0 auto;
    }

    .post-header {
        margin: 0 5vmin 5vmin;
        text-align: center;
    }

    .post-meta {
        margin: 1rem 0 0 0;
        text-transform: uppercase;
        color: #738a94;
        font-weight: 500;
        font-size: 1.3rem;
    }

    .post-image {
        margin: 0 0 5vmin;
    }

    .post-image img {
        display: block;
        width: 100%;
        height: auto;
    }

    .post-content {
        padding: 0 5vmin;
    }

    .post-content > * + * {
        margin-top: 1.5em;
    }

    .post-content [id]:not(:first-child) {
        margin: 2em 0 0;
    }

    .post-content > [id] + * {
        margin-top: 1rem;
    }

    .post-content [id] + .kg-card,
    .post-content blockquote + .kg-card {
        margin-top: 40px;
    }

    .post-content > ul,
    .post-content > ol,
    .post-content > dl {
        padding-left: 1.9em;
    }

    .post-content hr {
        margin-top: 40px;
    }

    .post .post-content hr + * {
        margin-top: 40px;
    }

    .post-content amp-img {
        background-color: #f8f8f8;
    }

    .post-content blockquote {
        position: relative;
        font-style: italic;
    }

    .post-content blockquote::before {
        content: "";
        position: absolute;
        left: -1.5em;
        top: 0;
        bottom: 0;
        width: 0.3rem;
        background: #000;
    }

    .post-content :not(.kg-card):not([id]) + .kg-card {
        margin-top: 40px;
    }

    .post-content .kg-card + :not(.kg-card) {
        margin-top: 40px;
    }

    .kg-card figcaption {
        padding: 1.5rem 1.5rem 0;
        text-align: center;
        font-weight: 500;
        font-size: 1.3rem;
        line-height: 1.4em;
        opacity: 0.6;
    }

    .kg-card figcaption strong {
        color: rgba(0,0,0,0.8);
    }

    .post-content :not(pre) code {
        vertical-align: middle;
        padding: 0.15em 0.4em 0.15em;
        border: #e1eaef 1px solid;
        font-weight: 400;
        font-size: 0.9em;
        line-height: 1em;
        color: #dc0050;
        background: #f0f6f9;
        border-radius: 0.25em;
    }

    .post-content > pre {
        overflow: scroll;
        padding: 16px 20px;
        color: #fff;
        background: #1F2428;
        border-radius: 5px;
        box-shadow: 0 2px 6px -2px rgba(0,0,0,.1), 0 0 1px rgba(0,0,0,.4);
    }

    .kg-embed-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
    }

    .kg-image-card img {
        margin: auto;
    }

    .kg-gallery-card + .kg-gallery-card {
        margin-top: 0.75em;
    }

    .kg-gallery-container {
        position: relative;
    }

    .kg-gallery-row {
        display: flex;
        flex-direction: row;
        justify-content: center;
    }

    .kg-gallery-image {
        width: 100%;
        height: 100%;
    }

    .kg-gallery-row:not(:first-of-type) {
        margin: 0.75em 0 0 0;
    }

    .kg-gallery-image:not(:first-of-type) {
        margin: 0 0 0 0.75em;
    }

    .kg-bookmark-card,
    .kg-bookmark-publisher {
        position: relative;
    }

    .kg-bookmark-container,
    .kg-bookmark-container:hover {
        display: flex;
        flex-wrap: wrap;
        flex-direction: row-reverse;
        color: currentColor;
        background: rgba(255,255,255,0.6);
        font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;
        text-decoration: none;
        border-radius: 5px;
        box-shadow: 0 2px 6px -2px rgba(0, 0, 0, 0.1), 0 0 1px rgba(0, 0, 0, 0.4);
        overflow: hidden;
    }

    .kg-bookmark-content {
        flex-basis: 0;
        flex-grow: 999;
        padding: 20px;
        order: 1;
    }

    .kg-bookmark-title {
        font-weight: 600;
        font-size: 1.5rem;
        line-height: 1.3em;
    }

    .kg-bookmark-description {
        display: -webkit-box;
        max-height: 45px;
        margin: 0.5em 0 0 0;
        font-size: 1.4rem;
        line-height: 1.55em;
        overflow: hidden;
        opacity: 0.8;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }

    .kg-bookmark-metadata {
        margin-top: 20px;
    }

    .kg-bookmark-metadata {
        display: flex;
        align-items: center;
        font-weight: 500;
        font-size: 1.3rem;
        line-height: 1.3em;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .kg-bookmark-description {
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
        overflow: hidden;
    }

    .kg-bookmark-metadata amp-img {
        width: 18px;
        height: 18px;
        max-width: 18px;
        max-height: 18px;
        margin-right: 10px;
    }

    .kg-bookmark-thumbnail {
        display: flex;
        flex-basis: 20rem;
        flex-grow: 1;
        justify-content: flex-end;
    }

    .kg-bookmark-thumbnail amp-img {
        max-height: 200px;
    }

    .kg-bookmark-author {
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
    }

    .kg-bookmark-publisher::before {
        content: "•";
        margin: 0 .5em;
    }

    .kg-width-full.kg-card-hascaption {
        display: grid;
        grid-template-columns: inherit;
    }

    .post-content table {
        border-collapse: collapse;
        width: 100%;
    }

    .post-content th {
        padding: 0.5em 0.8em;
        text-align: left;
        font-size: .75em;
        text-transform: uppercase;
    }

    .post-content td {
        padding: 0.4em 0.7em;
    }

    .post-content tbody tr:nth-child(2n + 1) {
        background-color: rgba(0,0,0,0.1);
        padding: 1px;
    }

    .post-content tbody tr:nth-child(2n + 2) td:last-child {
        box-shadow:
            inset 1px 0 rgba(0,0,0,0.1),
            inset -1px 0 rgba(0,0,0,0.1);
    }

    .post-content tbody tr:nth-child(2n + 2) td {
        box-shadow: inset 1px 0 rgba(0,0,0,0.1);
    }

    .post-content tbody tr:last-child {
        border-bottom: 1px solid rgba(0,0,0,.1);
    }

    .page-footer {
        padding: 60px 5vmin;
        margin: 60px auto 0;
        text-align: center;
        background-color: #f8f8f8;
    }

    .page-footer h3 {
        margin: 0.5rem 0 0 0;
    }

    .page-footer p {
        max-width: 500px;
        margin: 1rem auto 1.5rem;
        font-size: 1.7rem;
        line-height: 1.5em;
        color: rgba(0,0,0,0.6)
    }

    .powered {
        display: inline-flex;
        align-items: center;
        margin: 30px 0 0;
        padding: 6px 9px 6px 6px;
        border: rgba(0,0,0,0.1) 1px solid;
        font-size: 12px;
        line-height: 12px;
        letter-spacing: -0.2px;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
        font-weight: 500;
        color: #222;
        text-decoration: none;
        background: #fff;
        border-radius: 6px;
    }

    .powered svg {
        height: 16px;
        width: 16px;
        margin: 0 6px 0 0;
    }

    @media (max-width: 600px) {
        body {
            font-size: 1.6rem;
        }
        h1 {
            font-size: 3rem;
        }

        h2 {
            font-size: 2.2rem;
        }
    }

    @media (max-width: 400px) {
        h1 {
            font-size: 2.6rem;
            line-height: 1.15em;
        }
        h2 {
            font-size: 2rem;
            line-height: 1.2em;
        }
        h3 {
            font-size: 1.7rem;
        }
    }
    </style>

    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>

    

</head>

<body class="amp-template">
    <header class="page-header">
        <a href="../../index.html">
                GMO-Z.com Vietnam Lab Center Technology Blog
        </a>
    </header>

    <main class="content" role="main">
        <article class="post">

            <header class="post-header">
                <h1 class="post-title">[Nhập môn Kubernetes P4] - Kubernetes resource và kubectl command</h1>
                <section class="post-meta">
                    N.X.P -
                    <time class="post-date" datetime="2018-11-02">02 Nov 2018</time>
                </section>
            </header>
            <figure class="post-image">
                <amp-img src="https://drive.google.com/uc?id&#x3D;16p7ipTKh766-UOhAGOJFfkX62PKQJNKh&amp;export&#x3D;download" width="600" height="340" layout="responsive"></amp-img>
            </figure>
            <section class="post-content">

                <p><a href="https://blog.vietnamlab.vn/2018/09/25/nhap-mon-kubernetes-gioi-thieu-rerial-kubernetes/">Serial blog Nhập môn Kubernetes</a></p>
<h3 id="nidung">Nội dung</h3>
<ul>
<li>Giới thiệu</li>
<li>Kubernetes và Resource</li>
<li>Kubectl và YAML Manifest</li>
<li>Cách sử dụng kubectl</li>
<li>Tổng kết</li>
</ul>
<h3 id="giithiu">Giới thiệu</h3>
<p>Trong phần 4 này, mình sẽ giới thiệu đến các bạn cơ bản về các thành phần của Kubernetes và kubectl command.<br />
Trên thực tế, K8s được cấu thành từ Kubernetes Master và Kubernetes Node. Kubernetes Master cung cấp API Endpoint, Đảm nhận vai trò Container Scheduling, Container Scaling vv. Còn Kubernetes Node là host để khởi động những container ứng dụng của chúng ta.<br />
Chúng ta cùng xem lại kiến trúc của K8s một lần nữa nhé.<br />
<amp-img src="https://drive.google.com/uc?id=1jvd3DIDW1lU9glFuBt_sJYexl0cjZJGa&amp;export=download" alt="uc?id=1jvd3DIDW1lU9glFuBt_sJYexl0cjZJGa&amp;export=download" width="600" height="400" layout="responsive"></amp-img></p>
<p><strong>Trong đó cấu trúc của Kubernetes Master gồm:</strong><br />
<amp-img src="https://drive.google.com/uc?id=1hSedoNqLsVcIAIk3jU5YCx567Q4N0imO&amp;export=download" alt="uc?id=1hSedoNqLsVcIAIk3jU5YCx567Q4N0imO&amp;export=download" width="600" height="373" layout="responsive"></amp-img><br />
Chi tiết các thành phần các bạn có thể xem link tham khảo bên dưới hoặc search ở 1 page khác nhé. Mình chỉ nói cái tổng quát trước, không đi vào chi tiết ngay để mọi người khỏi bị loạn. Đại khái thì khi thao tác với kubernetes cluster thông qua CLI tool kubectl thì chúng ta sẽ call đến API của Kubernetes Master, sau đó các thành phần trong Master sẽ scheduling hay scaling container vào các Kubernetes Node.<br />
Tham khảo:<br />
<a href="https://techblog.vn/phan-2-kien-truc-cua-kubernetes">https://techblog.vn/phan-2-kien-truc-cua-kubernetes</a></p>
<p><amp-img src="https://drive.google.com/uc?id=15DAzGhGLRHc99qPthDlI33_pOc_Ubg9C&amp;export=download" alt="uc?id=15DAzGhGLRHc99qPthDlI33_pOc_Ubg9C&amp;export=download" width="730" height="765" layout="responsive"></amp-img><br />
<em>Mối quan hệ giữa Kubernetes Master và Kubernetes Nodes</em></p>
<p>Khi vận hành Kubernetes Cluster, chúng ta đăng ký resource cho Kubernetes Master bằng cách sử dụng công cụ kubectl và một file .yml (manifest) đã chuẩn bị sẵn được viết bằng YAML. Thực tế thì tool kubectl cũng chỉ call đến Kubernetes Master API thông qua mạng nội bộ, nếu chúng ta không sử dụng kubectl thì cũng có thể sử dụng một thư viện khác hoặc là curl command cũng có thể thao tác được.</p>
<h3 id="kubernetesvresource">Kubernetes và Resource</h3>
<p>Nãy giờ mình có nhắc nhiều đến khái niệm resource, thì resource trong kubernetes là gì. Có nhiều loại resource như là: container, load balancer, nodes vv.<br />
Resource của kubernetes có rất nhiều loại nhưng mình tạm phân ra làm 5 nhóm lớn sau:</p>



<table>
  <tr>
    <th>Phân Loại Resource</th>
    <th>Nội dung </th>
  </tr>
  <tr>
    <td>Workloads</td>
    <td>Resource liên quan đến thực thi container</td>
  </tr>
  <tr>
    <td>Discovery＆Load balancer</td>
    <td>Resource cung cấp Endpoint - cho phép truy cập Container từ bên ngoài Cluster</td>
  </tr>
  <tr>
    <td>Config＆Storage</td>
    <td>Resources liên quan đến settings, confidential information, persistent volumes vv</td>
  </tr>
  <tr>
    <td>Cluster</td>
    <td>Resources liên quan đến security và quota</td>
  </tr>
  <tr>
    <td>Metadata</td>
    <td>Resource cho việc quản lý Resource</td>
  </tr>
</table>
<p>Bài viết lần này, để cho mọi người có thể nắm tổng quan nhất, mình sẽ trình bày về 5 loại resource mà user sử dụng (Không bao gồm những resource được sử dụng nội bộ). Từ bài viết sau trở đi, mình sẽ trình bày chi tiết cho mỗi loại resource. Trong 5 loại resource này, Application Developer thường sử dụng đó là 3 loại Workload, Discovery&amp;LB và Config&amp;Storage.</p>
<p>Để có cái nhìn tổng quan về 5 loại resource này, mình thể hiện thông quan hình vẽ sau:<br />
<amp-img src="https://drive.google.com/uc?id=1w4cV8kU99XywRP0S9bED0Cwz6wM7VwOm&amp;export=download" alt="uc?id=1w4cV8kU99XywRP0S9bED0Cwz6wM7VwOm&amp;export=download" width="1669" height="860" layout="responsive"></amp-img></p>
<h3 id="kubectlvyamlmanifest">kubectl và YAML Manifest</h3>
<p>Cách làm thực tế để khởi động 1 container, pod, deployment vv là sử dụng file Manifest. Bây giờ chúng ta hãy thử khởi động container bằng file YAML Maniefst. Mình sẽ tạo 1 pod chứa 1 container là nginx</p>
<pre><code># nginx-pod.yml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-pod
  labels:
    app: nginx-pod
spec:
  containers:
  - name: nginx-pod
    image: nginx:1.12
    imagePullPolicy: "Always"
</code></pre>
<p>Khi tạo resource thì chúng ta sử dụng command kubectl create. Trường hợp resource đã tồn tại, sẽ phát sinh lỗi.</p>
<pre><code># Trường hợp chưa tồn tại resource
$ kubectl create -f nginx-pod.yml
pod "nginx-pod" created
 
# Trường hợp tồn tại resource 
$ kubectl create -f nginx-pod.yml
Error from server (AlreadyExists): error when creating "nginx-pod.yml": pods "nginx-pod" already exists
</code></pre>
<p>Muốn xoá resource thì chúng ta dùng lệnh kubectl delete</p>
<pre><code># Delete pod
$ kubectl delete -f nginx-pod.yml
pod "nginx-pod" deleted
</code></pre>
<p>Khi muốn update resource ta sử dụng lệnh kubectl apply. Mình sẽ sử đổi version của docker image. Sửa lại file với nội dung cập nhật như bên dưới.</p>
<pre><code># Trước update 
image: nginx:1.12

#Sau update
image: nginx:1.13
</code></pre>
<p>Sau khi thực hiện update file YAML Manifest xong, ta thực hiện update bằng command kubectl apply. Nếu như file Manifest không có thay đổi gì, không có gì xảy ra ở đây cả. Trường hợp nếu resource chưa tồn tại thì lệnh kubectl apply và lệnh kubectl create là như nhau. Chính về vậy về cơ bản, chung ta không cần sử dụng lệnh kubectl create, chỉ cần lệnh kubectl apply là OK rồi, rất tiện lợi phải không.</p>
<pre><code># Trường hợp có thay đổi
$ kubectl apply -f nginx-pod.yml
pod "nginx-pod" configured
 
# Trường hợp không có thay đổi
$ kubectl apply -f nginx-pod.yml
pod "nginx-pod" unchanged
 
# Resource không tồn tại
$ kubectl apply -f nginx-pod.yml
pod "nginx-pod" created
</code></pre>
<p>Ngoài ra còn có các command như kubectl set, kubectl replace, kubectl edit vv. Sử dụng các command này cũng có thể thực hiện thay đổi Manifest.</p>
<h3 id="cchsdngkubectl">Cách sử dụng kubectl</h3>
<p>Nãy giờ thì mình cũng đã giới thiệu qua một số các thao tác với resource sử dụng kubectl command, tuy nhiên còn có rất nhiều command để get thông tin nữa. Ví dụ như để thực hiện lấy danh sách resource, chúng ta sử dụng kubectl get. Bằng cách sử dụng option --output (-o) có thể xuất ra với nhiều định dạng khác nhau như: JSON/YAML/custom-columns/Go Template. Trường hợp xuất ra với định dạng JSON hay YAML, chúng ta có thể confirm thông tin một cách chi tiết. Với câu lệnh kubectl get all có thể lấy tất cả thông tin resource.</p>
<h4 id="mtscommandthngdng">Một số command thường dùng</h4>
<pre><code># Get list node
$  kubectl get nodes
NAME          STATUS    ROLES               AGE       VERSION
kube-master   Ready     controlplane,etcd   18d       v1.10.3
kube-node1    Ready     worker              18d       v1.10.3
kube-node2    Ready     worker              18d       v1.10.3

$ kubectl get nodes -o wide
NAME          STATUS    ROLES               AGE       VERSION   EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION               CONTAINER-RUNTIME
kube-master   Ready     controlplane,etcd   18d       v1.10.3   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-862.11.6.el7.x86_64   docker://1.13.1
kube-node1    Ready     worker              18d       v1.10.3   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-862.11.6.el7.x86_64   docker://1.13.1
kube-node2    Ready     worker              18d       v1.10.3   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-862.11.6.el7.x86_64   docker://1.13.1

# Get list pods
$ kubectl get pods
NAME                                   READY     STATUS    RESTARTS   AGE
frontend-deployment-69d88649c7-bf592   2/2       Running   0          17d
frontend-deployment-69d88649c7-kz9xf   2/2       Running   0          17d
frontend-deployment-69d88649c7-ql87x   2/2       Running   0          17d
sample-pod                             1/1       Running   0          17d

# Get detail list pod info
$ kubectl get pods -o wide
NAME                                   READY     STATUS    RESTARTS   AGE       IP           NODE
frontend-deployment-69d88649c7-bf592   2/2       Running   0          17d       10.42.1.9    kube-node1
frontend-deployment-69d88649c7-kz9xf   2/2       Running   0          17d       10.42.2.10   kube-node2
frontend-deployment-69d88649c7-ql87x   2/2       Running   0          17d       10.42.2.11   kube-node2
sample-pod                             1/1       Running   0          17d       10.42.1.8    kube-node1

# Get service 
$ kubectl get svc
NAME               TYPE           CLUSTER-IP      EXTERNAL-IP      PORT(S)        AGE
frontend-service   NodePort       10.43.134.81    &lt;none&gt;           80:32253/TCP   18d
kubernetes         ClusterIP      10.43.0.1       &lt;none&gt;           443/TCP        18d
nginx-php-fpm      LoadBalancer   10.43.232.121   150.95.176.186   80:30312/TCP   18d

# Exec pod and specific container
$ kubectl exec -it [pod_name] -c nginx /bin/bash


</code></pre>
<p>Giới thiệu tiếp đến các bạn một câu lệnh rất hữu ích, đó là kubectl describe. Là command để lấy thông tin chi tiết của một resource nào đó, chẳng hạn như Pods. Ngoài một số thông tin thường thấy như post, image, container, status vv. Thì thông tin để mình có thể debug mỗi khi container không được start hay ở trạng thái lỗi. Thông tin cần quan tâm nhất khi chạy command này đó là Item "Event", nó thể hiện việc setup volume, việc pull image như thế nào và cả container life cycle.</p>
<pre><code>$ kubectl describe pods nginx-pod
Name:         nginx-pod
Namespace:    default
Node:         minikube/10.0.2.15
Start Time:   Wed, 15 Aug 2018 22:06:08 +0700
Labels:       app=nginx-pod
Annotations:  kubectl.kubernetes.io/last-applied-configuration={"apiVersion":"v1","kind":"Pod","metadata":{"annotations":{},"labels":{"app":"nginx-pod"},"name":"nginx-pod","namespace":"default"},"spec":{"containers...
Status:       Running
IP:           172.17.0.4
Containers:
  nginx-pod:
    Container ID:   docker://db2e78e82e835103d95a5538bcdc8fc7f733dd9c89e9e32944ed30efd28d2f1b
    Image:          nginx:1.12
    Image ID:       docker-pullable://nginx@sha256:72daaf46f11cc753c4eab981cbf869919bd1fee3d2170a2adeac12400f494728
    Port:           &lt;none&gt;
    Host Port:      &lt;none&gt;
    State:          Running
      Started:      Wed, 15 Aug 2018 22:06:43 +0700
    Ready:          True
    Restart Count:  0
    Environment:    &lt;none&gt;
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-c4qhx (ro)
Conditions:
  Type           Status
  Initialized    True 
  Ready          True 
  PodScheduled   True 
Volumes:
  default-token-c4qhx:
    Type:        Secret (a volume populated by a Secret)
    SecretName:  default-token-c4qhx
    Optional:    false
QoS Class:       BestEffort
Node-Selectors:  &lt;none&gt;
Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s
                 node.kubernetes.io/unreachable:NoExecute for 300s
Events:
  Type    Reason                 Age   From               Message
  ----    ------                 ----  ----               -------
  Normal  Scheduled              50m   default-scheduler  Successfully assigned nginx-pod to minikube
  Normal  SuccessfulMountVolume  50m   kubelet, minikube  MountVolume.SetUp succeeded for volume "default-token-c4qhx"
  Normal  Pulling                50m   kubelet, minikube  pulling image "nginx:1.12"
  Normal  Pulled                 50m   kubelet, minikube  Successfully pulled image "nginx:1.12"
  Normal  Created                50m   kubelet, minikube  Created container
  Normal  Started                50m   kubelet, minikube  Started container
</code></pre>
<p>Không chỉ lấy thông tin chi tiết của Pod, với Nodes cũng tương tự.</p>
<pre><code>$ kubectl describe nodes minikube
Name:               minikube
Roles:              master
Labels:             beta.kubernetes.io/arch=amd64
                    beta.kubernetes.io/os=linux
                    kubernetes.io/hostname=minikube
                    node-role.kubernetes.io/master=
Annotations:        node.alpha.kubernetes.io/ttl=0
                    volumes.kubernetes.io/controller-managed-attach-detach=true
CreationTimestamp:  Wed, 15 Aug 2018 22:03:04 +0700
Taints:             &lt;none&gt;
Unschedulable:      false
Conditions:
  Type             Status  LastHeartbeatTime                 LastTransitionTime                Reason                       Message
  ----             ------  -----------------                 ------------------                ------                       -------
  OutOfDisk        False   Wed, 15 Aug 2018 23:08:49 +0700   Wed, 15 Aug 2018 22:03:00 +0700   KubeletHasSufficientDisk     kubelet has sufficient disk space available
  MemoryPressure   False   Wed, 15 Aug 2018 23:08:49 +0700   Wed, 15 Aug 2018 22:03:00 +0700   KubeletHasSufficientMemory   kubelet has sufficient memory available
  DiskPressure     False   Wed, 15 Aug 2018 23:08:49 +0700   Wed, 15 Aug 2018 22:03:00 +0700   KubeletHasNoDiskPressure     kubelet has no disk pressure
  PIDPressure      False   Wed, 15 Aug 2018 23:08:49 +0700   Wed, 15 Aug 2018 22:03:00 +0700   KubeletHasSufficientPID      kubelet has sufficient PID available
  Ready            True    Wed, 15 Aug 2018 23:08:49 +0700   Wed, 15 Aug 2018 22:03:00 +0700   KubeletReady                 kubelet is posting ready status
Addresses:
  InternalIP:  10.0.2.15
  Hostname:    minikube
Capacity:
 cpu:                2
 ephemeral-storage:  16888216Ki
 hugepages-2Mi:      0
 memory:             2038624Ki
 pods:               110
Allocatable:
 cpu:                2
 ephemeral-storage:  15564179840
 hugepages-2Mi:      0
 memory:             1936224Ki
 pods:               110
System Info:
 Machine ID:                 bec9c88ab8ce41049005c3426ba5a62d
 System UUID:                3CA1DD33-875A-4CBB-BDD3-CA31B5EC0CB5
 Boot ID:                    1914b073-d566-4c12-bf0d-6731688ab339
 Kernel Version:             4.15.0
 OS Image:                   Buildroot 2018.05
 Operating System:           linux
 Architecture:               amd64
 Container Runtime Version:  docker://17.12.1-ce
 Kubelet Version:            v1.10.0
 Kube-Proxy Version:         v1.10.0
ExternalID:                  minikube
Non-terminated Pods:         (10 in total)
  Namespace                  Name                                     CPU Requests  CPU Limits  Memory Requests  Memory Limits
  ---------                  ----                                     ------------  ----------  ---------------  -------------
  default                    nginx-pod                                0 (0%)        0 (0%)      0 (0%)           0 (0%)
  kube-system                etcd-minikube                            0 (0%)        0 (0%)      0 (0%)           0 (0%)
  kube-system                kube-addon-manager-minikube              5m (0%)       0 (0%)      50Mi (2%)        0 (0%)
  kube-system                kube-apiserver-minikube                  250m (12%)    0 (0%)      0 (0%)           0 (0%)
  kube-system                kube-controller-manager-minikube         200m (10%)    0 (0%)      0 (0%)           0 (0%)
  kube-system                kube-dns-86f4d74b45-764qh                260m (13%)    0 (0%)      110Mi (5%)       170Mi (8%)
  kube-system                kube-proxy-zxjnp                         0 (0%)        0 (0%)      0 (0%)           0 (0%)
  kube-system                kube-scheduler-minikube                  100m (5%)     0 (0%)      0 (0%)           0 (0%)
  kube-system                kubernetes-dashboard-5498ccf677-xpq6t    0 (0%)        0 (0%)      0 (0%)           0 (0%)
  kube-system                storage-provisioner                      0 (0%)        0 (0%)      0 (0%)           0 (0%)
Allocated resources:
  (Total limits may be over 100 percent, i.e., overcommitted.)
  CPU Requests  CPU Limits  Memory Requests  Memory Limits
  ------------  ----------  ---------------  -------------
  815m (40%)    0 (0%)      160Mi (8%)       170Mi (8%)
Events:         &lt;none&gt;
</code></pre>
<p>Trong trường hợp muốn kiểm tra log của Pod được xuất ra như thế nào, sử dụng kubectl log.</p>
<pre><code># Xuất log của container bên trong Pod
$ kubectl logs nginx-pod
 
# Có thể chỉ định cụ thể log của container nào trong pod có nhiều container
$ kubectl logs nginx-pod -c nginx-container
 
# Lệnh này thì giống kiểu tail -f (follow log)
$ kubectl logs -f nginx-pod
 
# Xuất log Trong 1 giờ trước、lấy 10 record, hiển thị timestamps
$ kubectl logs --since=1h --tail=10 --timestamps=true nginx-pod
</code></pre>
<p>Trường hợp muốn thực thi một container nào cụ thể trong Pod, sử dụng command kubectl exec. /bin/sh là lệnh mà khi container được start sẽ chạy lệnh này, khi chạy xong ta muốn giữ nó ở trạng thái đã truy cập vào container đó thì gõ thêm option -it.</p>
<pre><code># Thực thi lệnh /bin/sh một container bên trong Pod
$ kubectl exec -it nginx-pod /bin/sh
 
# Trường hợp có nhiều container trong 1 Pod, thực thi lệnh /bin/sh đối với container được chỉ định.
$ kubectl exec -it nginx-pod -c nginx-container /bin/sh
 
# Trường hợp muốn thực thi container có parameter thêm param sau dấu 「--」
$ kubectl exec -it nginx-pod -- /bin/ls -l /
</code></pre>
<p>Có một trường hợp mà mình nghĩ nó rất hữu ích. Chẳng hạn như mình muốn debug một ứng dụng web chạy trong container từ máy local, hoặc là muốn kết nối mysql container từ một Database client. Trong trường hợp như vậy chúng ta sử dụng kubectl port-forward.<br />
Bây giờ mình sẽ demo command này ở ở browser máy local của mình, truy cập đến nginx container trong nginx-pod. Khi thực thi lệnh bên dưới và gõ lên browser localhost:8888 thì nó sẽ kết nối đến container nginx port 80.</p>
<pre><code>$ kubectl port-forward nginx-pod 8888:80
Forwarding from 127.0.0.1:8888 -&gt; 80
Forwarding from [::1]:8888 -&gt; 80
</code></pre>
<p><amp-img src="https://drive.google.com/uc?id=1lC-f15_aLynrDtLthUfLMkN3pCOISQGq&amp;export=download" alt="uc?id=1lC-f15_aLynrDtLthUfLMkN3pCOISQGq&amp;export=download" width="2126" height="556" layout="responsive"></amp-img></p>
<p>Khi làm việc với kubectl, sẽ rất hữu ích nếu chúng ta có thể sử dụng tốt các kubectl command một cách thuần thục. Khi đó việc debug các resource của chúng ta dễ dàng hơn. kubectl còn có nhiều command hữu ích khác, các bạn hãy gõ lệnh kubectl get --help, nó sẽ gợi ý cho mình nhiều command hữu ích và ví dụ cụ thể, các bạn cứ thử thoải mái nhé. Ngoài ra các bạn có thể tham khảo thêm link bên dưới:<br />
<a href="https://resources.coreos.com/webinars/kubectl-tips-and-tricks">Kubectl Tips and Tricks</a><br />
<a href="https://www.youtube.com/watch?v=BadzJOlSn24">Tips and Tricks of Using Kubectl, the Kubernetes CLI</a></p>
<h3 id="tngkt">Tổng kết</h3>
<p>Bài viết này mình đã trình bày cho mọi người liên quan đến các thành phần, resource của kubernetes và một số command thường dùng với kubectl. Bài viết cũng khá dài rồi nên mình xin tạm kết thúc ở đây. Các bài viết sau mình sẽ trình bày chi tiết từng resource.</p>


            </section>

        </article>
    </main>
    <footer class="page-footer">
        <h3>GMO-Z.com Vietnam Lab Center Technology Blog</h3>
            <p>Blog chia sẻ kỹ thuật của thành viên công ty GMO-Z.com Vietnam Lab Center</p>
        <p><a href="../../index.html">Read more posts →</a></p>
        <a class="powered" href="https://ghost.org" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 156 156"><g fill="none" fill-rule="evenodd"><rect fill="#15212B" width="156" height="156" rx="27"/><g transform="translate(36 36)" fill="#F6F8FA"><path d="M0 71.007A4.004 4.004 0 014 67h26a4 4 0 014 4.007v8.986A4.004 4.004 0 0130 84H4a4 4 0 01-4-4.007v-8.986zM50 71.007A4.004 4.004 0 0154 67h26a4 4 0 014 4.007v8.986A4.004 4.004 0 0180 84H54a4 4 0 01-4-4.007v-8.986z"/><rect y="34" width="84" height="17" rx="4"/><path d="M0 4.007A4.007 4.007 0 014.007 0h41.986A4.003 4.003 0 0150 4.007v8.986A4.007 4.007 0 0145.993 17H4.007A4.003 4.003 0 010 12.993V4.007z"/><rect x="67" width="17" height="17" rx="4"/></g></g></svg> Published with Ghost</a>
    </footer>
    
</body>
</html>
