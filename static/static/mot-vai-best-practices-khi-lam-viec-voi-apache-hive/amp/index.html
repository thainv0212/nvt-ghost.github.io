
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

    <title>Một vài best practices khi làm việc với Apache Hive</title>

    <meta name="description" content="Thời gian gần đây, mình phải làm việc với Apache Hive thường xuyên. Việc làm sao để thời gian thực hiện các câu query trên Hive ngắn hơn trở nên rất cần thi">
    <link rel="canonical" href="../index.html">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <meta property="og:site_name" content="GMO-Z.com Vietnam Lab Center Technology Blog">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Một vài best practices khi làm việc với Apache Hive">
    <meta property="og:description" content="Thời gian gần đây, mình phải làm việc với Apache Hive thường xuyên. Việc làm sao để thời gian thực hiện các câu query trên Hive ngắn hơn trở nên rất cần thi">
    <meta property="og:url" content="https://blog.vietnamlab.vn/mot-vai-best-practices-khi-lam-viec-voi-apache-hive/">
    <meta property="og:image" content="https://drive.google.com/uc?id=0B05rqFCwNCjkaWllb1FJRk1BSXc&amp;export=download">
    <meta property="article:published_time" content="2017-10-24T01:11:00.000Z">
    <meta property="article:modified_time" content="2017-10-24T01:34:31.000Z">
    <meta property="article:tag" content="Apache Hive">
    <meta property="article:tag" content="hive">
    <meta property="article:tag" content="Performance Tuning">
    
    <meta property="article:publisher" content="https://www.facebook.com/vietnamlab.vn">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Một vài best practices khi làm việc với Apache Hive">
    <meta name="twitter:description" content="Thời gian gần đây, mình phải làm việc với Apache Hive thường xuyên. Việc làm sao để thời gian thực hiện các câu query trên Hive ngắn hơn trở nên rất cần thi">
    <meta name="twitter:url" content="https://blog.vietnamlab.vn/mot-vai-best-practices-khi-lam-viec-voi-apache-hive/">
    <meta name="twitter:image" content="https://drive.google.com/uc?id=0B05rqFCwNCjkaWllb1FJRk1BSXc&amp;export=download">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="N.C.M">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="Apache Hive, hive, Performance Tuning">
    <meta property="og:image:width" content="853">
    <meta property="og:image:height" content="418">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "GMO-Z.com Vietnam Lab Center Technology Blog",
        "url": "https://blog.vietnamlab.vn/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://blog.vietnamlab.vn/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "N.C.M",
        "image": {
            "@type": "ImageObject",
            "url": "https://vignette2.wikia.nocookie.net/onepiece/images/2/23/Zoro_After_Taking_Luffy%27s_Pain.png/revision/latest?cb=20140518230609",
            "width": 672,
            "height": 1390
        },
        "url": "https://blog.vietnamlab.vn/author/minhnc/",
        "sameAs": [
            "https://vietnamlab.vn"
        ]
    },
    "headline": "Một vài best practices khi làm việc với Apache Hive",
    "url": "https://blog.vietnamlab.vn/mot-vai-best-practices-khi-lam-viec-voi-apache-hive/",
    "datePublished": "2017-10-24T01:11:00.000Z",
    "dateModified": "2017-10-24T01:34:31.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://drive.google.com/uc?id=0B05rqFCwNCjkaWllb1FJRk1BSXc&export=download",
        "width": 853,
        "height": 418
    },
    "keywords": "Apache Hive, hive, Performance Tuning",
    "description": "Thời gian gần đây, mình phải làm việc với Apache Hive thường xuyên. Việc làm sao\nđể thời gian thực hiện các câu query trên Hive ngắn hơn trở nên rất cần thiết.\nDưới đây là tổng hợp một số cách cơ bản để cải thiện performance cho Hive\nqueries.\n\n1. Sử dụng Apache Tez execution engine\nThiết lập mặc định là Hive sẽ sử dụng Map-reduce engine để thực thi các câu\nquery. Thay vào đó, ta có thể sử dụng Tez engine - tốc độ xử lý sẽ nhanh hơn rất\nnhiều khi ta dùng Map-reduce.\n\nNếu Tez chưa được setting thà",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://blog.vietnamlab.vn/"
    }
}
    </script>

    <meta name="generator" content="Ghost 3.36">
    <link rel="alternate" type="application/rss+xml" title="GMO-Z.com Vietnam Lab Center Technology Blog" href="../../rss/index.html">

    <style amp-custom>
    *,
    *::before,
    *::after {
        box-sizing: border-box;
    }

    html {
        overflow-x: hidden;
        overflow-y: scroll;
        font-size: 62.5%;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    }

    body {
        min-height: 100vh;
        margin: 0;
        padding: 0;
        color: #3a4145;
        font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;
        font-size: 1.7rem;
        line-height: 1.55em;
        font-weight: 400;
        font-style: normal;
        background: #fff;
        scroll-behavior: smooth;
        overflow-x: hidden;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    p,
    ul,
    ol,
    li,
    dl,
    dd,
    hr,
    pre,
    form,
    table,
    video,
    figure,
    figcaption,
    blockquote {
        margin: 0;
        padding: 0;
    }

    ul[class],
    ol[class] {
        padding: 0;
        list-style: none;
    }

    img {
        display: block;
        max-width: 100%;
    }

    input,
    button,
    select,
    textarea {
        font: inherit;
        -webkit-appearance: none;
    }

    fieldset {
        margin: 0;
        padding: 0;
        border: 0;
    }

    label {
        display: block;
        font-size: 0.9em;
        font-weight: 700;
    }

    hr {
        position: relative;
        display: block;
        width: 100%;
        height: 1px;
        border: 0;
        border-top: 1px solid currentcolor;
        opacity: 0.1;
    }

    ::selection {
        text-shadow: none;
        background: #cbeafb;
    }

    mark {
        background-color: #fdffb6;
    }

    small {
        font-size: 80%;
    }

    sub,
    sup {
        position: relative;
        font-size: 75%;
        line-height: 0;
        vertical-align: baseline;
    }
    sup {
        top: -0.5em;
    }
    sub {
        bottom: -0.25em;
    }

    ul li + li {
        margin-top: 0.6em;
    }

    a {
        color: #1292EE;
        text-decoration-skip-ink: auto;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        margin: 0;
        font-weight: 700;
        color: #121212;
        line-height: 1.4em;
    }

    h1 {
        font-size: 3.4rem;
        line-height: 1.1em;
    }

    h2 {
        font-size: 2.4rem;
        line-height: 1.2em;
    }

    h3 {
        font-size: 1.8rem;
    }

    h4 {
        font-size: 1.7rem;
    }

    h5 {
        font-size: 1.6rem;
    }

    h6 {
        font-size: 1.6rem;
    }

    amp-img {
        height: 100%;
        width: 100%;
        max-width: 100%;
        max-height: 100%;
    }

    amp-img img {
        object-fit: cover;
    }

    .page-header {
        padding: 50px 5vmin 30px;
        text-align: center;
        font-size: 2rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .page-header a {
        color: #121212;
        font-weight: 700;
        text-decoration: none;
        font-size: 1.6rem;
        letter-spacing: -0.1px;
    }

    .post {
        max-width: 680px;
        margin: 0 auto;
    }

    .post-header {
        margin: 0 5vmin 5vmin;
        text-align: center;
    }

    .post-meta {
        margin: 1rem 0 0 0;
        text-transform: uppercase;
        color: #738a94;
        font-weight: 500;
        font-size: 1.3rem;
    }

    .post-image {
        margin: 0 0 5vmin;
    }

    .post-image img {
        display: block;
        width: 100%;
        height: auto;
    }

    .post-content {
        padding: 0 5vmin;
    }

    .post-content > * + * {
        margin-top: 1.5em;
    }

    .post-content [id]:not(:first-child) {
        margin: 2em 0 0;
    }

    .post-content > [id] + * {
        margin-top: 1rem;
    }

    .post-content [id] + .kg-card,
    .post-content blockquote + .kg-card {
        margin-top: 40px;
    }

    .post-content > ul,
    .post-content > ol,
    .post-content > dl {
        padding-left: 1.9em;
    }

    .post-content hr {
        margin-top: 40px;
    }

    .post .post-content hr + * {
        margin-top: 40px;
    }

    .post-content amp-img {
        background-color: #f8f8f8;
    }

    .post-content blockquote {
        position: relative;
        font-style: italic;
    }

    .post-content blockquote::before {
        content: "";
        position: absolute;
        left: -1.5em;
        top: 0;
        bottom: 0;
        width: 0.3rem;
        background: #000;
    }

    .post-content :not(.kg-card):not([id]) + .kg-card {
        margin-top: 40px;
    }

    .post-content .kg-card + :not(.kg-card) {
        margin-top: 40px;
    }

    .kg-card figcaption {
        padding: 1.5rem 1.5rem 0;
        text-align: center;
        font-weight: 500;
        font-size: 1.3rem;
        line-height: 1.4em;
        opacity: 0.6;
    }

    .kg-card figcaption strong {
        color: rgba(0,0,0,0.8);
    }

    .post-content :not(pre) code {
        vertical-align: middle;
        padding: 0.15em 0.4em 0.15em;
        border: #e1eaef 1px solid;
        font-weight: 400;
        font-size: 0.9em;
        line-height: 1em;
        color: #dc0050;
        background: #f0f6f9;
        border-radius: 0.25em;
    }

    .post-content > pre {
        overflow: scroll;
        padding: 16px 20px;
        color: #fff;
        background: #1F2428;
        border-radius: 5px;
        box-shadow: 0 2px 6px -2px rgba(0,0,0,.1), 0 0 1px rgba(0,0,0,.4);
    }

    .kg-embed-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
    }

    .kg-image-card img {
        margin: auto;
    }

    .kg-gallery-card + .kg-gallery-card {
        margin-top: 0.75em;
    }

    .kg-gallery-container {
        position: relative;
    }

    .kg-gallery-row {
        display: flex;
        flex-direction: row;
        justify-content: center;
    }

    .kg-gallery-image {
        width: 100%;
        height: 100%;
    }

    .kg-gallery-row:not(:first-of-type) {
        margin: 0.75em 0 0 0;
    }

    .kg-gallery-image:not(:first-of-type) {
        margin: 0 0 0 0.75em;
    }

    .kg-bookmark-card,
    .kg-bookmark-publisher {
        position: relative;
    }

    .kg-bookmark-container,
    .kg-bookmark-container:hover {
        display: flex;
        flex-wrap: wrap;
        flex-direction: row-reverse;
        color: currentColor;
        background: rgba(255,255,255,0.6);
        font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;
        text-decoration: none;
        border-radius: 5px;
        box-shadow: 0 2px 6px -2px rgba(0, 0, 0, 0.1), 0 0 1px rgba(0, 0, 0, 0.4);
        overflow: hidden;
    }

    .kg-bookmark-content {
        flex-basis: 0;
        flex-grow: 999;
        padding: 20px;
        order: 1;
    }

    .kg-bookmark-title {
        font-weight: 600;
        font-size: 1.5rem;
        line-height: 1.3em;
    }

    .kg-bookmark-description {
        display: -webkit-box;
        max-height: 45px;
        margin: 0.5em 0 0 0;
        font-size: 1.4rem;
        line-height: 1.55em;
        overflow: hidden;
        opacity: 0.8;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }

    .kg-bookmark-metadata {
        margin-top: 20px;
    }

    .kg-bookmark-metadata {
        display: flex;
        align-items: center;
        font-weight: 500;
        font-size: 1.3rem;
        line-height: 1.3em;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .kg-bookmark-description {
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
        overflow: hidden;
    }

    .kg-bookmark-metadata amp-img {
        width: 18px;
        height: 18px;
        max-width: 18px;
        max-height: 18px;
        margin-right: 10px;
    }

    .kg-bookmark-thumbnail {
        display: flex;
        flex-basis: 20rem;
        flex-grow: 1;
        justify-content: flex-end;
    }

    .kg-bookmark-thumbnail amp-img {
        max-height: 200px;
    }

    .kg-bookmark-author {
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
    }

    .kg-bookmark-publisher::before {
        content: "•";
        margin: 0 .5em;
    }

    .kg-width-full.kg-card-hascaption {
        display: grid;
        grid-template-columns: inherit;
    }

    .post-content table {
        border-collapse: collapse;
        width: 100%;
    }

    .post-content th {
        padding: 0.5em 0.8em;
        text-align: left;
        font-size: .75em;
        text-transform: uppercase;
    }

    .post-content td {
        padding: 0.4em 0.7em;
    }

    .post-content tbody tr:nth-child(2n + 1) {
        background-color: rgba(0,0,0,0.1);
        padding: 1px;
    }

    .post-content tbody tr:nth-child(2n + 2) td:last-child {
        box-shadow:
            inset 1px 0 rgba(0,0,0,0.1),
            inset -1px 0 rgba(0,0,0,0.1);
    }

    .post-content tbody tr:nth-child(2n + 2) td {
        box-shadow: inset 1px 0 rgba(0,0,0,0.1);
    }

    .post-content tbody tr:last-child {
        border-bottom: 1px solid rgba(0,0,0,.1);
    }

    .page-footer {
        padding: 60px 5vmin;
        margin: 60px auto 0;
        text-align: center;
        background-color: #f8f8f8;
    }

    .page-footer h3 {
        margin: 0.5rem 0 0 0;
    }

    .page-footer p {
        max-width: 500px;
        margin: 1rem auto 1.5rem;
        font-size: 1.7rem;
        line-height: 1.5em;
        color: rgba(0,0,0,0.6)
    }

    .powered {
        display: inline-flex;
        align-items: center;
        margin: 30px 0 0;
        padding: 6px 9px 6px 6px;
        border: rgba(0,0,0,0.1) 1px solid;
        font-size: 12px;
        line-height: 12px;
        letter-spacing: -0.2px;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
        font-weight: 500;
        color: #222;
        text-decoration: none;
        background: #fff;
        border-radius: 6px;
    }

    .powered svg {
        height: 16px;
        width: 16px;
        margin: 0 6px 0 0;
    }

    @media (max-width: 600px) {
        body {
            font-size: 1.6rem;
        }
        h1 {
            font-size: 3rem;
        }

        h2 {
            font-size: 2.2rem;
        }
    }

    @media (max-width: 400px) {
        h1 {
            font-size: 2.6rem;
            line-height: 1.15em;
        }
        h2 {
            font-size: 2rem;
            line-height: 1.2em;
        }
        h3 {
            font-size: 1.7rem;
        }
    }
    </style>

    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>

    

</head>

<body class="amp-template">
    <header class="page-header">
        <a href="../../">
                GMO-Z.com Vietnam Lab Center Technology Blog
        </a>
    </header>

    <main class="content" role="main">
        <article class="post">

            <header class="post-header">
                <h1 class="post-title">Một vài best practices khi làm việc với Apache Hive</h1>
                <section class="post-meta">
                    N.C.M -
                    <time class="post-date" datetime="2017-10-24">24 Oct 2017</time>
                </section>
            </header>
            <figure class="post-image">
                <amp-img src="https://drive.google.com/uc?id=0B05rqFCwNCjkaWllb1FJRk1BSXc&amp;export=download" width="600" height="340" layout="responsive"></amp-img>
            </figure>
            <section class="post-content">

                <p>Thời gian gần đây, mình phải làm việc với Apache Hive thường xuyên. Việc làm sao để thời gian thực hiện các câu query trên Hive ngắn hơn trở nên rất cần thiết. Dưới đây là tổng hợp một số cách cơ bản để cải thiện performance cho Hive queries.</p>
<h3 id="1sdngapachetezexecutionengine">1. Sử dụng Apache Tez execution engine</h3>
<p>Thiết lập mặc định là Hive sẽ sử dụng Map-reduce engine để thực thi các câu query. Thay vào đó, ta có thể sử dụng Tez engine - tốc độ xử lý sẽ nhanh hơn rất nhiều khi ta dùng Map-reduce.</p>
<p>Nếu Tez chưa được setting thành query engine mặc định trên môi trường Hadoop thì ta có thể dùng Tez bằng cách chạy thiết lập sau khi bắt đầu Hive query</p>
<pre><code>set hive.execution.engine=tez;
</code></pre>
<p>Và khi đó mọi câu Hive query sẽ được thực thi bằng Tez execution engine.</p>
<p>Ngoài ra, ta cũng có thể thiết lập Tez enginze thành execution engine mặc định cho Hive qua Ambari</p>
<p><amp-img src="https://drive.google.com/uc?id=0B05rqFCwNCjkUjFOdl9EanU0eHc&amp;export=download" alt width="628" height="568" layout="responsive"></amp-img></p>
<p>Chi tiết về Tez có thể tham khảo tại: <a href="https://tez.apache.org/">Tez Homepage</a></p>
<h3 id="2dngorcfile">2. Dùng ORCFile</h3>
<p>Lời khuyên từ Hotonwork là <strong>Store all data in ORCFile format</strong>.</p>
<p>Sau đây là 1 số điểm mạnh của ORCFile</p>
<ul>
<li>Nén dữ liệu hiệu quả</li>
</ul>
<p><amp-img src="https://drive.google.com/uc?id=0B05rqFCwNCjkSEZ5M0VMa29vaHc&amp;export=download" alt width="1323" height="533" layout="responsive"></amp-img></p>
<ul>
<li>
<p>Tốc độ đọc nhanh: Với built-in index, min/max values, predicate pushdown, Bloom filters, ... giúp cho tốc độ đọc dữ liệu định dạng ORCFile nhanh</p>
</li>
<li>
<p>Đã được khẳng định trong các hệ thống lớn. Ví dụ: Facebook dùng ORC file format cho hệ thống 300+ PB dữ liệu</p>
</li>
</ul>
<p>Để dùng ORCFile ta chỉ cần thêm <code>STORED AS orc</code> vào cuối create table statements như sau</p>
<pre><code>CREATE TABLE mytable (
...
) STORED AS orc;
</code></pre>
<p>Ta cũng có thể đơn giản chuyển data cũ sang dạng ORCFile bằng cách tạo 1 table copy như sau, rồi xóa table cũ đi.</p>
<pre><code>CREATE TABLE a_orc STORED AS ORC AS SELECT * FROM A; 
</code></pre>
<p>Bình thường ta có thể sử dụng setting mặc định cho ORCFile. Tuy nhiên một số trường hợp cần thay đổi, ta có thểm tham khảo bảng sau:</p>

<table class="demo">
	<caption>Table 1. ORC Properties</caption>
	<thead>
	<tr>
		<th>Key<br></th>
		<th>Default Setting<br></th>
		<th>Notes<br></th>
	</tr>
	</thead>
	<tbody>
	<tr>
		<td><span>orc.compress</span> </td>
		<td>ZLIB</td>
		<td>Các kiểu nén (NONE, ZLIB, SNAPPY).</td>
	</tr>
	<tr>
		<td>orc.compress.size</td>
		<td>262,144<br></td>
		<td>Số bytes trên mỗi block nén<br></td>
	</tr>
	<tr>
		<td>orc.stripe.size</td>
		<td>268,435,456<br></td>
		<td>Số bytes trên mỗi stripe.<br></td>
	</tr>
	<tr>
		<td>orc.row.index.stride<br></td>
		<td>10,000<br></td>
		<td>Số rows giữa các index entries (&gt;= 1,000).<br></td>
	</tr>
	<tr>
		<td>orc.create.index<br></td>
		<td>true<br></td>
		<td>Có dùng index hay không<br></td>
	</tr>
	<tr>
		<td>orc.bloom.filter.columns<br></td>
		<td>--</td>
		<td>Danh sách các tên cột được ngăn cách bởi dấy phẩy "," dùng cho Bloom filter<br></td>
	</tr>
	<tr>
		<td>orc.bloom.filter.fpp<br></td>
		<td>0.05<br></td>
		<td>Tỷ lệ sai cho phép của Bloom filter. Lớn hơn 0.0 và bé hơn 1.0.<br></td>
	</tr>
	</tbody><tbody>
</tbody></table>
<h3 id="3dngvectorization">3. Dùng Vectorization</h3>
<p>Vector hóa query execution giúp cải thiện hiệu năng của các phép toán như scans, aggregations, filters and joins bằng cách thực hiện chúng dưới dạng batch cho 1024 rows 1 lúc thay vì 1 rows</p>
<p>Ta có thể sử dụng dễ dàng bằng 2 setting sau</p>
<pre><code>set hive.vectorized.execution.enabled = true;
set hive.vectorized.execution.reduce.enabled = true;
</code></pre>
<h3 id="4cbocostbasedoptimization">4. CBO - Cost-based optimization</h3>
<p>Hive sẽ tối ưu kế hoạch thực thi câu query (cả về logical và physical) trước khi submit để thực thi nó.</p>
<p>Và Hive CBO giúp Hive tối ưu câu query dựa trên cost của câu query đó. Từ đó đưa ra các quyết định như thứ tự join như thế nào, kiểu join nào là tối ưu, mức độ thực thi song song, ...</p>
<p>Để dùng CBO ta có thể thiết lập các parameter sau trước khi bắt đầu query</p>
<pre><code>set hive.cbo.enable=true;
set hive.compute.query.using.stats=true;
set hive.stats.fetch.column.stats=true;
set hive.stats.fetch.partition.stats=true;
</code></pre>
<p>Và ta phải chuẩn bị <code>Column, table statistic</code> cho CBO. Chú ý rằng, dữ liệu <code>statistics</code> của table chưa được tạo thì CBO sẽ bị tắt đi.</p>
<p>Dưới đây là 1 số câu lệnh để thu thập <code>Column, Table Statistics</code></p>
<pre><code>#1 Thu thập table statistics cho non-partitioned tables
ANALYZE TABLE [table_name] COMPUTE STATISTICS;

#2 Thu thập table statistics cho bảng được partition
ANALYZE TABLE [table_name] PARTITION(partition_column) COMPUTE STATISTICS;

#3 Thu thập column statistics
ANALYZE TABLE [table_name] COMPUTE STATISTICS for COLUMNS [comma_separated_column_list];
ANALYZE TABLE [table_name] PARTITION(partition_column) COMPUTE STATISTICS for COLUMNS [comma_separated_column_list];
</code></pre>
<p>Việc thu thập đầy đủ cả column statistics và table statistics là tốt nhất cho query performance.</p>
<h3 id="5thitkdatastoragedngpartitions">5. ​Thiết kế Data Storage dùng Partitions</h3>
<p><amp-img src="https://drive.google.com/uc?id=0B05rqFCwNCjkMVhXX1hGMVZoNjg&amp;export=download" alt width="550" height="209" layout="responsive"></amp-img></p>
<p>Partitions giúp cải thiện performance của câu Hive query bằng cách filter các partitioned columns. Từ đó ta chỉ phải scan dữ liệu trên 1 hoặc 1 số ít partition thỏa mãn điều kiện của filter. Một hệ thống lớn có thể có đến 10.000 partitions.</p>
<p>Ví dụ về partition</p>
<pre><code>CREATE TABLE sale(id in, amount decimal)
PARTITIONED BY (xdate string, state string);
</code></pre>
<p>Sau đây là 1 số best practices với partitions</p>
<ul>
<li>Không partition với unique ID</li>
<li>Kích thước trung bình của 1 partition nên lớn hơn hoặc bằng 1 GB</li>
<li>Một câu query không nên xử lý hơn 1000 partitions</li>
</ul>
<h3 id="ktlun">Kết luận</h3>
<p>Trên đây là 1 số cách đơn giản và hay được sử dụng để cải thiện tốc độ query của Hive.</p>
<p>Và cuối cùng, những cách đấy sẽ không thể có hiệu quả nếu câu SQL của ta không được tốt. Hãy viết những câu SQL tốt, giúp cho Hive query tốt hơn, nhanh hơn.</p>
<h3 id="thamkho">Tham khảo</h3>
<ul>
<li>[1] <a href="https://docs.hortonworks.com/HDPDocuments/HDP2/HDP-2.6.2/bk_hive-performance-tuning/content/ch_hive-perf-tuning-intro.html">Apache Hive Performance Tuning</a></li>
<li>[2] <a href="https://www.slideshare.net/Hadoop_Summit/hanson-o-malleypandeyjune27425pmroom212">ORC File &amp; Vectorization - Improving Hive Data Storage and Query Performance</a></li>
<li>[3] <a href="https://hortonworks.com/blog/orcfile-in-hdp-2-better-compression-better-performance/">ORCFILE IN HDP 2: BETTER COMPRESSION, BETTER PERFORMANCE</a></li>
<li>[4] <a href="https://hortonworks.com/blog/5-ways-make-hive-queries-run-faster/">How to make your Hive Queries run faster on Hadoop</a></li>
</ul>


            </section>

        </article>
    </main>
    <footer class="page-footer">
        <h3>GMO-Z.com Vietnam Lab Center Technology Blog</h3>
            <p>Blog chia sẻ kỹ thuật của thành viên công ty GMO-Z.com Vietnam Lab Center</p>
        <p><a href="../../">Read more posts →</a></p>
        <a class="powered" href="https://ghost.org" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 156 156"><g fill="none" fill-rule="evenodd"><rect fill="#15212B" width="156" height="156" rx="27"></rect><g transform="translate(36 36)" fill="#F6F8FA"><path d="M0 71.007A4.004 4.004 0 014 67h26a4 4 0 014 4.007v8.986A4.004 4.004 0 0130 84H4a4 4 0 01-4-4.007v-8.986zM50 71.007A4.004 4.004 0 0154 67h26a4 4 0 014 4.007v8.986A4.004 4.004 0 0180 84H54a4 4 0 01-4-4.007v-8.986z"></path><rect y="34" width="84" height="17" rx="4"></rect><path d="M0 4.007A4.007 4.007 0 014.007 0h41.986A4.003 4.003 0 0150 4.007v8.986A4.007 4.007 0 0145.993 17H4.007A4.003 4.003 0 010 12.993V4.007z"></path><rect x="67" width="17" height="17" rx="4"></rect></g></g></svg> Published with Ghost</a>
    </footer>
    
</body>
