<!DOCTYPE html>
<html ⚡>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

    <title>Tạo cuộc gọi tự động với Twilio bằng PHP</title>

    <link rel="canonical" href="../index.html" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    
    <meta property="og:site_name" content="GMO-Z.com Vietnam Lab Center Technology Blog" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Tạo cuộc gọi tự động với Twilio bằng PHP" />
    <meta property="og:description" content="|1| Giới thiệu Twilio là dịch vụ cho phép bạn xây dựng ứng dụng liên quan đến việc gửi và nhận các tin nhắn và cuộc gọi trên điện thoại một cách tự động.  Bài viết này sẽ demo cách tạo cuộc gọi tự động đến số điện thoại của" />
    <meta property="og:url" content="https://blog.vietnamlab.vn/tao-cuoc-goi-tu-dong-voi-twilio-bang-php/" />
    <meta property="og:image" content="https://drive.google.com/uc?id&#x3D;17G2Yykd9bOH-bYe0v1DinqZuEt_iLa1B&amp;export&#x3D;download" />
    <meta property="article:published_time" content="2020-10-09T23:57:07.000Z" />
    <meta property="article:modified_time" content="2020-10-09T23:57:07.000Z" />
    <meta property="article:tag" content="twilio" />
    <meta property="article:tag" content="php" />
    <meta property="article:tag" content="gather" />
    
    <meta property="article:publisher" content="https://www.facebook.com/vietnamlab.vn" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Tạo cuộc gọi tự động với Twilio bằng PHP" />
    <meta name="twitter:description" content="|1| Giới thiệu Twilio là dịch vụ cho phép bạn xây dựng ứng dụng liên quan đến việc gửi và nhận các tin nhắn và cuộc gọi trên điện thoại một cách tự động.  Bài viết này sẽ demo cách tạo cuộc gọi tự động đến số điện thoại của" />
    <meta name="twitter:url" content="https://blog.vietnamlab.vn/tao-cuoc-goi-tu-dong-voi-twilio-bang-php/" />
    <meta name="twitter:image" content="https://drive.google.com/uc?id&#x3D;17G2Yykd9bOH-bYe0v1DinqZuEt_iLa1B&amp;export&#x3D;download" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="D.T.H.L" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="twilio, php, gather" />
    <meta property="og:image:width" content="572" />
    <meta property="og:image:height" content="320" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "GMO-Z.com Vietnam Lab Center Technology Blog",
        "url": "https://blog.vietnamlab.vn/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://blog.vietnamlab.vn/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "D.T.H.L",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/790fde8e108c8f0a98d2f5680c38cc38?s=250&d=mm&r=x",
            "width": 250,
            "height": 250
        },
        "url": "https://blog.vietnamlab.vn/author/landth/",
        "sameAs": []
    },
    "headline": "Tạo cuộc gọi tự động với Twilio bằng PHP",
    "url": "https://blog.vietnamlab.vn/tao-cuoc-goi-tu-dong-voi-twilio-bang-php/",
    "datePublished": "2020-10-09T23:57:07.000Z",
    "dateModified": "2020-10-09T23:57:07.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://drive.google.com/uc?id=17G2Yykd9bOH-bYe0v1DinqZuEt_iLa1B&export=download",
        "width": 572,
        "height": 320
    },
    "keywords": "twilio, php, gather",
    "description": "|1| Giới thiệu\nTwilio là dịch vụ cho phép bạn xây dựng ứng dụng liên quan đến việc gửi và nhận\ncác tin nhắn và cuộc gọi trên điện thoại một cách tự động.\nBài viết này sẽ demo cách tạo cuộc gọi tự động đến số điện thoại của khách hàng\nbằng PHP. Sau khi khách hàng nhận cuộc gọi, sẽ nghe thông tin và lựa chọn các\noptions bằng cách nhấn số 1 hoặc 2 hoặc 3 (tuỳ vào bạn setup).\n\n|2| Tạo tài khoản Twilio dùng thử\nBạn vào trang https://www.twilio.com và đang ký một tài khoản. Sau đó sẽ vào màn\nhình cons",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://blog.vietnamlab.vn/"
    }
}
    </script>

    <meta name="generator" content="Ghost 3.36" />
    <link rel="alternate" type="application/rss+xml" title="GMO-Z.com Vietnam Lab Center Technology Blog" href="../../rss/index.html" />

    <style amp-custom>
    *,
    *::before,
    *::after {
        box-sizing: border-box;
    }

    html {
        overflow-x: hidden;
        overflow-y: scroll;
        font-size: 62.5%;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    }

    body {
        min-height: 100vh;
        margin: 0;
        padding: 0;
        color: #3a4145;
        font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;
        font-size: 1.7rem;
        line-height: 1.55em;
        font-weight: 400;
        font-style: normal;
        background: #fff;
        scroll-behavior: smooth;
        overflow-x: hidden;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    p,
    ul,
    ol,
    li,
    dl,
    dd,
    hr,
    pre,
    form,
    table,
    video,
    figure,
    figcaption,
    blockquote {
        margin: 0;
        padding: 0;
    }

    ul[class],
    ol[class] {
        padding: 0;
        list-style: none;
    }

    img {
        display: block;
        max-width: 100%;
    }

    input,
    button,
    select,
    textarea {
        font: inherit;
        -webkit-appearance: none;
    }

    fieldset {
        margin: 0;
        padding: 0;
        border: 0;
    }

    label {
        display: block;
        font-size: 0.9em;
        font-weight: 700;
    }

    hr {
        position: relative;
        display: block;
        width: 100%;
        height: 1px;
        border: 0;
        border-top: 1px solid currentcolor;
        opacity: 0.1;
    }

    ::selection {
        text-shadow: none;
        background: #cbeafb;
    }

    mark {
        background-color: #fdffb6;
    }

    small {
        font-size: 80%;
    }

    sub,
    sup {
        position: relative;
        font-size: 75%;
        line-height: 0;
        vertical-align: baseline;
    }
    sup {
        top: -0.5em;
    }
    sub {
        bottom: -0.25em;
    }

    ul li + li {
        margin-top: 0.6em;
    }

    a {
        color: #1292EE;
        text-decoration-skip-ink: auto;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        margin: 0;
        font-weight: 700;
        color: #121212;
        line-height: 1.4em;
    }

    h1 {
        font-size: 3.4rem;
        line-height: 1.1em;
    }

    h2 {
        font-size: 2.4rem;
        line-height: 1.2em;
    }

    h3 {
        font-size: 1.8rem;
    }

    h4 {
        font-size: 1.7rem;
    }

    h5 {
        font-size: 1.6rem;
    }

    h6 {
        font-size: 1.6rem;
    }

    amp-img {
        height: 100%;
        width: 100%;
        max-width: 100%;
        max-height: 100%;
    }

    amp-img img {
        object-fit: cover;
    }

    .page-header {
        padding: 50px 5vmin 30px;
        text-align: center;
        font-size: 2rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .page-header a {
        color: #121212;
        font-weight: 700;
        text-decoration: none;
        font-size: 1.6rem;
        letter-spacing: -0.1px;
    }

    .post {
        max-width: 680px;
        margin: 0 auto;
    }

    .post-header {
        margin: 0 5vmin 5vmin;
        text-align: center;
    }

    .post-meta {
        margin: 1rem 0 0 0;
        text-transform: uppercase;
        color: #738a94;
        font-weight: 500;
        font-size: 1.3rem;
    }

    .post-image {
        margin: 0 0 5vmin;
    }

    .post-image img {
        display: block;
        width: 100%;
        height: auto;
    }

    .post-content {
        padding: 0 5vmin;
    }

    .post-content > * + * {
        margin-top: 1.5em;
    }

    .post-content [id]:not(:first-child) {
        margin: 2em 0 0;
    }

    .post-content > [id] + * {
        margin-top: 1rem;
    }

    .post-content [id] + .kg-card,
    .post-content blockquote + .kg-card {
        margin-top: 40px;
    }

    .post-content > ul,
    .post-content > ol,
    .post-content > dl {
        padding-left: 1.9em;
    }

    .post-content hr {
        margin-top: 40px;
    }

    .post .post-content hr + * {
        margin-top: 40px;
    }

    .post-content amp-img {
        background-color: #f8f8f8;
    }

    .post-content blockquote {
        position: relative;
        font-style: italic;
    }

    .post-content blockquote::before {
        content: "";
        position: absolute;
        left: -1.5em;
        top: 0;
        bottom: 0;
        width: 0.3rem;
        background: #000;
    }

    .post-content :not(.kg-card):not([id]) + .kg-card {
        margin-top: 40px;
    }

    .post-content .kg-card + :not(.kg-card) {
        margin-top: 40px;
    }

    .kg-card figcaption {
        padding: 1.5rem 1.5rem 0;
        text-align: center;
        font-weight: 500;
        font-size: 1.3rem;
        line-height: 1.4em;
        opacity: 0.6;
    }

    .kg-card figcaption strong {
        color: rgba(0,0,0,0.8);
    }

    .post-content :not(pre) code {
        vertical-align: middle;
        padding: 0.15em 0.4em 0.15em;
        border: #e1eaef 1px solid;
        font-weight: 400;
        font-size: 0.9em;
        line-height: 1em;
        color: #dc0050;
        background: #f0f6f9;
        border-radius: 0.25em;
    }

    .post-content > pre {
        overflow: scroll;
        padding: 16px 20px;
        color: #fff;
        background: #1F2428;
        border-radius: 5px;
        box-shadow: 0 2px 6px -2px rgba(0,0,0,.1), 0 0 1px rgba(0,0,0,.4);
    }

    .kg-embed-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
    }

    .kg-image-card img {
        margin: auto;
    }

    .kg-gallery-card + .kg-gallery-card {
        margin-top: 0.75em;
    }

    .kg-gallery-container {
        position: relative;
    }

    .kg-gallery-row {
        display: flex;
        flex-direction: row;
        justify-content: center;
    }

    .kg-gallery-image {
        width: 100%;
        height: 100%;
    }

    .kg-gallery-row:not(:first-of-type) {
        margin: 0.75em 0 0 0;
    }

    .kg-gallery-image:not(:first-of-type) {
        margin: 0 0 0 0.75em;
    }

    .kg-bookmark-card,
    .kg-bookmark-publisher {
        position: relative;
    }

    .kg-bookmark-container,
    .kg-bookmark-container:hover {
        display: flex;
        flex-wrap: wrap;
        flex-direction: row-reverse;
        color: currentColor;
        background: rgba(255,255,255,0.6);
        font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;
        text-decoration: none;
        border-radius: 5px;
        box-shadow: 0 2px 6px -2px rgba(0, 0, 0, 0.1), 0 0 1px rgba(0, 0, 0, 0.4);
        overflow: hidden;
    }

    .kg-bookmark-content {
        flex-basis: 0;
        flex-grow: 999;
        padding: 20px;
        order: 1;
    }

    .kg-bookmark-title {
        font-weight: 600;
        font-size: 1.5rem;
        line-height: 1.3em;
    }

    .kg-bookmark-description {
        display: -webkit-box;
        max-height: 45px;
        margin: 0.5em 0 0 0;
        font-size: 1.4rem;
        line-height: 1.55em;
        overflow: hidden;
        opacity: 0.8;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }

    .kg-bookmark-metadata {
        margin-top: 20px;
    }

    .kg-bookmark-metadata {
        display: flex;
        align-items: center;
        font-weight: 500;
        font-size: 1.3rem;
        line-height: 1.3em;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .kg-bookmark-description {
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
        overflow: hidden;
    }

    .kg-bookmark-metadata amp-img {
        width: 18px;
        height: 18px;
        max-width: 18px;
        max-height: 18px;
        margin-right: 10px;
    }

    .kg-bookmark-thumbnail {
        display: flex;
        flex-basis: 20rem;
        flex-grow: 1;
        justify-content: flex-end;
    }

    .kg-bookmark-thumbnail amp-img {
        max-height: 200px;
    }

    .kg-bookmark-author {
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
    }

    .kg-bookmark-publisher::before {
        content: "•";
        margin: 0 .5em;
    }

    .kg-width-full.kg-card-hascaption {
        display: grid;
        grid-template-columns: inherit;
    }

    .post-content table {
        border-collapse: collapse;
        width: 100%;
    }

    .post-content th {
        padding: 0.5em 0.8em;
        text-align: left;
        font-size: .75em;
        text-transform: uppercase;
    }

    .post-content td {
        padding: 0.4em 0.7em;
    }

    .post-content tbody tr:nth-child(2n + 1) {
        background-color: rgba(0,0,0,0.1);
        padding: 1px;
    }

    .post-content tbody tr:nth-child(2n + 2) td:last-child {
        box-shadow:
            inset 1px 0 rgba(0,0,0,0.1),
            inset -1px 0 rgba(0,0,0,0.1);
    }

    .post-content tbody tr:nth-child(2n + 2) td {
        box-shadow: inset 1px 0 rgba(0,0,0,0.1);
    }

    .post-content tbody tr:last-child {
        border-bottom: 1px solid rgba(0,0,0,.1);
    }

    .page-footer {
        padding: 60px 5vmin;
        margin: 60px auto 0;
        text-align: center;
        background-color: #f8f8f8;
    }

    .page-footer h3 {
        margin: 0.5rem 0 0 0;
    }

    .page-footer p {
        max-width: 500px;
        margin: 1rem auto 1.5rem;
        font-size: 1.7rem;
        line-height: 1.5em;
        color: rgba(0,0,0,0.6)
    }

    .powered {
        display: inline-flex;
        align-items: center;
        margin: 30px 0 0;
        padding: 6px 9px 6px 6px;
        border: rgba(0,0,0,0.1) 1px solid;
        font-size: 12px;
        line-height: 12px;
        letter-spacing: -0.2px;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
        font-weight: 500;
        color: #222;
        text-decoration: none;
        background: #fff;
        border-radius: 6px;
    }

    .powered svg {
        height: 16px;
        width: 16px;
        margin: 0 6px 0 0;
    }

    @media (max-width: 600px) {
        body {
            font-size: 1.6rem;
        }
        h1 {
            font-size: 3rem;
        }

        h2 {
            font-size: 2.2rem;
        }
    }

    @media (max-width: 400px) {
        h1 {
            font-size: 2.6rem;
            line-height: 1.15em;
        }
        h2 {
            font-size: 2rem;
            line-height: 1.2em;
        }
        h3 {
            font-size: 1.7rem;
        }
    }
    </style>

    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>

    

</head>

<body class="amp-template">
    <header class="page-header">
        <a href="../../index.html">
                GMO-Z.com Vietnam Lab Center Technology Blog
        </a>
    </header>

    <main class="content" role="main">
        <article class="post">

            <header class="post-header">
                <h1 class="post-title">Tạo cuộc gọi tự động với Twilio bằng PHP</h1>
                <section class="post-meta">
                    D.T.H.L -
                    <time class="post-date" datetime="2020-10-10">10 Oct 2020</time>
                </section>
            </header>
            <figure class="post-image">
                <amp-img src="https://drive.google.com/uc?id&#x3D;17G2Yykd9bOH-bYe0v1DinqZuEt_iLa1B&amp;export&#x3D;download" width="600" height="340" layout="responsive"></amp-img>
            </figure>
            <section class="post-content">

                <h3 id="1giithiu">|1| Giới thiệu</h3>
<p>Twilio là dịch vụ cho phép bạn xây dựng ứng dụng liên quan đến việc gửi và nhận các tin nhắn và cuộc gọi trên điện thoại một cách tự động.<br />
Bài viết này sẽ demo cách tạo cuộc gọi tự động đến số điện thoại của khách hàng bằng PHP. Sau khi khách hàng nhận cuộc gọi, sẽ nghe thông tin và lựa chọn các options bằng cách nhấn số 1 hoặc 2 hoặc 3 (tuỳ vào bạn setup).</p>
<h3 id="2totikhontwiliodngth">|2| Tạo tài khoản Twilio dùng thử</h3>
<p>Bạn vào trang <a href="https://www.twilio.com">https://www.twilio.com</a> và đang ký một tài khoản. Sau đó sẽ vào màn hình console <a href="https://www.twilio.com/console">https://www.twilio.com/console</a>. Tại đây bạn đăng ký để được được cấp một số điện thoại trial với tài khoản $15. Bạn sẽ setup số điện thoại này để gọi đến số của khách hàng.</p>
<p><amp-img src="https://drive.google.com/uc?id=11wZY5pbaLhhFOjJCGRQ75km3QPQ0L7tQ&amp;export=download" alt="uc?id=11wZY5pbaLhhFOjJCGRQ75km3QPQ0L7tQ&amp;export=download" width="1364" height="586" layout="responsive"></amp-img></p>
<p>Như hình trên, bạn sẽ có 3 thông tin cần thiết cho việc setup TRIAL NUMBER, ACCOUNT SID, AUTH TOKEN.</p>
<p>Bạn cũng đừng quên kiểm tra xem giới hạn khu vực ở Việt Nam đã được check chưa. Kiểm tra và check ở <a href="https://www.twilio.com/console/voice/calls/geo-permissions/low-risk">https://www.twilio.com/console/voice/calls/geo-permissions/low-risk</a></p>
<p><amp-img src="https://drive.google.com/uc?id=17pjEvNNKK6_HhYxqF7KQbRe_n9XTncCF&amp;export=download" alt="uc?id=17pjEvNNKK6_HhYxqF7KQbRe_n9XTncCF&amp;export=download" width="1363" height="583" layout="responsive"></amp-img></p>
<h3 id="3codeviphp">|3| Code với PHP</h3>
<p>Chương trình của chúng ta ở đây là sẽ gọi điện đến số của khách hàng, sau đó chờ input trả về từ khách hàng. Nó sẽ có những bước sau:</p>
<ol>
<li>Gọi đến khách hàng và phát thông tin.</li>
<li>Chờ nhận input trả về từ khách hàng.</li>
<li>Nếu khách không input gì thì lặp lại câu phát thông tin ở bước 1.</li>
<li>Nếu khách đã input thì cám ơn rồi thoát.</li>
</ol>
<p>Ở bước 2, việc chờ input từ khách thì ta sẽ sử dụng module Gather mà Twilio cung cấp. Tham khảo <a href="https://www.twilio.com/docs/voice/twiml/gather">tại đây</a></p>
<h5 id="citwiliosdk">① Cài Twilio SDK</h5>
<pre><code>composer require twilio/sdk
</code></pre>
<h5 id="cingrok">② Cài ngrok</h5>
<p><code>Ngrok</code> là một dịch vụ xịn xò dùng để public ip local. Có thể tham khảo thêm <a href="https://www.twilio.com/docs/usage/tutorials/how-to-set-up-your-php-development-environment#install-ngrok">tại đây</a>.</p>
<p>Sau khi download về, bạn mở CMD di chuyển vào thư mục chứa file ngrok vừa down về và chạy lệnh sau:</p>
<pre><code class="language-bash">ngrok http 3000
</code></pre>
<p>3000 là port bạn đang mở ở local khi chạy ứng dụng php của bạn (localhost:3000)</p>
<p>Sau khi chạy lệnh trên xong, <code>ngrok</code> sẽ tạo cho bạn 1 link mới. Link này tương đương vs <a href="http://localhost:3000">http://localhost:3000</a>. Bạn sẽ dùng link đó để sử dụng trong twilio.</p>
<p><amp-img src="https://drive.google.com/uc?id=1cwD1gn5J_s8Y78EnQ8rmSjNMGXqANpfw&amp;export=download" alt="uc?id=1cwD1gn5J_s8Y78EnQ8rmSjNMGXqANpfw&amp;export=download" width="624" height="253" layout="responsive"></amp-img></p>
<h5 id="tofile1outboundcallphpkchhotcucgi">③ Tạo file 1-outbound-call.php để kích hoạt cuộc gọi</h5>
<pre><code class="language-php">&lt;?php
require_once '/path/to/vendor/autoload.php'; // Loads the library
use Twilio\Rest\Client;

const SERVICE_SSL_URL = "http://70a04428.ngrok.io"

$sid    = "YOU_ACCOUNT_SID";
$token  = "YOUR_AUTH_TOKEN";
$client = new Client($sid, $token);

$to     = "+84901234567";    // YOUR CUSTOMER'S NUMBER
$from   = "+12029463870";  // TRIAL NUMBER
$params = [
            'url' =&gt; SERVICE_SSL_URL.'/2-call-answered-gather.php'
        ];

$call = $client-&gt;calls-&gt;create($to, $from, $params);

</code></pre>
<p>Sau khi <code>create()</code> được thực thi, dịch vụ Twilio sẽ được kích hoạt. Twilio sẽ gọi lại đường dẫn url mà bạn đã khai báo bên trên để lấy thông tin sẽ phát thoại.</p>
<h5 id="tofile2callansweredgatherphp">④ Tạo file 2-call-answered-gather.php</h5>
<pre><code class="language-php">&lt;?php
require_once '/path/to/vendor/autoload.php';
use Twilio\Twiml;

const SERVICE_SSL_URL = "http://70a04428.ngrok.io"

// Use the Twilio PHP SDK to build an XML response
$response = new Twiml();

// Use the &lt;Gather&gt; verb to collect user input
$params = [
            'method' =&gt; 'POST',
            'numDigits' =&gt; 1,  // limit number input
            'action' =&gt; SERVICE_SSL_URL.'/3-gather.php' // called after input
        ];
$gather = $response-&gt;gather($params);

// use the &lt;Say&gt; verb to request input from the user
$gather-&gt;say('Press 1 to take a survey. Press 2 to hear a joke.');

// If the user doesn't enter input, loop
$response-&gt;redirect(SERVICE_SSL_URL.'/2-call-answered-gather.php');

// Render the response as XML in reply to the webhook request
header('Content-Type: text/xml');
echo $response;
</code></pre>
<p>Sau khi câu lệnh <code>$gather-&gt;say(...)</code> được thực hiện, thì khách hàng sẽ nghe lời thoại bạn đã định nghĩa và dừng chờ khách hàng nhập số. Nếu khách nhập số thì ngay lập tức sẽ được chuyển đến file dưới đây để xử lý. Nếu khách không input gì thì sẽ nhảy xuống câu lệnh bên dưới là lệnh <code>$response-&gt;redirect()</code></p>
<h5 id="tofile3gatherphpxlinputtuser">⑤ Tạo file 3-gather.php để xử lý input từ user</h5>
<pre><code class="language-php">&lt;?php
require_once '/path/to/vendor/autoload.php';
use Twilio\Twiml;

const SERVICE_SSL_URL = "http://70a04428.ngrok.io"

// Use the Twilio PHP SDK to build an XML response
$response = new Twiml();

// If the user entered digits, process their request
if (array_key_exists('Digits', $_POST)) {
    switch ($_POST['Digits']) {
    case 1:
        $response-&gt;say('You selected to take the survey. Thank you!');
        break;
    case 2:
        $response-&gt;say('You selected to her a joke! Why did the robot cross the road? Because it was carbon bonded to the chicken!');
        break;
    default:
        $response-&gt;say('Sorry, I don\'t understand that choice.');
        $response-&gt;redirect(SERVICE_SSL_URL.'/2-call-answered-gather.php');
    }
} else {
    // If no input was sent, redirect to the /voice route
    $response-&gt;redirect(SERVICE_SSL_URL.'/2-call-answered-gather.php');
}

// Render the response as XML in reply to the webhook request
header('Content-Type: text/xml');
echo $response;
</code></pre>
<p>Ở bước này, Twilio sẽ trả về thông tin khách hàng đã input qua <code>Digits</code>. Dữ liệu response theo phương thức <code>POST</code> là do ở bước thứ 4 ta đã định nghĩa <code>method</code> là <code>POST</code>. Bây giờ bạn đã có con số mà khách hàng input, lúc này bạn sẽ xử lý tuỳ vào chương trình của bạn.</p>
<p>Vậy quy trình thực thi giữa app của bạn vs Twilio là như thế nào?</p>
<ol>
<li>Từ app kích hoạt cuộc gọi đến dịch vụ Twilio. Twilio thực hiện cuộc gọi đến số điện thoại đã khai báo.</li>
<li>Khách hàng bắt máy.</li>
<li>Twilio redirect về app lấy message (cái mà Twilio sẽ phát thoại cho số điện thoại gọi đi)</li>
<li>App trả lại cho Twilio message</li>
<li>Twilio phát message qua điện thoại cho khách hàng nghe</li>
<li>Twilio chờ khách hàng input.</li>
<li>Khách hàng input.</li>
<li>Twilio gửi về lại cho app.</li>
<li>App xử lý rồi phản hồi Twilio.</li>
<li>Twilio phát thoại tin nhắn mà app đã phản hồi.</li>
<li>Kết thúc.</li>
</ol>
<h3 id="4chtbi">|4| Chốt bài</h3>
<p>Demo nho nhỏ đã được hoàn thành. Twilio còn cung cấp các tính năng xịn xò khác như đa ngôn ngữ, giọng nam/nữ, v.v... Các bạn tham khảo thêm trên trang document của Twilio nhé.</p>


            </section>

        </article>
    </main>
    <footer class="page-footer">
        <h3>GMO-Z.com Vietnam Lab Center Technology Blog</h3>
            <p>Blog chia sẻ kỹ thuật của thành viên công ty GMO-Z.com Vietnam Lab Center</p>
        <p><a href="../../index.html">Read more posts →</a></p>
        <a class="powered" href="https://ghost.org" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 156 156"><g fill="none" fill-rule="evenodd"><rect fill="#15212B" width="156" height="156" rx="27"/><g transform="translate(36 36)" fill="#F6F8FA"><path d="M0 71.007A4.004 4.004 0 014 67h26a4 4 0 014 4.007v8.986A4.004 4.004 0 0130 84H4a4 4 0 01-4-4.007v-8.986zM50 71.007A4.004 4.004 0 0154 67h26a4 4 0 014 4.007v8.986A4.004 4.004 0 0180 84H54a4 4 0 01-4-4.007v-8.986z"/><rect y="34" width="84" height="17" rx="4"/><path d="M0 4.007A4.007 4.007 0 014.007 0h41.986A4.003 4.003 0 0150 4.007v8.986A4.007 4.007 0 0145.993 17H4.007A4.003 4.003 0 010 12.993V4.007z"/><rect x="67" width="17" height="17" rx="4"/></g></g></svg> Published with Ghost</a>
    </footer>
    
</body>
</html>
