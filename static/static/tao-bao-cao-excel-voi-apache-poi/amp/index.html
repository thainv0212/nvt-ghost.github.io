<!DOCTYPE html>
<html ⚡>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

    <title>Tạo báo cáo Excel với Apache POI</title>

    <meta name="description" content="Apache POI là một API nổi tiếng cho phép ta làm việc với các MS Office files bằng ngôn ngữ Java. Nó là thư viện mã nguồn mở được phát triển bởi Apache" />
    <link rel="canonical" href="../index.html" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    
    <meta property="og:site_name" content="GMO-Z.com Vietnam Lab Center Technology Blog" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Tạo báo cáo Excel với Apache POI" />
    <meta property="og:description" content="Apache POI là một API nổi tiếng cho phép ta làm việc với các MS Office files bằng ngôn ngữ Java. Nó là thư viện mã nguồn mở được phát triển bởi Apache" />
    <meta property="og:url" content="https://blog.vietnamlab.vn/tao-bao-cao-excel-voi-apache-poi/" />
    <meta property="og:image" content="https://drive.google.com/uc?id&#x3D;0B05rqFCwNCjkZlNyZzRKQ3RvUnM&amp;export&#x3D;download" />
    <meta property="article:published_time" content="2017-06-30T01:00:00.000Z" />
    <meta property="article:modified_time" content="2017-06-30T01:46:49.000Z" />
    <meta property="article:tag" content="java" />
    <meta property="article:tag" content="Apache POI" />
    <meta property="article:tag" content="Microsoft Excel" />
    <meta property="article:tag" content="Microsoft Word" />
    <meta property="article:tag" content="Microsoft PowerPoint" />
    
    <meta property="article:publisher" content="https://www.facebook.com/vietnamlab.vn" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Tạo báo cáo Excel với Apache POI" />
    <meta name="twitter:description" content="Apache POI là một API nổi tiếng cho phép ta làm việc với các MS Office files bằng ngôn ngữ Java. Nó là thư viện mã nguồn mở được phát triển bởi Apache" />
    <meta name="twitter:url" content="https://blog.vietnamlab.vn/tao-bao-cao-excel-voi-apache-poi/" />
    <meta name="twitter:image" content="https://drive.google.com/uc?id&#x3D;0B05rqFCwNCjkZlNyZzRKQ3RvUnM&amp;export&#x3D;download" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="N.C.M" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="java, Apache POI, Microsoft Excel, Microsoft Word, Microsoft PowerPoint" />
    <meta property="og:image:width" content="960" />
    <meta property="og:image:height" content="720" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "GMO-Z.com Vietnam Lab Center Technology Blog",
        "url": "https://blog.vietnamlab.vn/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://blog.vietnamlab.vn/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "N.C.M",
        "image": {
            "@type": "ImageObject",
            "url": "https://vignette2.wikia.nocookie.net/onepiece/images/2/23/Zoro_After_Taking_Luffy%27s_Pain.png/revision/latest?cb=20140518230609",
            "width": 672,
            "height": 1390
        },
        "url": "https://blog.vietnamlab.vn/author/minhnc/",
        "sameAs": [
            "https://vietnamlab.vn"
        ]
    },
    "headline": "Tạo báo cáo Excel với Apache POI",
    "url": "https://blog.vietnamlab.vn/tao-bao-cao-excel-voi-apache-poi/",
    "datePublished": "2017-06-30T01:00:00.000Z",
    "dateModified": "2017-06-30T01:46:49.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://drive.google.com/uc?id=0B05rqFCwNCjkZlNyZzRKQ3RvUnM&export=download",
        "width": 960,
        "height": 720
    },
    "keywords": "java, Apache POI, Microsoft Excel, Microsoft Word, Microsoft PowerPoint",
    "description": "Gần đây mình phải cài đặt chức năng tự động tạo báo cáo dạng Microsoft Excel\nfile. Việc tạo báo cáo dưới dạng file Excel này là một chức năng rất hay được\nyêu cầu khi phát triển phần mềm. Bên cạnh đó, nhiều phần mềm cũng thường xuyên\nphải nhận input data từ file Excel.\n\n1. Tổng quan\n1.1. Apache POI là gì?\nApache POI là một API nổi tiếng cho phép ta làm việc với các MS Office files\nbằng ngôn ngữ Java. Nó là thư viện mã nguồn mở được phát triển bởi Apache\nSoftware Foundation.\nPOI là viết tắt của &quot;",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://blog.vietnamlab.vn/"
    }
}
    </script>

    <meta name="generator" content="Ghost 3.36" />
    <link rel="alternate" type="application/rss+xml" title="GMO-Z.com Vietnam Lab Center Technology Blog" href="../../rss/index.html" />

    <style amp-custom>
    *,
    *::before,
    *::after {
        box-sizing: border-box;
    }

    html {
        overflow-x: hidden;
        overflow-y: scroll;
        font-size: 62.5%;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    }

    body {
        min-height: 100vh;
        margin: 0;
        padding: 0;
        color: #3a4145;
        font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;
        font-size: 1.7rem;
        line-height: 1.55em;
        font-weight: 400;
        font-style: normal;
        background: #fff;
        scroll-behavior: smooth;
        overflow-x: hidden;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    p,
    ul,
    ol,
    li,
    dl,
    dd,
    hr,
    pre,
    form,
    table,
    video,
    figure,
    figcaption,
    blockquote {
        margin: 0;
        padding: 0;
    }

    ul[class],
    ol[class] {
        padding: 0;
        list-style: none;
    }

    img {
        display: block;
        max-width: 100%;
    }

    input,
    button,
    select,
    textarea {
        font: inherit;
        -webkit-appearance: none;
    }

    fieldset {
        margin: 0;
        padding: 0;
        border: 0;
    }

    label {
        display: block;
        font-size: 0.9em;
        font-weight: 700;
    }

    hr {
        position: relative;
        display: block;
        width: 100%;
        height: 1px;
        border: 0;
        border-top: 1px solid currentcolor;
        opacity: 0.1;
    }

    ::selection {
        text-shadow: none;
        background: #cbeafb;
    }

    mark {
        background-color: #fdffb6;
    }

    small {
        font-size: 80%;
    }

    sub,
    sup {
        position: relative;
        font-size: 75%;
        line-height: 0;
        vertical-align: baseline;
    }
    sup {
        top: -0.5em;
    }
    sub {
        bottom: -0.25em;
    }

    ul li + li {
        margin-top: 0.6em;
    }

    a {
        color: #1292EE;
        text-decoration-skip-ink: auto;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        margin: 0;
        font-weight: 700;
        color: #121212;
        line-height: 1.4em;
    }

    h1 {
        font-size: 3.4rem;
        line-height: 1.1em;
    }

    h2 {
        font-size: 2.4rem;
        line-height: 1.2em;
    }

    h3 {
        font-size: 1.8rem;
    }

    h4 {
        font-size: 1.7rem;
    }

    h5 {
        font-size: 1.6rem;
    }

    h6 {
        font-size: 1.6rem;
    }

    amp-img {
        height: 100%;
        width: 100%;
        max-width: 100%;
        max-height: 100%;
    }

    amp-img img {
        object-fit: cover;
    }

    .page-header {
        padding: 50px 5vmin 30px;
        text-align: center;
        font-size: 2rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .page-header a {
        color: #121212;
        font-weight: 700;
        text-decoration: none;
        font-size: 1.6rem;
        letter-spacing: -0.1px;
    }

    .post {
        max-width: 680px;
        margin: 0 auto;
    }

    .post-header {
        margin: 0 5vmin 5vmin;
        text-align: center;
    }

    .post-meta {
        margin: 1rem 0 0 0;
        text-transform: uppercase;
        color: #738a94;
        font-weight: 500;
        font-size: 1.3rem;
    }

    .post-image {
        margin: 0 0 5vmin;
    }

    .post-image img {
        display: block;
        width: 100%;
        height: auto;
    }

    .post-content {
        padding: 0 5vmin;
    }

    .post-content > * + * {
        margin-top: 1.5em;
    }

    .post-content [id]:not(:first-child) {
        margin: 2em 0 0;
    }

    .post-content > [id] + * {
        margin-top: 1rem;
    }

    .post-content [id] + .kg-card,
    .post-content blockquote + .kg-card {
        margin-top: 40px;
    }

    .post-content > ul,
    .post-content > ol,
    .post-content > dl {
        padding-left: 1.9em;
    }

    .post-content hr {
        margin-top: 40px;
    }

    .post .post-content hr + * {
        margin-top: 40px;
    }

    .post-content amp-img {
        background-color: #f8f8f8;
    }

    .post-content blockquote {
        position: relative;
        font-style: italic;
    }

    .post-content blockquote::before {
        content: "";
        position: absolute;
        left: -1.5em;
        top: 0;
        bottom: 0;
        width: 0.3rem;
        background: #000;
    }

    .post-content :not(.kg-card):not([id]) + .kg-card {
        margin-top: 40px;
    }

    .post-content .kg-card + :not(.kg-card) {
        margin-top: 40px;
    }

    .kg-card figcaption {
        padding: 1.5rem 1.5rem 0;
        text-align: center;
        font-weight: 500;
        font-size: 1.3rem;
        line-height: 1.4em;
        opacity: 0.6;
    }

    .kg-card figcaption strong {
        color: rgba(0,0,0,0.8);
    }

    .post-content :not(pre) code {
        vertical-align: middle;
        padding: 0.15em 0.4em 0.15em;
        border: #e1eaef 1px solid;
        font-weight: 400;
        font-size: 0.9em;
        line-height: 1em;
        color: #dc0050;
        background: #f0f6f9;
        border-radius: 0.25em;
    }

    .post-content > pre {
        overflow: scroll;
        padding: 16px 20px;
        color: #fff;
        background: #1F2428;
        border-radius: 5px;
        box-shadow: 0 2px 6px -2px rgba(0,0,0,.1), 0 0 1px rgba(0,0,0,.4);
    }

    .kg-embed-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
    }

    .kg-image-card img {
        margin: auto;
    }

    .kg-gallery-card + .kg-gallery-card {
        margin-top: 0.75em;
    }

    .kg-gallery-container {
        position: relative;
    }

    .kg-gallery-row {
        display: flex;
        flex-direction: row;
        justify-content: center;
    }

    .kg-gallery-image {
        width: 100%;
        height: 100%;
    }

    .kg-gallery-row:not(:first-of-type) {
        margin: 0.75em 0 0 0;
    }

    .kg-gallery-image:not(:first-of-type) {
        margin: 0 0 0 0.75em;
    }

    .kg-bookmark-card,
    .kg-bookmark-publisher {
        position: relative;
    }

    .kg-bookmark-container,
    .kg-bookmark-container:hover {
        display: flex;
        flex-wrap: wrap;
        flex-direction: row-reverse;
        color: currentColor;
        background: rgba(255,255,255,0.6);
        font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;
        text-decoration: none;
        border-radius: 5px;
        box-shadow: 0 2px 6px -2px rgba(0, 0, 0, 0.1), 0 0 1px rgba(0, 0, 0, 0.4);
        overflow: hidden;
    }

    .kg-bookmark-content {
        flex-basis: 0;
        flex-grow: 999;
        padding: 20px;
        order: 1;
    }

    .kg-bookmark-title {
        font-weight: 600;
        font-size: 1.5rem;
        line-height: 1.3em;
    }

    .kg-bookmark-description {
        display: -webkit-box;
        max-height: 45px;
        margin: 0.5em 0 0 0;
        font-size: 1.4rem;
        line-height: 1.55em;
        overflow: hidden;
        opacity: 0.8;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }

    .kg-bookmark-metadata {
        margin-top: 20px;
    }

    .kg-bookmark-metadata {
        display: flex;
        align-items: center;
        font-weight: 500;
        font-size: 1.3rem;
        line-height: 1.3em;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .kg-bookmark-description {
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
        overflow: hidden;
    }

    .kg-bookmark-metadata amp-img {
        width: 18px;
        height: 18px;
        max-width: 18px;
        max-height: 18px;
        margin-right: 10px;
    }

    .kg-bookmark-thumbnail {
        display: flex;
        flex-basis: 20rem;
        flex-grow: 1;
        justify-content: flex-end;
    }

    .kg-bookmark-thumbnail amp-img {
        max-height: 200px;
    }

    .kg-bookmark-author {
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
    }

    .kg-bookmark-publisher::before {
        content: "•";
        margin: 0 .5em;
    }

    .kg-width-full.kg-card-hascaption {
        display: grid;
        grid-template-columns: inherit;
    }

    .post-content table {
        border-collapse: collapse;
        width: 100%;
    }

    .post-content th {
        padding: 0.5em 0.8em;
        text-align: left;
        font-size: .75em;
        text-transform: uppercase;
    }

    .post-content td {
        padding: 0.4em 0.7em;
    }

    .post-content tbody tr:nth-child(2n + 1) {
        background-color: rgba(0,0,0,0.1);
        padding: 1px;
    }

    .post-content tbody tr:nth-child(2n + 2) td:last-child {
        box-shadow:
            inset 1px 0 rgba(0,0,0,0.1),
            inset -1px 0 rgba(0,0,0,0.1);
    }

    .post-content tbody tr:nth-child(2n + 2) td {
        box-shadow: inset 1px 0 rgba(0,0,0,0.1);
    }

    .post-content tbody tr:last-child {
        border-bottom: 1px solid rgba(0,0,0,.1);
    }

    .page-footer {
        padding: 60px 5vmin;
        margin: 60px auto 0;
        text-align: center;
        background-color: #f8f8f8;
    }

    .page-footer h3 {
        margin: 0.5rem 0 0 0;
    }

    .page-footer p {
        max-width: 500px;
        margin: 1rem auto 1.5rem;
        font-size: 1.7rem;
        line-height: 1.5em;
        color: rgba(0,0,0,0.6)
    }

    .powered {
        display: inline-flex;
        align-items: center;
        margin: 30px 0 0;
        padding: 6px 9px 6px 6px;
        border: rgba(0,0,0,0.1) 1px solid;
        font-size: 12px;
        line-height: 12px;
        letter-spacing: -0.2px;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
        font-weight: 500;
        color: #222;
        text-decoration: none;
        background: #fff;
        border-radius: 6px;
    }

    .powered svg {
        height: 16px;
        width: 16px;
        margin: 0 6px 0 0;
    }

    @media (max-width: 600px) {
        body {
            font-size: 1.6rem;
        }
        h1 {
            font-size: 3rem;
        }

        h2 {
            font-size: 2.2rem;
        }
    }

    @media (max-width: 400px) {
        h1 {
            font-size: 2.6rem;
            line-height: 1.15em;
        }
        h2 {
            font-size: 2rem;
            line-height: 1.2em;
        }
        h3 {
            font-size: 1.7rem;
        }
    }
    </style>

    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>

    

</head>

<body class="amp-template">
    <header class="page-header">
        <a href="../../index.html">
                GMO-Z.com Vietnam Lab Center Technology Blog
        </a>
    </header>

    <main class="content" role="main">
        <article class="post">

            <header class="post-header">
                <h1 class="post-title">Tạo báo cáo Excel với Apache POI</h1>
                <section class="post-meta">
                    N.C.M -
                    <time class="post-date" datetime="2017-06-30">30 Jun 2017</time>
                </section>
            </header>
            <figure class="post-image">
                <amp-img src="https://drive.google.com/uc?id&#x3D;0B05rqFCwNCjkZlNyZzRKQ3RvUnM&amp;export&#x3D;download" width="600" height="340" layout="responsive"></amp-img>
            </figure>
            <section class="post-content">

                <p>Gần đây mình phải cài đặt chức năng tự động tạo báo cáo dạng Microsoft Excel file. Việc tạo báo cáo dưới dạng file Excel này là một chức năng rất hay được yêu cầu khi phát triển phần mềm. Bên cạnh đó, nhiều phần mềm cũng thường xuyên phải nhận input data từ file Excel.</p>
<h3 id="1tngquan">1. Tổng quan</h3>
<h4 id="11apachepoilg">1.1. Apache POI là gì?</h4>
<p>Apache POI là một API nổi tiếng cho phép ta làm việc với các MS Office files bằng ngôn ngữ Java. Nó là thư viện mã nguồn mở được phát triển bởi Apache Software Foundation.<br />
POI là viết tắt của "Poor Obfuscation Implementation" với ám chỉ hài hước cho việc Microsoft đã tạo ra các định dạng phức tạp một cách không cần thiết. Các subcomponent của POI cũng được viết tắt từ những cái tên tương tự thế. Tuy nhiên, những giải thích viết tắt này đã được gỡ bỏ khỏi trang chủ của Apache POI.</p>
<h4 id="12cccomponentcaapachepoi">1.2. Các Component của Apache POI</h4>
<p>Apache POI chứa các class và method để làm việc với định dạng OLE2 của Microsoft. Sau đây là 1 số component của Apache POI mà ta hay sử dụng</p>
<ul>
<li><strong>POIFS for OLE 2 Documents</strong> dùng để đọc và viết dưới định dạng OLE2 của Microsoft. Là khốí cơ bản cho các POI component khác.  POIFS là viết tắt của "Poor Obfuscation Implementation File System".</li>
<li><strong>HSSF and XSSF for Excel Documents</strong>
<ul>
<li>HSSF (Horrible SpreadSheet Format) dùng để đọc và ghi file Microsoft Excel 97(-2007), với định dạng file là BIFF8, có file extension là XLS</li>
</ul>
</li>
<li>XSSF (XML Spreadsheet Format) dùng cho Microsoft Excel XML (2007+) với định dạng file OOXML, có file extension là XLSX</li>
<li>Package SS cung cấp common hỗ trợ cả 2 định dạng trên</li>
<li><strong>HWPF and XWPF for Word Documents</strong></li>
<li>HWPF (Horrible Word Processor Format) hỗ trợ cho Microsoft Word 97 (-2003) với extention DOC</li>
<li>Còn XWPF (XML Word Processor Format) hỗ trợ cho Microsoft Word (2007+) với extention DOCX</li>
<li><strong>HSLF and XSLF for PowerPoint Documents</strong></li>
<li>Tương tự, HSLF (Horrible Slide Layout Format) hỗ trợ Microsoft PowerPoint 97 (-2003) với extention  PPT</li>
<li>XSLF (XML Slide Layout Format) hỗ trợ Microsoft PowerPoint (2007+) với extention PPTX</li>
<li>Package SL cung cấp common hỗ trợ cả 2 định dạng trên</li>
</ul>
<p>Ngoài ra, còn nhiều component khác với những cái tên thú vị như</p>
<ul>
<li>HPSF (Horrible Property Set Format) cho OLE 2 Document Properties</li>
<li>HDGF (Horrible Diagram Format) và XDGF (XML Diagram Format) for Visio Documents</li>
<li>HPBF (Horrible Publisher Format) cho Publisher Documents</li>
<li>HSMF (Horrible Stupid Mail Format) cho Outlook Messages</li>
<li>DDF (Dreadful Drawing Format)</li>
<li>HMEF (Horrible Mail Encoding Format) cho TNEF Outlook Attachments</li>
<li>...</li>
</ul>
<h3 id="2javaexcelapis">2. Java Excel APIs</h3>
<p>Trong bài viết này, mình chỉ tập trung vào phần Excel API của Apache POI.</p>
<p>Trước hết ta cần nắm rõ cấu trúc của 1 file excel. Nó bao gồm các khái niệm cơ bản sau với các class cài đặt tương ứng</p>
<ul>
<li><strong>Workbook</strong> là cách gọi của file excel</li>
<li>HSSFWorkbook</li>
<li>XSSFWorkbook</li>
<li><strong>Spreadsheet</strong> (Sheet): Một workbook thì có nhiều sheet, các sheet có tên không trùng nhau</li>
<li>HSSFSheet</li>
<li>XSSFSheet</li>
<li><strong>Row</strong>: mỗi sheet có nhiều row</li>
<li>HSSFRow</li>
<li>XSSFRow</li>
<li><strong>Cell</strong> sẽ chứa các dữ liệu mà chúng ta cần đọc hoặc ghi</li>
<li>HSSFCell</li>
<li>XSSFCell</li>
<li>HSSFCellStyle</li>
<li>XSSFCellStyle</li>
<li>HSSFColor</li>
<li>XSSFColor</li>
<li>HSSFFont</li>
<li>XSSFFont</li>
<li>...</li>
</ul>
<p><amp-img src="https://drive.google.com/uc?id=0B05rqFCwNCjkbFR5eDJRODhjT28&amp;export=download" alt width="608" height="438" layout="responsive"></amp-img></p>
<p>Khi sử dụng Maven có thể khai báo đơn giản như sau với phiên bản mới nhất là 3.16</p>
<pre><code>&lt;dependency&gt;
	&lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
	&lt;artifactId&gt;poi&lt;/artifactId&gt;
	&lt;version&gt;3.16&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
	&lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
	&lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt;
	&lt;version&gt;3.16&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<h4 id="21to1fileexcelngin">2.1 Tạo 1 file excel đơn giản</h4>
<p>Chỉ với việc sử dụng vài hàm đơn giản sau, ta có thể dễ dàng tạo 1 file excel</p>
<pre><code># Tạo workbook
XSSFWorkbook workbook = new XSSFWorkbook();

# Tạo spreadsheet
XSSFSheet spreadsheet = workbook.createSheet("Sheet Name");

# Tạo row trong spreadsheet
XSSFRow row = spreadsheet.createRow(rowId);

# Tạo cell trong row
Cell cell = row.createCell(cellId);
</code></pre>
<h4 id="22trnhbyfileexcelphnvicellstyle">2.2 Trình bày file excel đẹp hơn với CellStyle</h4>
<h5 id="rowcolumn">Row, Column</h5>
<p>Ta có thể set các thuộc tính về chiều cao của row, độ rộng của column 1 cách đơn giản như sau</p>
<pre><code>XSSFRow row = spreadsheet.createRow(rowId);
row.setHeight(800);

spreadsheet.setColumnWidth(columnID, 8000);
</code></pre>
<h5 id="cellstylecolor">CellStyle (+ Color)</h5>
<ul>
<li>Ta có thể căn chỉnh alignment cho cell</li>
</ul>
<pre><code># Ví dụ với Center alignment
# Ta tạo style
XSSFCellStyle centerStyle = workbook.createCellStyle();
centerStyle.setAlignment(HorizontalAlignment.CENTER);
centerStyle.setVerticalAlignment(VerticalAlignment.CENTER);

# Set style cho cell
cell.setCellStyle(centerStyle);
</code></pre>
<p>Có thể tham khảo thêm các enum <a href="https://poi.apache.org/apidocs/org/apache/poi/ss/usermodel/HorizontalAlignment.html">HorizontalAlignment</a> và <a href="https://poi.apache.org/apidocs/org/apache/poi/ss/usermodel/VerticalAlignment.html">VerticalAlignment</a> để biết thêm các kiểu căn chỉnh khác.</p>
<ul>
<li>Hoặc setting border</li>
</ul>
<p>Ta có thể setting border cho các đường trên, dưới, phải, trái của cell với nhiều thuộc tính khác nhau như kiểu đường, màu sắc, ...</p>
<pre><code>XSSFCellStyle style = workbook.createCellStyle();

# Set bottom
style.setBorderBottom(BorderStyle.DASH_DOT);
style.setBottomBorderColor(IndexedColors.BLUE.getIndex());

# Set left
style.setBorderLeft(BorderStyle.DOUBLE);
style.setLeftBorderColor(IndexedColors.GREEN.getIndex());

# Set right
style.setBorderRight(BorderStyle.HAIR);
style.setRightBorderColor(IndexedColors.RED.getIndex());

# Set top
style.setBorderTop(BorderStyle.THICK);
style.setTopBorderColor(IndexedColors.CORAL.getIndex());

# Set style cho cell
cell.setCellStyle(style);
</code></pre>
<p>Tham khảo thêm các enum <a href="https://poi.apache.org/apidocs/org/apache/poi/ss/usermodel/BorderStyle.html">BorderStyle</a> và <a href="https://poi.apache.org/apidocs/org/apache/poi/ss/usermodel/IndexedColors.html">IndexedColors</a> để biết thêm nhiều thuộc tính khác.</p>
<ul>
<li>Ta cũng có thể set background color cho cell</li>
</ul>
<pre><code>XSSFCellStyle style = workbook.createCellStyle();

# Set màu
style.setFillBackgroundColor(IndexedColors.LEMON_CHIFFON.getIndex());

# Set cách fill màu vào cell
style.setFillPattern(FillPatternType.LESS_DOTS);
style.setAlignment(XSSFCellStyle.ALIGN_FILL);

# Set style cho cell
cell.setCellStyle(style);
</code></pre>
<h5 id="cellstylefontcolor">CellStyle (+ Font + Color)</h5>
<p>Ta cũng có thể tùy chỉnh kiểu font cho các ô như sau</p>
<pre><code># Tạo font
XSSFFont font = workbook.createFont();
font.setFontHeightInPoints(30);
font.setFontName("IMPACT");
font.setItalic(true);

# Ta cũng có thể set màu cho font
font.setColor(IndexedColors.BRIGHT_GREEN.getIndex());

# Set font cho style
XSSFCellStyle style = workbook.createCellStyle();
style.setFont(font);

# Set style cho cell
cell.setCellStyle(style);
</code></pre>
<h4 id="23cngthcexcel">2.3 Công thức Excel</h4>
<p>Một phần không thể thiếu của excel là các công thức tính toán mạnh mẽ. Apache POI cũng dễ dàng tạo các công thức cho cell. Ví dụ như sau</p>
<pre><code>cell = row.createCell(cellId);

# Tạo công thức SUM
cell.setCellType(CellType.FORMULA);
cell.setCellFormula("SUM(C2:C3)" );
</code></pre>
<h4 id="24vd">2.4 Ví dụ</h4>
<p>Ta sẽ tạo 1 file excel có 2 sheet có nội dung như sau</p>
<ul>
<li>Sheet1: "Thông tin nhân viên"</li>
</ul>
<table>
<thead>
<tr>
<th>MSNV</th>
<th>Họ tên</th>
<th>Số điện thoại</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Nguyễn Văn X</td>
<td>098000001</td>
</tr>
<tr>
<td>2</td>
<td>Nguyễn Thị Y</td>
<td>098000003</td>
</tr>
<tr>
<td>3</td>
<td>Lê Văn X</td>
<td>098000003</td>
</tr>
</tbody>
</table>
<ul>
<li>Sheet2: "Ngày công tháng 5"</li>
</ul>
<table>
<thead>
<tr>
<th>MSNV</th>
<th>Ngày công</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>20</td>
</tr>
<tr>
<td>2</td>
<td>22</td>
</tr>
<tr>
<td>3</td>
<td>23</td>
</tr>
</tbody>
</table>
<p>Code ví dụ như sau:</p>
<pre><code>import org.apache.poi.ss.usermodel.*;
import org.apache.poi.xssf.usermodel.*;

import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.Map;
import java.util.Set;
import java.util.TreeMap;

public class TestPoi {

    private static SimpleDateFormat YYYYMMDDHHMMSS = new SimpleDateFormat("yyyyMMddHHmmss");
    private static String LOCAL_EXCEL_ROOT_PATH = "C:/Users/Minh NC/2017q2";
    private static String LOCAL_EXCEL_FILE_PATH = LOCAL_EXCEL_ROOT_PATH + "/blog_test_" + YYYYMMDDHHMMSS.format(new Date()) + ".xlsx";

    public static void main(String[] args) throws IOException {
        // Sheet1 data
        Map&lt;Integer, Object[]&gt; sheet1Data = new TreeMap&lt;Integer, Object[]&gt;();
        sheet1Data.put(1, new Object[]{"MSNV", "Họ tên", "Số điện thoại"});
        sheet1Data.put(2, new Object[]{"1", "Nguyễn Văn X", "098000001"});
        sheet1Data.put(3, new Object[]{"2", "Nguyễn Thị Y", "098000002"});
        sheet1Data.put(4, new Object[]{"3", "Lê Văn X", "098000003"});

        // Sheet2 data
        Map&lt;Integer, Object[]&gt; sheet2Data = new TreeMap&lt;Integer, Object[]&gt;();
        sheet2Data.put(1, new Object[]{"MSNV", "Ngày công"});
        sheet2Data.put(2, new Object[]{"1", "20"});
        sheet2Data.put(3, new Object[]{"2", "22"});
        sheet2Data.put(4, new Object[]{"3", "23"});

        // Tạo 2 sheet, và set width cho column
        XSSFWorkbook workbook = new XSSFWorkbook();
        XSSFSheet spreadsheet1 = workbook.createSheet("Thông tin nhân viên");
        spreadsheet1.setColumnWidth(0, 6000);
        spreadsheet1.setColumnWidth(1, 20000);
        spreadsheet1.setColumnWidth(2, 12000);

        XSSFSheet spreadsheet2 = workbook.createSheet("Ngày công tháng 5");
        spreadsheet2.setColumnWidth(0, 6000);
        spreadsheet2.setColumnWidth(1, 12000);

        // Border cho tất cả các cell bình thường
        XSSFCellStyle border = workbook.createCellStyle();
        border.setBorderTop(BorderStyle.THIN);
        border.setBorderBottom(BorderStyle.THIN);
        border.setBorderLeft(BorderStyle.THIN);
        border.setBorderRight(BorderStyle.THIN);

        // Tạo style header: Alignment Center, Bold Font, Font color, background, border
        XSSFCellStyle headerStyle = workbook.createCellStyle();

        /* Multiple Styles to Excel Cell POI */
        headerStyle.cloneStyleFrom(border);

        headerStyle.setAlignment(HorizontalAlignment.CENTER);
        headerStyle.setVerticalAlignment(VerticalAlignment.CENTER);

        XSSFFont font = workbook.createFont();
        font.setBold(true);
        font.setColor(IndexedColors.BLUE.getIndex());
        headerStyle.setFont(font);

        headerStyle.setFillBackgroundColor(IndexedColors.GREY_25_PERCENT.getIndex());
        headerStyle.setFillPattern(FillPatternType.THIN_BACKWARD_DIAG);

        // Căn giữa cho column MSNV
        XSSFCellStyle center = workbook.createCellStyle();

        /* Multiple Styles to Excel Cell POI */
        center.cloneStyleFrom(border);

        center.setAlignment(HorizontalAlignment.CENTER);
        center.setVerticalAlignment(VerticalAlignment.CENTER);

        // Ghi data vào các sheet
        writeToSheet(spreadsheet1, sheet1Data, headerStyle, border, center, 1);
        writeToSheet(spreadsheet2, sheet2Data, headerStyle, border, center, 2);

        // Tạo công thức tổng ngày công với sheet 2
        XSSFRow sumRow = spreadsheet2.createRow(5);
        Cell sumLabelCell = sumRow.createCell(0);

        XSSFCellStyle right = workbook.createCellStyle();
        right.setAlignment(HorizontalAlignment.RIGHT);
        right.setVerticalAlignment(VerticalAlignment.CENTER);
        sumLabelCell.setCellStyle(right);

        sumLabelCell.setCellValue("Tổng");

        Cell sumCell = sumRow.createCell(1);
        sumCell.setCellType(CellType.FORMULA);
        sumCell.setCellFormula("SUM(B2:B4)");

        // Ghi ra local file
        File rootDir = new File(LOCAL_EXCEL_ROOT_PATH);
        rootDir.mkdirs();
        FileOutputStream out = new FileOutputStream(new File(LOCAL_EXCEL_FILE_PATH));
        workbook.write(out);
        out.close();
    }

    private static void writeToSheet(XSSFSheet spreadsheet, Map&lt;Integer, Object[]&gt; sheetData,
                                     XSSFCellStyle headerStyle, XSSFCellStyle border, XSSFCellStyle center, Integer type) {

        Set&lt;Integer&gt; keyIds = sheetData.keySet();
        XSSFRow row;
        int rowId = 0;

        for (Integer key : keyIds) {
            // Tạo row
            row = spreadsheet.createRow(rowId++);

            Object[] objectArr = sheetData.get(key);
            int cellId = 0;

            for (Object obj : objectArr) {
                // Tạo cell
                Cell cell = row.createCell(cellId++);

                // Set border cho tất cả các cell
                cell.setCellStyle(border);

                if (rowId == 1) {
                    // Với header, set value dạng String
                    cell.setCellValue((String) obj);
                    // Set style cho header
                    cell.setCellStyle(headerStyle);
                } else {
                    // Các row khác
                    if (cellId == 1) {
                        // Với cột MSNV, set value dạng number
                        cell.setCellValue(Integer.valueOf((String) obj));
                        // Set center style
                        cell.setCellStyle(center);
                    } else {
                        // Các cột khác
                        if (type == 2 &amp;&amp; cellId == 2) {
                            // Trường hợp Ngày công thì dạng number
                            cell.setCellValue(Integer.valueOf((String) obj));
                        } else {
                            // Bình thường thì dạng String
                            cell.setCellValue((String) obj);
                        }
                    }
                }
            }
        }
    }
}
</code></pre>
<p>Kết quả</p>
<p><amp-img src="https://drive.google.com/uc?id=0B05rqFCwNCjkNGt5cnlrMnY4cmc&amp;export=download" alt="Sheet 1: Thông tin nhân viên" width="1929" height="1039" layout="responsive"></amp-img></p>
<center>*Sheet 1: Thông tin nhân viên*</center>
<p><amp-img src="https://drive.google.com/uc?id=0B05rqFCwNCjkYzJKcXd2RDJsdDg&amp;export=download" alt="Ngày công tháng 5" width="1929" height="1039" layout="responsive"></amp-img></p>
<center>*Sheet 2: Ngày công tháng 5*</center>
<p>Ở ví dụ này thì có 2 điểm đáng chú ý là</p>
<ul>
<li>Apache POI không hỗ trợ set nhiều style cho 1 cell. Khi ta set nhiều style khác nhau cho 1 cell thì cái được set cuối cùng sẽ ghi đè lên tất cả style trước đó.</li>
<li>Giải pháp cho việc muốn tạo set nhiều style cho 1 cell là ta có thể tạo 1 style base, rồi các style khác sẽ clone từ style base đó bằng cách sử dụng hàm <code>cloneStyleFrom(CellStyle source)</code> như ở ví dụ trên</li>
<li>Việc set background cho cell thì các pattern hiện tại chưa được đẹp lắm. Mình phải chọn màu và cách fill màu, và các cách fill màu hiện tại còn ít và đơn giản.</li>
</ul>
<h3 id="3ktlun">3. Kết luận</h3>
<p>Apache POI là 1 thư viện mạnh mẽ giúp ta làm việc hiệu quả với MS Office.</p>
<p>Trên đây chỉ là 1 ứng dụng nhỏ của Apache POI, nhằm giúp cho việc tạo các bản báo cáo Excel đã trở nên dễ dàng và nhanh chóng.</p>
<h3 id="thamkho">Tham khảo</h3>
<ul>
<li><a href="https://poi.apache.org">Apache POI Home Page</a></li>
<li><a href="https://en.wikipedia.org/wiki/Apache_POI">Wikipedia Apache POI</a></li>
<li><a href="https://www.tutorialspoint.com/apache_poi/index.htm">Apache POI Tutorial</a></li>
</ul>


            </section>

        </article>
    </main>
    <footer class="page-footer">
        <h3>GMO-Z.com Vietnam Lab Center Technology Blog</h3>
            <p>Blog chia sẻ kỹ thuật của thành viên công ty GMO-Z.com Vietnam Lab Center</p>
        <p><a href="../../index.html">Read more posts →</a></p>
        <a class="powered" href="https://ghost.org" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 156 156"><g fill="none" fill-rule="evenodd"><rect fill="#15212B" width="156" height="156" rx="27"/><g transform="translate(36 36)" fill="#F6F8FA"><path d="M0 71.007A4.004 4.004 0 014 67h26a4 4 0 014 4.007v8.986A4.004 4.004 0 0130 84H4a4 4 0 01-4-4.007v-8.986zM50 71.007A4.004 4.004 0 0154 67h26a4 4 0 014 4.007v8.986A4.004 4.004 0 0180 84H54a4 4 0 01-4-4.007v-8.986z"/><rect y="34" width="84" height="17" rx="4"/><path d="M0 4.007A4.007 4.007 0 014.007 0h41.986A4.003 4.003 0 0150 4.007v8.986A4.007 4.007 0 0145.993 17H4.007A4.003 4.003 0 010 12.993V4.007z"/><rect x="67" width="17" height="17" rx="4"/></g></g></svg> Published with Ghost</a>
    </footer>
    
</body>
</html>
